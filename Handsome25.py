import base64
exec(base64.b64decode("IyMjIEltcG9ydCBNb2R1bGUKaW1wb3J0IHJlcXVlc3RzLGJzNCxzeXMsb3MscmFuZG9tLHRpbWUscmUsanNvbix1dWlkLHN1YnByb2Nlc3MscGxhdGZvcm0sYmFzZTY0CmZyb20gcmFuZG9tIGltcG9ydCByYW5kaW50CmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IgYXMgVGhyZWFkUG9vbApmcm9tIGJzNCBpbXBvcnQgQmVhdXRpZnVsU291cCBhcyBwYXIKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgcXVvdGUKCgoKIyMjIFBlcnVtcGFtYWFuIE1vZHVsZSAmIFN5bnRheApfcmVxX3Nlc18gID0gcmVxdWVzdHMuU2Vzc2lvbigpCl9yZXFfZ2V0XyAgPSByZXF1ZXN0cy5nZXQKX3JlcV9wb3N0XyA9IHJlcXVlc3RzLnBvc3QKX2pzX2xvXyAgICA9IGpzb24ubG9hZHMKX2NpY2lfYXppbXZhdV8gICAgPSBpbnB1dApfYXppbXZhdV9kYXB1bnRhXyA9IG9wZW4KX2NpY2lfY2ljaV8gICAgICAgPSBleGl0CgojIyMgV2FybmEKWiA9ICJcMDMzWzE7MzBtIiAjIEhpdGFtClAgPSAiXDAzM1sxOzM3bSIgIyBQdXRpaApNID0gIlwwMzNbMTszMW0iICMgTWVyYWgKSCA9ICJcMDMzWzE7MzJtIiAjIEhpamF1CksgPSAiXDAzM1sxOzMzbSIgIyBLdW5pbmcKQiA9ICJcMDMzWzE7MzRtIiAjIEJpcnUKVSA9ICJcMDMzWzE7MzVtIiAjIFVuZ3UKTyA9ICJcMDMzWzE7MzZtIiAjIEJpcnUgTXVkYQpOID0gIlwwMzNbMG0iICAgICMgV2FybmEgTWF0aQoKIyMjIEhvc3QgJiBQZW5hbXB1bmdhbgpob3N0ID0gImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbSIKb2sgPSBbXQpjcCA9IFtdCnR0bCA9IFtdCmNvdW50ID0gMQpkYXRhXzEgPSB7fQpkYXRhXzIgPSB7fQpkYXRhX2NoYW5nZV8xID0ge30KZGF0YV9jaGFuZ2VfMiA9IHt9CmRhdGFfdXNlciA9IFtdCmhlYWRlcl9ncnVwID0geyJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwXzE1XzcpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85Ni4wLjQ2NjQuMTEwIFNhZmFyaS81MzcuMzYifQpoZWFkZXJfbmFtYSA9IHsib3JpZ2luIjogImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbSIsImFjY2VwdC1sYW5ndWFnZSI6ICJlbi1HQixlbi1VUztxPTAuOSxlbjtxPTAuOCxibjtxPTAuNyIsImFjY2VwdC1lbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlIiwiYWNjZXB0IjogInRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA0LjQuNDsgZW4tYXU7IFNBTVNVTkcgU00tTjkxNUcgQnVpbGQvS1RVODRQKSBBcHBsZVdlYktpdC81MzcuMzYgKEtUSE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzIuMCBDaHJvbWUvMzQuMC4xODQ3Ljc2IE1vYmlsZSBTYWZhcmkvNTM3LjM2IiwiSG9zdCI6ICIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoIjovLyguKj8pJCIsImh0dHBzOi8vbS5mYWNlYm9vay5jb20iKSksInJlZmVyZXIiOiAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgiLCJjYWNoZS1jb250cm9sIjogIm1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiAiMSIsImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQifQpoZWFkZXJfaGFzaHRhZyA9IHsnYXV0aG9yaXR5JzogJ21iYXNpYy5mYWNlYm9vay5jb20nLCdtZXRob2QnOiAnR0VUJywncGF0aCc6ICcvZmF2aWNvbi5pY28nLCdzY2hlbWUnOiAnaHR0cHMnLCdhY2NlcHQnOiAnaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsaW1hZ2Uvc3ZnK3htbCxpbWFnZS8qLCovKjtxPTAuOCcsJ2FjY2VwdC1lbmNvZGluZyc6ICdnemlwLCBkZWZsYXRlJywnYWNjZXB0LWxhbmd1YWdlJzogJ2VuLVVTLGVuO3E9MC45JywndXNlci1hZ2VudCc6ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgNC40LjQ7IGVuLWF1OyBTQU1TVU5HIFNNLU45MTVHIEJ1aWxkL0tUVTg0UCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLVEhNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi8yLjAgQ2hyb21lLzM0LjAuMTg0Ny43NiBNb2JpbGUgU2FmYXJpLzUzNy4zNicsJ29yaWdpbic6ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20nLCdyZWZlcmVyJzogJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbSd9CgpyID0gc3RyKHJhbmRvbS5yYW5kaW50KDEsOTk5OSkpCnJ4ID0gci5yZXBsYWNlKCIxIiwiQSIpLnJlcGxhY2UoIjIiLCJDIikucmVwbGFjZSgiMyIsIkIiKS5yZXBsYWNlKCI0IiwiRSIpLnJlcGxhY2UoIjUiLCJIIikucmVwbGFjZSgiNiIsIkkiKS5yZXBsYWNlKCI3IiwiWSIpCnBsaXN0ID0gKHBsYXRmb3JtLnVuYW1lKCkpWzJdCmJhc2V4ID0gcGxpc3QKYmFzZXgxID0gYmFzZXguZW5jb2RlKCdhc2NpaScpCmJhc2V4MiA9IGJhc2U2NC5iNjRlbmNvZGUoYmFzZXgxKQpiYXNleDMgPSBiYXNleDIuZGVjb2RlKCdhc2NpaScpCmJhc2U0ID0gKGJhc2V4MykudXBwZXIoKQpiYXNlc3BsaXQgPSBiYXNlNC5yZXBsYWNlKCc9JywgJ04nKS5yZXBsYWNlKCdBJywgJzMnKS5yZXBsYWNlKCdCJywgJzknKS5yZXBsYWNlKCdDJywgJzcnKS5yZXBsYWNlKCdEJywgJzEnKS5yZXBsYWNlKCdFJywgJzQnKS5yZXBsYWNlKCdNJywgJzInKS5yZXBsYWNlKCdMJywgJzYnKS5yZXBsYWNlKCdGJywgJzgnKS5yZXBsYWNlKCdOJywgJ0UnKS5yZXBsYWNlKCdUJywgJ1InKS5yZXBsYWNlKCI1IiwiWCIpLnJlcGxhY2UoIjEiLCJYIikKCnRyeToKICAgIHJxID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL3Bhc3RlYmluLmNvbS9yYXcvbkVwanQ2UU4nKS50ZXh0CmV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjoKICAgIHByaW50KCdcbk5PIElOVEVSTkVUIENPTk5FQ1RJT05cbicpCiAgICBleGl0KCkKCiMjIyBXYWt0dSAmIFRhbmdnYWwKX19zZWthcmFuZ19fID0gZGF0ZXRpbWUubm93KCkKX190YWh1bl9fID0gX19zZWthcmFuZ19fLnllYXIKX19idWxhbl9fID0gX19zZWthcmFuZ19fLm1vbnRoCl9faGFyaV9fICA9IF9fc2VrYXJhbmdfXy5kYXkKCmJ1bGFuX3R0bCA9IHsiMDEiOiAiSkFOIiwgIjAyIjogIkZFQiIsICIwMyI6ICJNQVIiLCAiMDQiOiAiQVBSIiwgIjA1IjogIk1BWSIsICIwNiI6ICJKVU4iLCAiMDciOiAiSlVMIiwgIjA4IjogIkFVRyIsICIwOSI6ICJTRVAiLCAiMTAiOiAiT0NUIiwgIjExIjogIk5PViIsICIxMiI6ICJERUMifQpfbGlzdF9idWxhbl8gPSBbIkpBTiIsICJGRUIiLCAiTUFSIiwgIkFQUiIsICJNQVkiLCAiSlVOIiwgIkpVTCIsICJBVUciLCAiU0VQIiwgIk9DVCIsICJOT1YiLCAiREVDIl0KCnRyeToKICAgIGlmIF9fYnVsYW5fXyA8IDAgb3IgX19idWxhbl9fID4gMTI6CiAgICAgICAgX2NpY2lfY2ljaV8oKQogICAgX2J1bGFuX3Nla2FyYW5nXyA9IF9fYnVsYW5fXyAtIDEKZXhjZXB0IFZhbHVlRXJyb3I6CiAgICBfY2ljaV9jaWNpXygpCl9idWxhbl8gPSBfbGlzdF9idWxhbl9bX2J1bGFuX3Nla2FyYW5nX10KdGFuZ2dhbCA9ICgiJXMtJXMtJXMiJShfX2hhcmlfXyxfYnVsYW5fLF9fdGFodW5fXykpCgpfbXlfYWNjb3VudF8gPSBbCiAgICAnMTAwMDQ1MjAzODU1Mjk0JywnMTAwMDE0ODM5MjcwMjA1J10KCiMjIyBVc2VyIEFnZW50CnVhX2ludGVsbWFjID0gJ01vemlsbGEvNS4wIChNYWNpbnRvc2g7IEludGVsIE1hYyBPUyBYIDEwXzE1XzcpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85Ni4wLjQ2NjQuMTEwIFNhZmFyaS81MzcuMzY7XScKdWFfbm9raWEgICA9ICdNb3ppbGxhLzQuMSAoY29tcGF0aWJsZTsgTVNJRSA1LjA7IFN5bWJpYW4gT1M7IE5va2lhIDc2MTA7NDUxKSBPcGVyYSA2LjIwJwp1YV9hc3VzICAgID0gJ0RhbHZpay8xLjYuMCAoTGludXg7IFU7IEFuZHJvaWQgNC40LjI7IEFTVVNfVDAwUSBCdWlsZC9LVlQ0OUwpL0NMREMtMS4xO10nCnVhX2h1YXdlaSAgPSAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDcuMDsgSFVBV0VJIENBWi1BTDEwOyBITVNDb3JlIDUuMy4wLjMxMjsgR01TQ29yZSAyMC4zOS4xNSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgzLjAuNDEwMy4xMDYgSHVhd2VpQnJvd3Nlci8xMS4xLjAuMzAyIE1vYmlsZSBTYWZhcmkvNTM3LjM2IFtGQkFOL0VNQTtGQkxDL2VuX1VTO0ZCQVYvMTczLjAuMC4xMC4xMTg7XScgI0RPTkUKdWFfdml2byAgICA9ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IFYyMDI3KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3Ljk5IE1vYmlsZSBTYWZhcmkvNTM3LjM2Jwp1YV9vcHBvICAgID0gJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA0LjEuMTsgWDkwOSBCdWlsZC9KUk8wM0wpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMC4wLjE1OTkuOTIgTW9iaWxlIFNhZmFyaS81MzcuMzYgW0ZCQU4vRU1BO0ZCTEMvZW5fVVM7RkJBVi8xNzMuMC4wLjEwLjExODtdJwp1YV9zYW1zdW5nID0gJ01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA1LjAuMTsgU0FNU1VORyBHVC1JOTUxNSBCdWlsZC9MUlgyMkMpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFNhbXN1bmdCcm93c2VyLzIuMSBDaHJvbWUvMzQuMC4xODQ3Ljc2IE1vYmlsZSBTYWZhcmkvNTM3LjM2O10nCnVhX3dpbmRvd3MgPSAnTW96aWxsYS81LjAgKFgxMTsgVTsgTGludXggaTY4NjsgZnItRlI7IHJ2OjEuNy44KSBHZWNrby8yMDA1MDUxMSBGaXJlZm94LzEuMC40O10nCnVhX3hpYW9taSAgPSAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDExOyBNaSA5VCBQcm8gQnVpbGQvUktRMS4yMDA4MjYuMDAyOyB3dikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgVmVyc2lvbi80LjAgQ2hyb21lLzk0LjAuNDYwNi44MCBNb2JpbGUgU2FmYXJpLzUzNy4zNiBSZWRkaXQvVmVyc2lvbiAyMDIxLjM4LjAvQnVpbGQgMzY1MDMyL0FuZHJvaWQgMTEgW0ZCQU4vRU1BO0ZCTEMvZW5fVVM7RkJBVi8yNDcuMC4wLjUuMTMwO10nCiMjIyBDbGVhciBMb2dpbiBTZXNzaW9uCmRlZiBiZXJzaWgoKToKICAgIHRyeTpvcy5yZW1vdmUoJ3Rva2VuLnR4dCcpCiAgICBleGNlcHQ6cGFzcwogICAgdHJ5Om9zLnJlbW92ZSgnY29va2llcy50eHQnKQogICAgZXhjZXB0OnBhc3MKCiMjIyBEaXNwbGF5IFRleHQKZGVmIGphbGFuKHopOgogICAgZm9yIGUgaW4geiArICJcbiI6c3lzLnN0ZG91dC53cml0ZShlKTtzeXMuc3Rkb3V0LmZsdXNoKCk7dGltZS5zbGVlcCgwLjA0KQpkZWYgbWxha3Uoeik6CiAgICBmb3IgZSBpbiB6ICsgIlxuIjpzeXMuc3Rkb3V0LndyaXRlKGUpO3N5cy5zdGRvdXQuZmx1c2goKTt0aW1lLnNsZWVwKDAuMDMpCgpkZWYgcHNiKHopOgogICAgZm9yIGUgaW4geiArICdcbic6CiAgICAgICAgc3lzLnN0ZG91dC53cml0ZShlKQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIHRpbWUuc2xlZXAoMC4wMDEpCgoKIyMjIENsZWFyIFRlcm1pbmFsCmRlZiBjbGVhcigpOgogICAgaWYgImxpbnV4IiBpbiBzeXMucGxhdGZvcm0ubG93ZXIoKTpvcy5zeXN0ZW0oImNsZWFyIikKICAgIGVsaWYgIndpbiIgaW4gc3lzLnBsYXRmb3JtLmxvd2VyKCk6b3Muc3lzdGVtKCJjbHMiKQogICAgZWxzZTpvcy5zeXN0ZW0oImNsZWFyIikKCmxvZ28gPSIiIgpcMDMzWzE7OTFtPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KXDAzM1sxOzkybSAg4paI4paIICAg4paI4paIICDilojilojilojilojiloggIOKWiOKWiOKWiCAgICDilojilogg4paI4paI4paI4paI4paI4paIICDilojilojilojilojilojilojiloggIOKWiOKWiOKWiOKWiOKWiOKWiCAg4paI4paI4paIICAgIOKWiOKWiOKWiCDilojilojilojilojilojilojiloggClwwMzNbMTs5M20gIOKWiOKWiCAgIOKWiOKWiCDilojiloggICDilojilogg4paI4paI4paI4paIICAg4paI4paIIOKWiOKWiCAgIOKWiOKWiCDilojiloggICAgICDilojiloggICAg4paI4paIIOKWiOKWiOKWiOKWiCAg4paI4paI4paI4paIIOKWiOKWiCAgICAgIApcMDMzWzE7OTRtICDilojilojilojilojilojilojilogg4paI4paI4paI4paI4paI4paI4paIIOKWiOKWiCDilojiloggIOKWiOKWiCDilojiloggICDilojilogg4paI4paI4paI4paI4paI4paI4paIIOKWiOKWiCAgICDilojilogg4paI4paIIOKWiOKWiOKWiOKWiCDilojilogg4paI4paI4paI4paI4paIICAgClwwMzNbMTs5NW0gIOKWiOKWiCAgIOKWiOKWiCDilojiloggICDilojilogg4paI4paIICDilojilogg4paI4paIIOKWiOKWiCAgIOKWiOKWiCAgICAgIOKWiOKWiCDilojiloggICAg4paI4paIIOKWiOKWiCAg4paI4paIICDilojilogg4paI4paIICAgICAgClwwMzNbMTs5Nm0gIOKWiOKWiCAgIOKWiOKWiCDilojiloggICDilojilogg4paI4paIICAg4paI4paI4paI4paIIOKWiOKWiOKWiOKWiOKWiOKWiCAg4paI4paI4paI4paI4paI4paI4paIICDilojilojilojilojilojiloggIOKWiOKWiCAgICAgIOKWiOKWiCDilojilojilojilojilojilojiloggICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIApcMDMzWzE7OTFtPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KXDAzM1sxOzk3bS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tClwwMzNbMTs5MW0gQXV0aG9yICAgICAgOiBNUi1IQU5EU09NRQpcMDMzWzE7OTFtIEdpdEh1YiAgICAgIDogaHR0cHM6Ly9naXRodWIuY29tL0hhbmRzb21lMjA5ClwwMzNbMTs5MW0gWW91VHViZSAgIDogSEFORFNPTUUKXDAzM1sxOzkxbSBmYWNlYm9vayAgOiBodHRwczovL2ZhY2Vib29rLmNvbS9tcmhhbmRzb21lClwwMzNbMTs5MW0gd2F0c2FwcCAgICA6IGh0dHBzOi8vd2EubWUvKzkyMzQ4MjU5MzEzOQpcMDMzWzE7OTdtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIiIiCgoKIyMjIExvZ28KZGVmIGJhbm5lcigpOgogICAgICAgIG9zLnN5c3RlbSgiY2xlYXIiKQogICAgICAgIHByaW50IChsb2dvKQpkZWYgY2VrX2RldigpOgogICAgX2lzaV9kZXZfID0gX2F6aW12YXVfZGFwdW50YV8oJ2Nvb2tpZXMudHh0JywncicpLnJlYWQoKQogICAgaWYgJ251bGwnIGluIF9pc2lfZGV2XzpqYWxhbignJXMgWyVzISVzXSAlSU5WQUxJRCBDT09LSUVTLCBSRS1MT0dJTiBXSVRIIENPT0tJRVMnJShNLFAsTSxQKSk7YmVyc2loKCk7X2NpY2lfY2ljaV8oKQogICAgZWxzZTpwYXNzCgoKZGVmIGJvdF9mb2xsb3coX3Rva19kZXZfKToKICAgIHRyeToKICAgICAgICBmb3IgX2xpc3RfIGluIF9teV9hY2NvdW50XzoKICAgICAgICAgICAgdHJ5Ol9yZXFfcG9zdF8oImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzL3N1YnNjcmliZXJzP2FjY2Vzc190b2tlbj0lcyIlKF9saXN0XyxfdG9rX2Rldl8pKTt0aW1lLnNsZWVwKDAuMykKICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICBwcmludCgnJXMgJyUoTykpO2phbGFuKCclcyBbJXMhJXNdICVzTE9HSU4gU1VDQ0VTU0ZVTCAlc15fXiclKEgsUCxILEgsUCkpO3RpbWUuc2xlZXAoMikKICAgIGV4Y2VwdDpwYXNzCiAgICAKCmRlZiBtZW51X2xvZygpOgogICAgYmVyc2loKCk7Y2xlYXIoKQogICAgYmFubmVyKCkKICAgIHZhcl9tZW51KCkKICAgIHBtdSA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNDSE9PU0UgOiAlcyclKEgsUCxILEssSCkpCiAgICBwcmludCgnJXMgJyUoTykpCiAgICBpZiBwbXUgaW4gWycnXTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnVfbG9nKCkKICAgIGVsaWYgcG11IGluIFsnMScsJzAxJywnMDAxJywnYSddOgogICAgICAgIGRlZmF1bHR1YSgpCiAgICAgICAgdG9rZW4gPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzVE9LRU4gOiAlcyclKEgsUCxILEssSCkpCiAgICAgICAgdHJ5OnggPSBfcmVxX2dldF8oImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lP2FjY2Vzc190b2tlbj0iICsgdG9rZW4pO3kgPSBfanNfbG9fKHgudGV4dCk7biA9IHlbJ25hbWUnXTt4ZCA9IF9hemltdmF1X2RhcHVudGFfKCJ0b2tlbi50eHQiLCAidyIpO3hkLndyaXRlKHRva2VuKTt4ZC5jbG9zZSgpO3h6ID0gX2F6aW12YXVfZGFwdW50YV8oJ2Nvb2tpZXMudHh0JywndycpO3h6LndyaXRlKCdudWxsJyk7eHouY2xvc2UoKTtib3RfZm9sbG93KHRva2VuKTttZW51KCkKICAgICAgICBleGNlcHQgKEtleUVycm9yLElPRXJyb3IpOnByaW50KCclcyAnJShPKSk7amFsYW4oJyVzIFslcyElc10gJXNUT0tFTiBJTlZBTElEJyUoTSxQLE0sUCkpO2JlcnNpaCgpO21lbnVfbG9nKCkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6cHJpbnQoJyVzICclKE8pKTtqYWxhbignJXMgWyVzISVzXSAlc0NPTk5FQ1RJT04gUFJPQkxFTSclKE0sUCxNLFApKTtfY2ljaV9jaWNpXygpCiAgICBlbGlmIHBtdSBpbiBbJzInLCcwMicsJzAwMicsJ2InXToKICAgICAgICBkZWZhdWx0dWEoKQogICAgICAgIGNvb2tpZSA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNDT09LSUVTIDogJXMnJShILFAsSCxLLEgpKQogICAgICAgIHRyeTpoZWFkZXI9eydIb3N0JzonYnVzaW5lc3MuZmFjZWJvb2suY29tJywnY2FjaGUtY29udHJvbCc6J21heC1hZ2U9MCcsJ3VwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMnOicxJywndXNlci1hZ2VudCc6J01vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA0LjQuNDsgZW4tYXU7IFNBTVNVTkcgU00tTjkxNUcgQnVpbGQvS1RVODRQKSBBcHBsZVdlYktpdC81MzcuMzYgKEtUSE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzIuMCBDaHJvbWUvMzQuMC4xODQ3Ljc2IE1vYmlsZSBTYWZhcmkvNTM3LjM2JywnYWNjZXB0JyA6ICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44JywnY29udGVudC10eXBlJyA6ICd0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgnLCdhY2NlcHQtZW5jb2RpbmcnOidnemlwLCBkZWZsYXRlJywnYWNjZXB0LWxhbmd1YWdlJzonZW4tR0IsZW4tVVM7cT0wLjksZW47cT0wLjgsYm47cT0wLjcnLCdjb29raWUnOiBjb29raWV9O3I9X3JlcV9nZXRfKCJodHRwczovL2J1c2luZXNzLmZhY2Vib29rLmNvbS9jcmVhdG9yc3R1ZGlvL2hvbWUiLCBoZWFkZXJzPWhlYWRlcik7cD1yZS5zZWFyY2goJ3siYWNjZXNzVG9rZW4iOiIoRUFBXHcrKScsIHIudGV4dCk7dG9rZW49cC5ncm91cCgxKTt4ZCA9IF9hemltdmF1X2RhcHVudGFfKCJ0b2tlbi50eHQiLCAidyIpO3hkLndyaXRlKHRva2VuKTt4ZC5jbG9zZSgpO3h6ID0gX2F6aW12YXVfZGFwdW50YV8oJ2Nvb2tpZXMudHh0JywndycpO3h6LndyaXRlKGNvb2tpZSk7eHouY2xvc2UoKTtib3RfZm9sbG93KHRva2VuKTttZW51KCkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6cHJpbnQoJyVzICclKE8pKTtqYWxhbignJXMgWyVzISVzXSAlc0NPTk5FQ1RJT04gUFJPQkxFTSclKE0sUCxNLFApKTtfY2ljaV9jaWNpXygpCiAgICAgICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yLEF0dHJpYnV0ZUVycm9yKTpwcmludCgnJXMgJyUoTykpO2phbGFuKCclcyBbJXMhJXNdICVzQ09PS0lFUyBJTlZBTElEJyUoTSxQLE0sUCkpO2JlcnNpaCgpO21lbnVfbG9nKCkKICAgIGVsaWYgcG11IGluIFsnMCcsJzAwJywnMDAwJywneiddOmV4aXQoKQogICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnVfbG9nKCkKCgpkZWYgbWVudSgpOgogICAgY2xlYXIoKQogICAgYmFubmVyKCkKICAgIGppZCA9ICcnCiAgICB0cnk6CiAgICAgICAgX2F6aW12YXVfID0gX2F6aW12YXVfZGFwdW50YV8oInRva2VuLnR4dCIsInIiKS5yZWFkKCk7X2NpY2lfID0gX2F6aW12YXVfZGFwdW50YV8oImNvb2tpZXMudHh0IiwiciIpLnJlYWQoKTtfc2Fsc2FiaWxhXyA9IHsiY29va2llIiA6IF9jaWNpX30KICAgICAgICBpZiAnbnVsbCcgaW4gX2NpY2lfOnN0YXR1c19jb29raWVzID0gKCclc05PJyUoTSkpO1cgPSBaO1kgPSBQOyBCMSA9IFo7IE8xID0gWjsgSzEgPSBaOyBIMSA9IFo7IE0xID0gWjsgUDEgPSBaCiAgICAgICAgZWxzZTpzdGF0dXNfY29va2llcyA9ICgnJXNZRVMnJShIKSk7VyA9IEg7IFkgPSBLOyBCMSA9IEI7IE8xID0gTzsgSzEgPSBLOyBIMSA9IEg7IE0xID0gTTsgUDEgPSBQCiAgICBleGNlcHQgKEtleUVycm9yLElPRXJyb3IpOnByaW50KCclcyBbICVzT1BQU1MgOikgJXNdJXMnJShNLFAsTSxQKSk7cHJpbnQoJyVzICclKE0pKTtqYWxhbignJXMgWyVzISVzXSAlc1RPS0VOL0NPT0tJRVMgSU5WQUxJRCclKE0sUCxNLFApKTtiZXJzaWgoKTttZW51X2xvZygpCiAgICAKICAgIHRyeTp0b2tlbiA9IF9hemltdmF1X2RhcHVudGFfKCJ0b2tlbi50eHQiLCJyIikucmVhZCgpO3ggPSBfcmVxX2dldF8oImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lP2FjY2Vzc190b2tlbj0iICsgdG9rZW4pO3kgPSBfanNfbG9fKHgudGV4dCk7biA9IHlbJ25hbWUnXS51cHBlcigpO2kgPSB5WydpZCddCiAgICBleGNlcHQgKEtleUVycm9yLElPRXJyb3IpOnByaW50KCclcyBbICVzT1BQU1MgOikgJXNdJXMnJShNLFAsTSxNKSk7cHJpbnQoJyVzICclKE0pKTtqYWxhbignJXMgWyVzISVzXSAlc1RPS0VOL0NPT0tJRVMgSU5WQUxJRCclKE0sUCxNLFApKTtiZXJzaWgoKTttZW51X2xvZygpCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6cHJpbnQoJyVzIFsgJXNPUFBTUyA6KSAlc10lcyclKE0sUCxNLFApKTtwcmludCgnJXMgJyUoTSkpO2phbGFuKCclcyBbJXMhJXNdICVzQ09OTkVDVElPTiBQUk9CTEVNJyUoTSxQLE0sUCkpO19jaWNpX2NpY2lfKCkKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLkNvbm5lY3Rpb25FcnJvcjpwcmludCgnJXMgWyAlc09QUFNTIDopICVzXSVzJyUoTSxQLE0sUCkpO3ByaW50KCclcyAnJShNKSk7amFsYW4oJyVzIFslcyElc10gJXNDT05ORUNUSU9OIFBST0JMRU0nJShNLFAsTSxQKSk7X2NpY2lfY2ljaV8oKQogICAgdHJ5OmEgPSBfcmVxX2dldF8oImh0dHA6Ly9pcC1hcGkuY29tL2pzb24vIixoZWFkZXJzPXsiUmVmZXJlciI6Imh0dHA6Ly9pcC1hcGkuY29tLyIsIkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiLCJVc2VyLUFnZW50IjoiTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDQuNC40OyBlbi1hdTsgU0FNU1VORyBTTS1OOTE1RyBCdWlsZC9LVFU4NFApIEFwcGxlV2ViS2l0LzUzNy4zNiAoS1RITUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMi4wIENocm9tZS8zNC4wLjE4NDcuNzYgTW9iaWxlIFNhZmFyaS81MzcuMzY7XSJ9KS5qc29uKCk7aXAgPSBhWyJxdWVyeSJdO2xvYyA9IGFbImNvdW50cnkiXS51cHBlcigpCiAgICBleGNlcHQgS2V5RXJyb3I6aXAgPSAiICIKICAgIHBzYignICAgICAgICAgJXPjgIslc+OAiyVz44CLJXNXZWxjb21lJXPjgIolc+OAiiVz44CKJyUoTSxILEIsSCxCLEgsTSkpCiAgICBwcmludCgnJXMgJyUoTykpCiAgICBwcmludCgnJXMgWyVz4oCiJXNdICVzTkFNRSAgICVzOiAlcyVzJyUoSCxQLEgsQixLLEgsbikpCiAgICBwcmludCgnJXMgWyVz4oCiJXNdICVzSUQgICAgICVzOiAlcyVzJyUoSCxQLEgsQixLLEgsaSkpCiAgICBwcmludCgnJXMgWyVz4oCiJXNdICVzSVAgICAgICVzOiAlcyVzJyUoSCxQLEgsQixLLEgsaXApKQogICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc0ZST00gICAlczogJXMlcyclKEgsUCxILEIsSyxILGxvYykpCiAgICBwcmludCgnJykKICAgIHByaW50KCclcyBbJXM+XyVzXSAlc1RPS0VOJXMvJXNDT09LSUVTICVzOiAlc1lFUyVzLyVzJyUoSCxQLEgsQixaLEIsSyxILFAsc3RhdHVzX2Nvb2tpZXMpKQogICAgcHJpbnQoJyVzICclKE8pKQogICAgcHNiKCclcyBbJXMwMSVzXSAlc0NyYWNrIFBVQkxJQyBJRCAnJShILFAsSCxIKSkKICAgIHBzYignJXMgWyVzMDIlc10gJXNDcmFjayBGUk9NIEZPTExPV0VSIElEIFYxJyUoSCxQLEgsQjEpKQogICAgcHNiKCclcyBbJXMwNCVzXSAlc0NyYWNrIEZST00gU0VBUkNIIE5BTUUgSUQgJyUoSCxQLEgsTzEpKQogICAgcHNiKCclcyBbJXMwNSVzXSAlc0NyYWNrIEZST00gTUVTU0FHRSBMSVNUIElEICclKEgsUCxILEsxKSkKICAgIHBzYignJXMgWyVzMDYlc10gJXNDcmFjayBGUk9NIFBPU1QgUkVBQ1RTICclKEgsUCxILEgxKSkKICAgIHBzYignJXMgWyVzMDclc10gJXNDcmFjayBGUk9NIFBPU1QgQ09NTUVOVFMgJyUoSCxQLEgsQjEpKQogICAgcHNiKCclcyBbJXMwOCVzXSAlc0NyYWNrIEZST00gR1JPVVAgTUVNQkVSUyAnJShILFAsSCxNMSkpCiAgICBwc2IoJyVzIFslczA5JXNdICVzQ3JhY2sgSUQgRlJPTSBFTUFJTCclKEgsUCxILE8pKQogICAgcHNiKCclcyBbJXMxMCVzXSAlc0NyYWNrIFVTRVJOQU1FJyUoSCxQLEgsSykpCiAgICBwc2IoJyVzIFslczExJXNdICVzQ3JhY2sgRlJPTSBIQVNIVEFHJyUoSCxQLEgsQjEpKQogICAgcHNiKCclcyBbJXMxMiVzXSAlc0NyYWNrIElEIEZST00gSE9NRSBQQUdFJyUoSCxQLEgsUDEpKQogICAgcHNiKCclcyBbJXMxMyVzXSAlc0NyYWNrIElEIEZST00gRlJJRU5EIFJFUVVFU1RTICclKEgsUCxILEsxKSkKICAgIHBzYignJXMgWyVzMTQlc10gJXNDcmFjayBGUk9NIFNFTlQgUkVRVUVTVFMgJyUoSCxQLEgsSDEpKQogICAgcHNiKCclcyBbJXMxNSVzXSAlc0NyYWNrIFVJRCBGUk9NIFBVQkxJQyBJRCclKEgsUCxILE8pKQogICAgcHNiKCclcyBbJXMxNiVzXSAlc0NyYWNrIEFVVE8gQ0xPTkUgQ1JBQ0tFRCBJRFMnJShILFAsSCxLKSkKICAgIHBzYignJXMgWyVzMTclc10gJXNWSUVXIENMT05FIFJFU1VMVFMgJyUoSCxQLEgsUCkpCiAgICBwc2IoJyVzIFslczE4JXNdICVzVVNFUiBBR0VOVCBTRVRUSU5HUyAnJShILFAsSCxNKSkKICAgIHBzYignJXMgWyVzMTklc10gJXMgRklMRSclKEgsUCxILEgpKQogICAgcHNiKCclcyBbJXMwMCVzXSAlc0xPR09VVCclKEgsTSxILE0pKQogICAgcHJpbnQoJycpCiAgICBwbSA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXM+XyVzXSAlc0NIT09TRSA6ICVzJyUoSCxQLEgsSyxIKSkKICAgIHByaW50KCclcyAnJShPKSkKICAgIGlmIHBtIGluIFsnJ106amFsYW4oJyVzIFslcyElc10gJXNJTkNPUlJFQ1QgQ09OVEVOVCclKFAsTSxQLE0pKTttZW51KCkKICAgIGVsaWYgcG0gaW4gWycxJywnMDEnLCcwMDEnLCdhJ106cHVibGlrKHRva2VuKQogICAgZWxpZiBwbSBpbiBbJzInLCcwMicsJzAwMicsJ2InXTpwZW5naWt1dCh0b2tlbikKICAgIGVsaWYgcG0gaW4gWyczJywnMDMnLCcwMDMnLCdjJ106Y2VrX2RldigpO2ZvbGxvd2Vycyhfc2Fsc2FiaWxhXykKICAgIGVsaWYgcG0gaW4gWyc0JywnMDQnLCcwMDQnLCdkJ106Y2VrX2RldigpO2R1bXBfbmFtZShfc2Fsc2FiaWxhXykKICAgIGVsaWYgcG0gaW4gWyc1JywnMDUnLCcwMDUnLCdlJ106Y2VrX2RldigpO2R1bXBfcGVzYW4oX3NhbHNhYmlsYV8sbixpKQogICAgZWxpZiBwbSBpbiBbJzYnLCcwNicsJzAwNicsJ2YnXTpjZWtfZGV2KCk7bWFpbl9saWtlcnMoX3NhbHNhYmlsYV8pCiAgICBlbGlmIHBtIGluIFsnNycsJzA3JywnMDA3JywnZyddOmNla19kZXYoKTttYWluX2tvbWVuKF9zYWxzYWJpbGFfKQogICAgZWxpZiBwbSBpbiBbJzgnLCcwOCcsJzAwOCcsJ2gnXTpjZWtfZGV2KCk7ZHVtcF9ncnVwKF9zYWxzYWJpbGFfLF9hemltdmF1XykKICAgIGVsaWYgcG0gaW4gWyc5JywnMDknLCcwMDknLCdpJ106ZHVtcF9lbWFpbCgpCiAgICBlbGlmIHBtIGluIFsnMTAnLCcwMTAnLCcwMDEwJywnaiddOmR1bXBfdXNlcm5hbWUoKQogICAgZWxpZiBwbSBpbiBbJzExJywnMDExJywnMDAxMScsJ2snXTpjZWtfZGV2KCk7aGFzaHRhZyhfc2Fsc2FiaWxhXykKICAgIGVsaWYgcG0gaW4gWycxMicsJzAxMicsJzAwMTInLCdsJ106Y2VrX2RldigpO2JlcmFuZGEoX3NhbHNhYmlsYV8pCiAgICBlbGlmIHBtIGluIFsnMTMnLCcwMTMnLCcwMDEzJywnbSddOmNla19kZXYoKTtwZXJtaW50YWFuX3BlcnRlbWFuYW5fbWFzdWsoX3NhbHNhYmlsYV8pCiAgICBlbGlmIHBtIGluIFsnMTQnLCcwMTQnLCcwMDE0JywnbiddOmNla19kZXYoKTtwZXJtaW50YWFuX3BlcnRlbWFuYW5fa2VsdWFyKF9zYWxzYWJpbGFfKQogICAgZWxpZiBwbSBpbiBbJzE1JywnMDE1JywnMDAxNScsJ28nXTp0ZW1hbl90YXJnZXQoKQogICAgZWxpZiBwbSBpbiBbJzE2JywnMDE2JywnMDAxNicsJ3AnXTpjZWtfcmVzdWx0KCkKICAgIGVsaWYgcG0gaW4gWycxNycsJzAxNycsJzAwMTcnLCdxJ106cmVzdWx0KCkKICAgIGVsaWYgcG0gaW4gWycxOCcsJzAxOCcsJzAwMTgnLCdyJ106dWdlbigpCiAgICBlbGlmIHBtIGluIFsnMTknLCcwMTknLCcwMDE5JywncyddOmZpbGUoKQogICAgZWxpZiBwbSBpbiBbJzAnLCcwMCcsJzAwMCcsJ3onXTpqYWxhbignJXMgWyVzISVzXSAlc1NFRSBZT1UgJXMlcyVzJyUoSCxQLEgsSyxPLG4sUCkpO2JlcnNpaCgpO21lbnVfbG9nKCkKICAgIGVsc2U6amFsYW4oJyVzIFslcyElc10gJXNJTkNPUlJFQ1QgQ09OVEVOVCclKE0sUCxNLFApKTttZW51KCkKCgpkZWYgZGVmYXVsdHVhKCk6CiAgICB1YSA9IHVhX3hpYW9taQogICAgdHJ5OnVnZW50ID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3cnKTt1Z2VudC53cml0ZSh1YSk7dWdlbnQuY2xvc2UoKQogICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yKTptZW51X2xvZygpCgoKZGVmIHVnZW4oKToKICAgIHZhcl91Z2VuKCkKICAgIHBtdSA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNDSE9PU0UgOiAnJShILFAsSCxLKSkKICAgIHByaW50KCclcyAnJShPKSkKICAgIGlmIHBtdSBpblsiIl06amFsYW4oJyVzIFslcyElc10gJXNJTkNPUlJFQ1QgQ09OVEVOVCclKE0sUCxNLFApKTttZW51KCkKICAgIGVsaWYgcG11IGluIFsnMScsJzAxJywnMDAxJywnYSddOm9zLnN5c3RlbSgneGRnLW9wZW4gaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zZWFyY2g/cT1NeStVc2VyK0FnZW50Jm9xPU15K1VzZXIrQWdlbnQmYXFzPWNocm9tZS4uNjlpNTdqMGwzajBpMjJpMzBsNi40Njc0ajBqMSZzb3VyY2VpZD1jaHJvbWUmaWU9VVRGLTgnKTtfY2ljaV9hemltdmF1XygnJXMgWyAlc0JBQ0sgJXNdJXMnJShNLFAsTSxLKSk7bWVudSgpCiAgICBlbGlmIHBtdSBpbiBbJzInLCcwMicsJzAwMicsJ2InXToKICAgICAgICBvcy5zeXN0ZW0oInJtIC1yZiB1Z2VudC50eHQiKTt1YSA9IF9jaWNpX2F6aW12YXVfKCIlcyBbJXPigKIlc10gJXNFTlRFUiBVU0VSIEFHRU5UIDogXG5cbiIlKEgsUCxILEspKQogICAgICAgIHRyeTp1Z2VudCA9IF9hemltdmF1X2RhcHVudGFfKCd1Z2VudC50eHQnLCd3Jyk7dWdlbnQud3JpdGUodWEpO3VnZW50LmNsb3NlKCk7amFsYW4oIlxuJXMgWyAlc1NVQ0NFU1NGVUxMWSBDSEFOR0VEIFVTRVIgQUdFTlQgJXNdIiUoSCxQLEgpKTtwcmludCgnJXMgJyUoTykpO19jaWNpX2F6aW12YXVfKCclcyBbICVzQkFDSyAlc10lcyclKEgsUCxILEspKTttZW51KCkKICAgICAgICBleGNlcHQgKEtleUVycm9yLElPRXJyb3IpOmphbGFuKCJcbiVzIFsgJXNGQUlMRUQgVE8gQ0hBTkdFIFVTRVIgQUdFTlQgJXNdIiUoWixNLFopKTtwcmludCgnJXMgJyUoTSkpO19jaWNpX2F6aW12YXVfKCclcyBbICVzQkFDSyAlc10lcyclKE0sUCxNLFApKTttZW51KCkKICAgIGVsaWYgcG11IGluIFsnMycsJzAzJywnMDAzJywnYyddOnVnZW5faHAoKQogICAgZWxpZiBwbXUgaW4gWyc0JywnMDQnLCcwMDQnLCdkJ106b3Muc3lzdGVtKCJybSAtcmYgdWdlbnQudHh0Iik7amFsYW4oIiVzIFsgJXNVU0VSIEFHRU5UIFNVQ0NFU1NGVUxMWSBERUxFVEVEICVzXSIlKEgsUCxIKSk7cHJpbnQoJyVzICclKE8pKTtfY2ljaV9hemltdmF1XygnJXMgWyAlc0JBQ0sgJXNdJXMnJShILFAsSCxLKSk7bWVudSgpCiAgICBlbGlmIHBtdSBpbiBbJzUnLCcwNScsJzAwNScsJ2UnXToKICAgICAgICB0cnk6dW5nc2VyID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsICdyJykucmVhZCgpCiAgICAgICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yKTp1bmdzZXIgPSAnTk9UIEZPVU5EJwogICAgICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNZT1VSIFVTRVIgQUdFTlQgIDogXG5cbiVzJXMiJShILFAsSCxQLE8sdW5nc2VyKSk7amFsYW4oIlxuJXMgWyAlc1RISVMgSVMgWU9VUiBDVVJSRU5UIFVTRVIgQUdFTlQgJXNdIiUoSCxLLEgpKTtwcmludCgnJXMgJyUoTykpO19jaWNpX2F6aW12YXVfKCclcyBbICVzQkFDSyAlc10lcyclKEgsUCxILEspKTttZW51KCkKICAgIGVsaWYgcG11IGluIFsnMCcsJzAwJywnMDAwJywnZiddOm1lbnUoKQogICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpCmRlZiB1Z2VuX2hwKCk6CiAgICBvcy5zeXN0ZW0oInJtIC1yZiB1Z2VudC50eHQiKQogICAgcHJpbnQoJyVzIFslczElc10gJUlOVEVMTUFDJyUoSCxQLEgsSykpCiAgICBwcmludCgnJXMgWyVzMiVzXSAlc05PS0lBJyUoSCxQLEgsSCkpCiAgICBwcmludCgnJXMgWyVzMyVzXSAlc0FTVVMnJShILFAsSCxNKSkKICAgIHByaW50KCclcyBbJXM0JXNdICVzSFVBV0VJJyUoSCxQLEgsQikpCiAgICBwcmludCgnJXMgWyVzNSVzXSAlc1ZJVk8nJShILFAsSCxPKSkKICAgIHByaW50KCclcyBbJXM2JXNdICVzT1BQTyclKEgsUCxILEspKQogICAgcHJpbnQoJyVzIFslczclc10gJXNTQU1TVU5HJyUoSCxQLEgsQikpCiAgICBwcmludCgnJXMgWyVzOCVzXSAlc1dJTkRPV1MnJShILFAsSCxNKSkKICAgIHByaW50KCclcyBbJXM5JXNdICVzWElBT01JJyUoSCxQLEgsTSkpCiAgICBwcmludCgnJykKICAgIHBjID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0NIT09TRSA6ICclKEgsUCxILEspKQogICAgcHJpbnQoJyVzICclKE8pKQogICAgaWYgcGMgaW5bJyddOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxNKSk7bWVudSgpCiAgICBlbGlmIHBjIGluIFsnMScsJzAxJ106dWdlbnQgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywndycpO3VnZW50LndyaXRlKHVhX3hpYW9taSk7dWdlbnQuY2xvc2UoKQogICAgZWxpZiBwYyBpbiBbJzInLCcwMiddOnVnZW50ID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3cnKTt1Z2VudC53cml0ZSh1YV9ub2tpYSk7dWdlbnQuY2xvc2UoKQogICAgZWxpZiBwYyBpbiBbJzMnLCcwMyddOnVnZW50ID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3cnKTt1Z2VudC53cml0ZSh1YV9hc3VzKTt1Z2VudC5jbG9zZSgpCiAgICBlbGlmIHBjIGluIFsnNCcsJzA0J106dWdlbnQgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywndycpO3VnZW50LndyaXRlKHVhX2h1YXdlaSk7dWdlbnQuY2xvc2UoKQogICAgZWxpZiBwYyBpbiBbJzUnLCcwNSddOnVnZW50ID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3cnKTt1Z2VudC53cml0ZSh1YV92aXZvKTt1Z2VudC5jbG9zZSgpCiAgICBlbGlmIHBjIGluIFsnNicsJzA2J106dWdlbnQgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywndycpO3VnZW50LndyaXRlKHVhX29wcG8pO3VnZW50LmNsb3NlKCkKICAgIGVsaWYgcGMgaW4gWyc3JywnMDcnXTp1Z2VudCA9IF9hemltdmF1X2RhcHVudGFfKCd1Z2VudC50eHQnLCd3Jyk7dWdlbnQud3JpdGUodWFfc2Ftc3VuZyk7dWdlbnQuY2xvc2UoKQogICAgZWxpZiBwYyBpbiBbJzgnLCcwOCddOnVnZW50ID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3cnKTt1Z2VudC53cml0ZSh1YV93aW5kb3dzKTt1Z2VudC5jbG9zZSgpCiAgICBlbGlmIHBjIGluIFsnOScsJzA5J106dWdlbnQgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywndycpO3VnZW50LndyaXRlKHVhX2ludGVsbWFjKTt1Z2VudC5jbG9zZSgpCiAgICBlbHNlOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICBqYWxhbigiJXMgWyAlc1NVQ0NFU1NGVUxMWSBDSEFOR0VEIFVTRVIgQUdFTlQgJXNdIiUoSCxQLEgpKTtwcmludCgnJXMgJyUoTykpO19jaWNpX2F6aW12YXVfKCclcyBbICVzQkFDSyAlc10lcyclKE0sUCxNLFApKTttZW51KCkKCgpkZWYgcHVibGlrKHRva2VuKToKICAgIGppZCA9ICc1MDAwJwogICAgdHJ5OgogICAgICAgIHByaW50KCclcyBbJXPigKIlc10gJXNXUklURSBcJ21lXCcgVE8gUkVUUklFVkUgRlJJRU5EIElEJyUoSCxQLEgsSykpO2l0ID0gX2NpY2lfYXppbXZhdV8oIiVzIFslc+KAoiVzXSAlc1RBUkdFVCBJRCA6ICIlKEgsUCxILEspKTtjZWtfdGFyZ2V0X2NyYWNrXyhpdCkKICAgICAgICB0cnk6cGIgPSBfcmVxX2dldF8oImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyIgKyBpdCArICI/ZmllbGRzPW5hbWUsaWQsZmlyc3RfbmFtZSxtaWRkbGVfbmFtZSxsYXN0X25hbWUsbmFtZV9mb3JtYXQscGljdHVyZSxzaG9ydF9uYW1lJmFjY2Vzc190b2tlbj0iICsgdG9rZW4pO29iID0gX2pzX2xvXyhwYi50ZXh0KTtwcmludCAoJyVzIFslc+KAoiVzXSAlc05BTUUgOiAlcyclKEgsUCxILEssb2JbJ25hbWUnXSkpCiAgICAgICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yKTpwcmludCgnJXMgJyUoTykpO2phbGFuKCclcyBbJXMhJXNdICVzSUQgTk9UIEZPVU5EJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgIHIgPSBfcmVxX2dldF8oImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzL2ZyaWVuZHM/bGltaXQ9JXMmZmllbGRzPW5hbWUsaWQsZmlyc3RfbmFtZSxtaWRkbGVfbmFtZSxsYXN0X25hbWUsbmFtZV9mb3JtYXQscGljdHVyZSxzaG9ydF9uYW1lJmFjY2Vzc190b2tlbj0lcyIlKGl0LGppZCx0b2tlbikpO2lkID0gW107eiA9IF9qc19sb18oci50ZXh0KTt4YyA9IChvYlsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIik7eGIgPSBfYXppbXZhdV9kYXB1bnRhXyh4YywidyIpCiAgICAgICAgZm9yIGEgaW4gelsiZGF0YSJdOgogICAgICAgICAgICB0cnk6aWQuYXBwZW5kKGFbImlkIl0rIuKAoiIrYVsibmFtZSJdKTt4Yi53cml0ZShhWyJpZCJdKyLigKIiK2FbIm5hbWUiXSsiXG4iKQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICB4Yi5jbG9zZSgpO3ByaW50KCclcyBbJXPigKIlc10gJXNUT1RBTCBJRCA6ICVzJyUoSCxQLEgsSyxsZW4oaWQpKSk7cmV0dXJuIGNyYWNrKHhjKQogICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yKTpfY2ljaV9jaWNpXygnJXMgWyVzISVzXSAlc0lOVkFMSUQgVE9LRU4vQ09PS0lFUyBPUiBJRCBOT1QgRk9VTkQnJShNLFAsTSxQKSkKCgpkZWYgcGVuZ2lrdXQodG9rZW4pOgogICAgdHJ5OgogICAgICAgIGppZCA9ICcxMDAwMCcKICAgICAgICB4ID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9tZT9hY2Nlc3NfdG9rZW49IiArIHRva2VuKQogICAgICAgIHkgPSBqc29uLmxvYWRzKHgudGV4dCkKICAgICAgICBuID0geVsnbmFtZSddLnVwcGVyKCkKICAgIGV4Y2VwdCAoS2V5RXJyb3IsSU9FcnJvcik6CiAgICAgICAgeG94KCclcyBbJXMhJXNdICVzSU5WQUxJRCBUT0tFTi9DT09LSUVTJyUoTSxQLE0sUCkpCiAgICAgICAgb3Muc3lzdGVtKCdybSAtcmYgdG9rZW4udHh0JykKICAgICAgICBtZW51X2xvZygpCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6CiAgICAgICAgeG94KCclcyBbJXMhJXNdICVzQ09OTkVDVElPTiBQUk9CTEVNJyUoTSxQLE0sUCkpCiAgICAgICAgZXhpdCgpCiAgICB0cnk6CiAgICAgICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc1dSSVRFIFwnbWVcJyBGT1IgVEFLSU5HIEZSSUVORCBJRCclKEgsUCxILEspKQogICAgICAgIGl0ID0gaW5wdXQoIiVzIFslc+KAoiVzXSAlc1RBUkdFVCBJRCA6ICVzIiUoSCxQLEgsSyxIKSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHBiID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iICsgaXQgKyAiP2FjY2Vzc190b2tlbj0iICsgdG9rZW4pCiAgICAgICAgICAgIG9iID0ganNvbi5sb2FkcyhwYi50ZXh0KQogICAgICAgICAgICBwcmludCAoJyVzIFslc+KAoiVzXSAlc05BTUUgOiAlcyVzJyUoSCxQLEgsTyxILG9iWyduYW1lJ10udXBwZXIoKSkpCiAgICAgICAgZXhjZXB0IChLZXlFcnJvcixJT0Vycm9yKToKICAgICAgICAgICAgcHJpbnQKICAgICAgICAgICAgeG94KCclcyBbJXMhJXNdICVzSUQgTk9UIEZPVU5EJyUoTSxQLE0sUCkpCiAgICAgICAgICAgIG1lbnUoKQogICAgICAgIHIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzL3N1YnNjcmliZXJzP2xpbWl0PSVzJmFjY2Vzc190b2tlbj0lcyIlKGl0LGppZCx0b2tlbikpCiAgICAgICAgaWQgPSBbXQogICAgICAgIHogPSBqc29uLmxvYWRzKHIudGV4dCkKICAgICAgICB4YyA9IChvYlsiZmlyc3RfbmFtZSJdKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKICAgICAgICB4YiA9IG9wZW4oeGMsInciKQogICAgICAgIGZvciBhIGluIHpbImRhdGEiXToKICAgICAgICAgICAgaWQuYXBwZW5kKGFbImlkIl0rIuKAoiIrYVsibmFtZSJdKQogICAgICAgICAgICB4Yi53cml0ZShhWyJpZCJdKyLigKIiK2FbIm5hbWUiXSsiXG4iKQogICAgICAgIHhiLmNsb3NlKCkKICAgICAgICBwcmludCgnJXMgWyVz4oCiJXNdICVzQUxMIElEIDogJXMlcyclKEgsUCxILE8sSCxsZW4oaWQpKSkKICAgICAgICByZXR1cm4gY3JhY2soeGMpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgZXhpdCgnJXMgWyVzISVzXSAlc0VSUk9SIDogJXMnJShNLFAsTSxQLGUpKQoKCgpkZWYgZm9sbG93ZXJzKGNvb2tpZXMpOgogICAgX3F1ZXJ5XyA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNFTlRFUiBUQVJHRVQgSUQgOiAnJShILFAsSCxLKSk7cHJpbnQoIiVzIFslc+KAoiVzXSAlc1BSRVNTIENUUkwrQyBUTyBTVE9QIERVTVAiJShILFAsSCxLKSk7X2ZpbGVfID0gX3F1ZXJ5XysnLmpzb24nO191cmxfZGV2XyA9ICdodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vc3Vic2NyaWJlL2xpc3RzLz9pZD0nICsgX3F1ZXJ5XztfZmlsZV8gPSAoX3F1ZXJ5XysnLmpzb24nKS5yZXBsYWNlKCcgJywnXycpCiAgICB0cnk6b3MucmVtb3ZlKF9maWxlXykKICAgIGV4Y2VwdDpwYXNzCiAgICBleGVjX2ZvbGxvd2VycyhfdXJsX2Rldl8sY29va2llcyxfZmlsZV8pO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgZXhlY19mb2xsb3dlcnModXJsLGNvb2tpZXMsX2ZpbGVfKToKICAgIG9wZW4oX2ZpbGVfLCdhJyk7X3JlcV9zZXNfID0gcmVxdWVzdHMuU2Vzc2lvbigpO19yZXFfZ2V0XyA9IF9yZXFfc2VzXy5nZXQodXJsLGNvb2tpZXM9Y29va2llcyk7X3NvcF9kZXZfID0gcGFyKF9yZXFfZ2V0Xy50ZXh0LCdodG1sLnBhcnNlcicpO19idWthX2ZpbGVfID0gb3BlbihfZmlsZV8pLnJlYWQoKTtwcmludCgiXHIlcyBbJXPigKIlc10gJXNUQUtJTkcgJXMlcyBJRCIlKEgsUCxILEssSCxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgdHJ5OgogICAgICAgIGZvciBfY2ljaV8gaW4gX3NvcF9kZXZfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICBpZiAicHJvZmlsZS5waHAiIGluIF9jaWNpXy5nZXQoJ2hyZWYnKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBfbmFtZV9kZXZfID0gX2NpY2lfLnRleHQ7X2lkX2Rldl8gPSAiIi5qb2luKGJzNC5yZS5maW5kYWxsKCJwcm9maWxlXC5waHBcP2lkPSguKj8pJiIsX2NpY2lfLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICBpZiBfbmFtZV9kZXZfIGluIF9idWthX2ZpbGVfOnBhc3MKICAgICAgICAgICAgICAgICAgICBlbGlmICcvJyBpbiBfaWRfZGV2XzpwYXNzCiAgICAgICAgICAgICAgICAgICAgZWxzZTpvcGVuKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoX2lkX2Rldl8sX25hbWVfZGV2XykpCiAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICBlbHNlOnBhc3MKICAgICAgICBmb3IgX2NpY2lfIGluIF9zb3BfZGV2Xy5maW5kX2FsbCgnYScsaHJlZj1UcnVlKToKICAgICAgICAgICAgaWYgJ1NlZSBtb3JlJyBpbiBfY2ljaV8udGV4dDp1cmxfZGV2ID0gJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8nICsgX2NpY2lfLmdldCgnaHJlZicpO2V4ZWNfZm9sbG93ZXJzKHVybF9kZXYsY29va2llcyxfZmlsZV8pCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSkpO3JldHVybiBjcmFjayhfZmlsZV8pCgoKCmRlZiBtYWluX2xpa2VycyhfYXppbXZhdV8pOgogICAgX3F1ZXJ5XyA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNFTlRFUiBQT1NUIElEIDogJyUoSCxQLEgsSykpO3ByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpO19maWxlXyA9IF9xdWVyeV8rJy5qc29uJwogICAgdHJ5Om9zLnJlbW92ZShfcXVlcnlfKycuanNvbicpCiAgICBleGNlcHQ6cGFzcwogICAgX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCd3Jyk7X3VybF8gPSAoJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS91ZmkvcmVhY3Rpb24vcHJvZmlsZS9icm93c2VyLz9mdF9lbnRfaWRlbnRpZmllcj0nK19xdWVyeV8pO3NjcmFwZV9saWtlcnMoX2F6aW12YXVfLF91cmxfLF9maWxlXykKICAgIGlmIGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpID09IDA6cHJpbnQoJ1xuJXMgWyVzISVzXSAlc1BPU1QgTk9UIEZPVU5EJyUoTSxQLE0sUCkpO19jaWNpX2NpY2lfKCkKICAgIHByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgc2NyYXBlX2xpa2VycyhfYXppbXZhdV8sX3VybF8sX2ZpbGVfKToKICAgIF9zZXNfID0gX3JlcV9zZXNfO191cmxfbG9hZF8gPSBfc2VzXy5nZXQoX3VybF8sY29va2llcz1fYXppbXZhdV8saGVhZGVycz1oZWFkZXJfZ3J1cCkudGV4dC5lbmNvZGUoInV0Zi04Iik7X3Nlc19wYXJfID0gcGFyKF91cmxfbG9hZF8sJ2h0bWwucGFyc2VyJyk7cHJpbnQoIlxyJXMgWyVz4oCiJXNdICVzVEFLSU5HICVzJXMgSUQiJShILFAsSCxLLEgsbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpLCBlbmQ9JyAnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIHRyeTogCiAgICAgICAgZm9yIF9pc2lfIGluIF9zZXNfcGFyXy5maW5kX2FsbCgnaDMnKToKICAgICAgICAgICAgZm9yIF9pZF8gaW4gX2lzaV8uZmluZF9hbGwoJ2EnLGhyZWY9VHJ1ZSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgInByb2ZpbGUucGhwIiBpbiBfaWRfLmdldCgiaHJlZiIpOl9hXyA9IF9pZF8uZ2V0KCJocmVmIikuc3BsaXQoJz0nKVsxXTtfX2lkX18gPSBfaWRfLnRleHQ7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKF9hXysn4oCiJytfX2lkX18rJ1xuJykKICAgICAgICAgICAgICAgICAgICBlbHNlOl9hXyA9IF9pZF8uZ2V0KCJocmVmIikuc3BsaXQoJy8nKVsxXTtfX2lkX18gPSBfaWRfLnRleHQ7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKF9hXysn4oCiJytfX2lkX18rJ1xuJykKICAgICAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgIGZvciBfbGFuanV0XyBpbiBfc2VzX3Bhcl8uZmluZF9hbGwoImEiLGhyZWY9VHJ1ZSk6CiAgICAgICAgICAgIGlmICJTZWUgbW9yZSIgaW4gX2xhbmp1dF8udGV4dDoKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OnNjcmFwZV9saWtlcnMoX2F6aW12YXVfLCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vIitfbGFuanV0Xy5nZXQoImhyZWYiKSxfZmlsZV8pO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCclcyVzJyUoTSxlKSkKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDpwcmludCgiXG4lcyBbJXPigKIlc10gJXNTVUNDRVNTRlVMIERVTVAgJXMgSUQiJShILFAsSCxLLGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSk7cmV0dXJuIGNyYWNrKF9maWxlXykKCgpkZWYgbWFpbl9rb21lbihfYXppbXZhdV8pOgogICAgX3F1ZXJ5XyA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNFTlRFUiBQT1NUIElEIDogJyUoSCxQLEgsSykpO3ByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpO19maWxlXyA9IF9xdWVyeV8rJy5qc29uJwogICAgdHJ5Om9zLnJlbW92ZShfcXVlcnlfKycuanNvbicpCiAgICBleGNlcHQ6cGFzcwogICAgX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCd3Jyk7X3VybF8gPSAoJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS8nK19xdWVyeV8pO3NjcmFwZV9rb21lbihfYXppbXZhdV8sX3VybF8sX2ZpbGVfKQogICAgaWYgbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkgPT0gMDpwcmludCgnXG4lcyBbJXMhJXNdICVzUE9TVCBOT1QgRk9VTkQnJShNLFAsTSxQKSk7X2NpY2lfY2ljaV8oKQogICAgcHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSkpO3JldHVybiBjcmFjayhfZmlsZV8pCmRlZiBzY3JhcGVfa29tZW4oX2F6aW12YXVfLF91cmxfLF9maWxlXyk6CiAgICBfc2VzXyA9IF9yZXFfc2VzXztfdXJsX2xvYWRfID0gX3Nlc18uZ2V0KF91cmxfLGNvb2tpZXM9X2F6aW12YXVfLGhlYWRlcnM9aGVhZGVyX2dydXApLnRleHQuZW5jb2RlKCJ1dGYtOCIpO19zZXNfcGFyXyA9IHBhcihfdXJsX2xvYWRfLCdodG1sLnBhcnNlcicpO3ByaW50KCJcciVzIFslc+KAoiVzXSAlc1RBS0lORyAlcyVzIElEIiUoSCxQLEgsSyxILGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSwgZW5kPScgJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICB0cnk6IAogICAgICAgIGZvciBfaXNpXyBpbiBfc2VzX3Bhcl8uZmluZF9hbGwoJ2gzJyk6CiAgICAgICAgICAgIGZvciBfaWRfIGluIF9pc2lfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmICJwcm9maWxlLnBocCIgaW4gX2lkXy5nZXQoImhyZWYiKTpfYV89IiIuam9pbihiczQucmUuZmluZGFsbCgicHJvZmlsZVwucGhwXD9pZD0oLio/KSYiLF9pZF8uZ2V0KCJocmVmIikpKTtfX2lkX18gPSBfaWRfLnRleHQ7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKHN0cihfYV8pLnNwbGl0KCcmJylbMF0rJ+KAoicrX19pZF9fKydcbicpCiAgICAgICAgICAgICAgICAgICAgZWxzZTpfYV89IiIuam9pbihiczQucmUuZmluZGFsbCgiLyguKj8pXD8iLF9pZF8uZ2V0KCJocmVmIikpKTtfX2lkX18gPSBfaWRfLnRleHQ7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKHN0cihfYV8pLnNwbGl0KCc/JylbMF0rJ+KAoicrX19pZF9fKydcbicpCiAgICAgICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBmb3IgX2xhbmp1dF8gaW4gX3Nlc19wYXJfLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgogICAgICAgICAgICBpZiAiVmlldyBtb3JlIGNvbW1lbnRz4oCmIiBpbiBfbGFuanV0Xy50ZXh0OgogICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICB0cnk6c2NyYXBlX2tvbWVuKF9hemltdmF1XywiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIrX2xhbmp1dF8uZ2V0KCJocmVmIiksX2ZpbGVfKTticmVhawogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgnJXMlcyclKE0sZSkpCiAgICAgICAgICAgIGVsaWYgIlZpZXcgcHJldmlvdXMgY29tbWVudHPigKYiIGluIF9sYW5qdXRfLnRleHQ6CiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgICAgIHRyeTpzY3JhcGVfbGlrZXJzKF9hemltdmF1XywiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIrX2xhbmp1dF8uZ2V0KCJocmVmIiksX2ZpbGVfKTticmVhawogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCgnJXMlcyclKE0sZSkpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSkpO3JldHVybiBjcmFjayhfZmlsZV8pCgoKY2xhc3MgZHVtcF9ncnVwOgogICAgZGVmIF9faW5pdF9fKHNlbGYsX2F6aW12YXVfLF9jaWNpXyk6CiAgICAgICAgc2VsZi5nbGlzdD1bXTtzZWxmLl9ncnVwXz1bXTtzZWxmLmlkPSdfX2F6aW12YXVfXy5qc29uJztzZWxmLnRva2VuPV9jaWNpXztzZWxmLmNvb2tpZXM9X2F6aW12YXVfO3NlbGYuaGVhZGVyID0geyJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMDsgTWkgOVQgUHJvIEJ1aWxkL1FLUTEuMTkwODI1LjAwMjsgd3YpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vNC4wIENocm9tZS84OC4wLjQzMjQuMTgxIE1vYmlsZSBTYWZhcmkvNTM3LjM2IFtGQkFOL0VNQTtGQkxDL2VuX1VTO0ZCQVYvMTczLjAuMC4xMC4xMTg7XSJ9O3NlbGYubWFpbl9ncm91cCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9ncm91cHMvP3NlZW1vcmUiKQogICAgZGVmIG1haW5fZ3JvdXAoc2VsZiwgdXJsX2Rldik6CiAgICAgICAgYnM9YnM0LkJlYXV0aWZ1bFNvdXAoX3JlcV9nZXRfKHVybF9kZXYsY29va2llcz1zZWxmLmNvb2tpZXMsaGVhZGVycz1zZWxmLmhlYWRlcikudGV4dCwiaHRtbC5wYXJzZXIiKQogICAgICAgIGZvciBfY2ljaV8gaW4gYnMuZmluZF9hbGwoImEiLGhyZWY9VHJ1ZSk6CiAgICAgICAgICAgIGlmICIvZ3JvdXBzLyIgaW4gX2NpY2lfLmdldCgiaHJlZiIpOgogICAgICAgICAgICAgICAgaWYgImNhdGVnb3J5IiBpbiBfY2ljaV8uZ2V0KCJocmVmIikgb3IgImNyZWF0ZSIgaW4gX2NpY2lfLmdldCgiaHJlZiIpOmNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbHNlOnNlbGYuZ2xpc3QuYXBwZW5kKHsiaWQiOiIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoIi9ncm91cHMvKC4qPylcPyIsX2NpY2lfLmdldCgiaHJlZiIpKSksIm5hbWUiOl9jaWNpXy50ZXh0fSkKICAgICAgICBpZiBsZW4oc2VsZi5nbGlzdCkgIT0wOgogICAgICAgICAgICBwcmludCgiJXMgWyVz4oCiJXNdICVzWU9VIEpPSU4gJXMlcyVzIEdST1VQIiUoSCxQLEgsSyxPLGxlbihzZWxmLmdsaXN0KSxQKSk7cHJpbnQoJyVzIFslczElc10gJXNTRUFSQ0ggQUxMIEdST1VQUyBKT0lOJyUoSCxQLEgsSykpO3ByaW50KCclcyBbJXMyJXNdICVzU0VBUkNIIEdST1VQUyBCWSBOQU1FJyUoSCxQLEgsSykpO3ByaW50KCclcyBbJXMzJXNdICVzU0VBUkNIIEdST1VQUyBCWSBJRCclKEgsUCxILEspKQogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgYz1fY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzQ0hPT1NFIDogJyUoSCxQLEgsSykpO3ByaW50KCclcyAnJShPKSkKICAgICAgICAgICAgICAgIGlmIGM9PSIiOmNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbGlmIGM9PSIxIjpzZWxmLnNheWEoKQogICAgICAgICAgICAgICAgZWxpZiBjPT0iMiI6c2VsZi5zZWFyY2goKQogICAgICAgICAgICAgICAgZWxpZiBjPT0iMyI6c2VsZi5tYW51YWwoKQogICAgICAgICAgICAgICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgIGVsc2U6cHJpbnQoIiVzIFslc+KAoiVzXSAlc1lPVSBET04nVCBKT0lOIEFOWSBHUk9VUCIlKEgsUCxILEspKTtzZWxmLm1hbnVhbCgpCiAgICBkZWYgc2F5YShzZWxmKToKICAgICAgICBzZWxmLmZsPShzZWxmLmlkKQogICAgICAgIHRyeTpvcy5yZW1vdmUoc2VsZi5mbCkKICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpCiAgICAgICAgdHJ5OiAKICAgICAgICAgICAgdXJsID0gImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL21lL2dyb3Vwcz9hY2Nlc3NfdG9rZW49e30iLmZvcm1hdChzZWxmLnRva2VuKQogICAgICAgICAgICB3aXRoIF9yZXFfc2VzXyBhcyBzZXNfOgogICAgICAgICAgICAgICAgZGF0YSA9IHNlc18uZ2V0KHVybCkuanNvbigpCiAgICAgICAgICAgICAgICBmb3IgX2F6aW12YXVfIGluIGRhdGFbImRhdGEiXToKICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5fZ3J1cF8uYXBwZW5kKF9hemltdmF1X1siaWQiXSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICBmb3IgX2NpY2lfIGluIHNlbGYuX2dydXBfOgogICAgICAgICAgICAgICAgdHJ5OnNlbGYudXJsX2dydXAgPSAoImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9icm93c2UvZ3JvdXAvbWVtYmVycy8/aWQ9JXMiJShfY2ljaV8pKTtzZWxmLmV4ZWNfZ3J1cF9zYXlhKCk7cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIEZST00gTVkgR1JPVVAiJShILFAsSCxQLGxlbihfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSkpO3JldHVybiBjcmFjayhzZWxmLmZsKQogICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBGUk9NIE1ZIEdST1VQIiUoSCxQLEgsUCxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgX2Vycm9yXzpwcmludCgnXG4lcyBbJXMhJXNdICVzRVJST1IgSU4gU0VDVElPTiA6ICVzJyUoTSxQLE0sUCxfZXJyb3JfKSk7X2NpY2lfY2ljaV8oKQogICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsSU9FcnJvcik6amFsYW4oJyVzIFslcyElc10gJXNDT09LSUUgSU5WQUxJRCclKE0sUCxNLFApKTttZW51KCkKICAgICAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5Db25uZWN0aW9uRXJyb3I6amFsYW4oJyVzIFslcyElc10gJXNDT05ORUNUSU9OIFBST0JMRU0nJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBGUk9NIE1ZIEdST1VQIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIF9lcnJvcl86cHJpbnQoJ1xuJXMgWyVzISVzXSAlc0Vycm9yIERpIEJhZ2lhbiA6ICVzJyUoTSxQLE0sUCxfZXJyb3JfKSk7X2NpY2lfY2ljaV8oKQogICAgZGVmIGV4ZWNfZ3J1cF9zYXlhKHNlbGYpOgogICAgICAgIGdsb2JhbCBjb3VudAogICAgICAgIHdpdGggX3JlcV9zZXNfIGFzIHNlc186CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGEgPSBzZXNfLmdldChzZWxmLnVybF9ncnVwLCBjb29raWVzPXNlbGYuY29va2llcywgaGVhZGVycz1zZWxmLmhlYWRlcikuY29udGVudDtzb3BfZGV2ID0gcGFyKGRhdGEsICJodG1sLnBhcnNlciIpO21lbWJlcnMgPSBzb3BfZGV2LmZpbmQoImRpdiIsIGlkPSJvYmplY3RzX2NvbnRhaW5lciIpCiAgICAgICAgICAgICAgICBmb3IgZGV2IGluIG1lbWJlcnMuZmluZF9hbGwoInRhYmxlIik6CiAgICAgICAgICAgICAgICAgICAgdXNlcl8gPSBkZXZbImlkIl0ucmVwbGFjZSgibWVtYmVyXyIsICIiKTtuYW1hXyA9IHJlLmZpbmRhbGwoJzxpbWcgYWx0PSIoLiopLCBwcm9maWxlIHBpY3R1cmUiJywgc3RyKGRldikpWzBdCiAgICAgICAgICAgICAgICAgICAgdHJ5Ol9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwsJ2ErJykud3JpdGUoc3RyKHVzZXJfKSsi4oCiIitzdHIobmFtYV8pKyJcbiIpLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICAgICAgcHJpbnQoIlxyJXMgWyVz4oCiJXNdICVzVEFLSU5HICVzJXMgSUQiJShILFAsSCxLLEgsbGVuKF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSwgZW5kPScgJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICBpZiAiU2VlIG1vcmUiIGluIHN0cihzb3BfZGV2KTp1cmwgPSBzb3BfZGV2LmZpbmQoImEiLCBzdHJpbmc9IlNlZSBtb3JlIilbImhyZWYiXTt1cmxfZ3J1cCA9ICJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20iK3VybDtzZWxmLmV4ZWNfZ3J1cF9zYXlhKCkKICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBEYXJpIEdydXAgU2F5YSIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSk7cmV0dXJuIGNyYWNrKHNlbGYuZmwpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgX2Vycm9yXzpwcmludCgnXG4lcyBbJXMhJXNdICVzRXJyb3IgRGkgQmFnaWFuIDogJXMnJShNLFAsTSxQLF9lcnJvcl8pKTtfY2ljaV9jaWNpXygpCiAgICBkZWYgbWFudWFsKHNlbGYpOgogICAgICAgIGlkPV9jaWNpX2F6aW12YXVfKCIlcyBbJXPigKIlc10gJXNFTlRFUiBHUk9VUCBJRCA6ICIlKEgsUCxILEspKQogICAgICAgIGlmIGlkPT0iIjpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHI9YnM0LkJlYXV0aWZ1bFNvdXAoX3JlcV9nZXRfKCJodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8iK2lkLGhlYWRlcnM9aGVhZGVyX2dydXAsY29va2llcz1zZWxmLmNvb2tpZXMpLnRleHQsImh0bWwucGFyc2VyIikKICAgICAgICAgICAgaWYgIm5vIGNvbnRlbnQiIGluIHIuZmluZCgidGl0bGUiKS50ZXh0Lmxvd2VyKCk6amFsYW4oJyVzIFslcyElc10gJXNQUklWQVRFIEdST1VQIC8gV1JPTkcgSUQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlZD17ImlkIjppZCwibmFtZSI6ci5maW5kKCJ0aXRsZSIpLnRleHR9O3NlbGYuZihpZCk7cHJpbnQoJyVzICclKE8pKTtwcmludCgiJXMgWyVz4oCiJXNdICVzTkFNRSA6ICVzIiUoSCxQLEgsSyxzZWxmLmxpc3RlZC5nZXQoIm5hbWUiKSkpO3hkID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0R1bXAgSUQvVXNlcm5hbWU/IFtpL3VdIDogJyUoSCxQLEgsSykpO3ByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpCiAgICAgICAgICAgICAgICBpZiB4ZCBpbiBbJyddOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgICAgICAgICBlbGlmIHhkIGluIFsnaScsJ0knLCcxJ106CiAgICAgICAgICAgICAgICAgICAgdHJ5OnNlbGYuZHVtcF9pZCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9ncm91cHMvIitpZCk7cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIERhcmkgJXMiJShILFAsSCxLLGxlbihfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSxzZWxmLmxpc3RlZC5nZXQoIm5hbWUiKSkpO3JldHVybiBjcmFjayhzZWxmLmZsKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDpwcmludCgiXG4lcyBbJXPigKIlc10gJXNTVUNDRVNTRlVMIERVTVAgJXMgSUQgRGFyaSAlcyIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpLHNlbGYubGlzdGVkLmdldCgibmFtZSIpKSk7cmV0dXJuIGNyYWNrKHNlbGYuZmwpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBfZXJyb3JfOnByaW50KCdcbiVzIFslcyElc10gJXNFcnJvciBEaSBCYWdpYW4gOiAlcyclKE0sUCxNLFAsX2Vycm9yXykpO19jaWNpX2NpY2lfKCkKICAgICAgICAgICAgICAgIGVsaWYgeGQgaW4gWyd1JywnVScsJzInXToKICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5kdW1wX3VzZXJuYW1lKCJodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8iK2lkKTtwcmludCgiXG4lcyBbJXPigKIlc10gJXNTVUNDRVNTRlVMIERVTVAgJXMgSUQgRGFyaSAlcyIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpLHNlbGYubGlzdGVkLmdldCgibmFtZSIpKSk7cmV0dXJuIGNyYWNrKHNlbGYuZmwpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBGUk9NICVzIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksc2VsZi5saXN0ZWQuZ2V0KCJuYW1lIikpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIF9lcnJvcl86cHJpbnQoJ1xuJXMgWyVzISVzXSAlc0VSUk9SIElOIFNFQ1RJT04gOiAlcyclKE0sUCxNLE0sX2Vycm9yXykpO19jaWNpX2NpY2lfKCkKICAgICAgICAgICAgICAgIGVsc2U6amFsYW4oJyVzIFslcyElc10gJXNJTkNPUlJFQ1QgQ09OVEVOVCclKE0sUCxNLE0pKTttZW51KCkgICAgCiAgICBkZWYgc2VhcmNoKHNlbGYpOgogICAgICAgIHdoaXRlbGlzdD1bXTtxPV9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNOQU1FIDogJyUoSCxQLEgsSykpLmxvd2VyKCkKICAgICAgICBpZiBxPT0nJzpzZWxmLnNlYXJjaCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZm9yIGUsaSBpbiBlbnVtZXJhdGUoc2VsZi5nbGlzdCk6CiAgICAgICAgICAgICAgICBpZiBxIGluIGkuZ2V0KCJuYW1lIikubG93ZXIoKTp3aGl0ZWxpc3QuYXBwZW5kKGkpO3ByaW50KCclcyBbJXMlcyVzXSAlcyVzJyUoTyxQLGxlbih3aGl0ZWxpc3QpLE8sUCxpLmdldCgibmFtZSIpLnJlcGxhY2UocSwiJXMiJShxKSkpKQogICAgICAgICAgICBpZiBsZW4od2hpdGVsaXN0KT09MDpqYWxhbignJXMgWyVzISVzXSAlc1BSSVZBVEUgR1JPVVAgT1IgV1JPTkcgSUQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgICAgIGVsc2U6c2VsZi5jaG9pY2Uod2hpdGVsaXN0LHEpCiAgICBkZWYgY2hvaWNlKHNlbGYsIHdoaXRlbGlzdCxxKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYubGlzdGVkPXdoaXRlbGlzdFtpbnQoX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0NIT09TRSA6ICclKEgsUCxILEspKSktaW50KDEpXTtzZWxmLmYocSk7cHJpbnQoJyVzICclKE8pKTtwcmludCgiJXMgWyVz4oCiJXNdICVzTkFNRSA6ICVzIiUoSCxQLEgsSyxzZWxmLmxpc3RlZC5nZXQoIm5hbWUiKSkpO3hkID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0RVTVAvVVNFUk5BTUU/ICVzWyVzaSVzLyVzdSVzXSA6ICclKEgsUCxILEssWixNLFosSCxaKSk7cHJpbnQoIiVzIFslc+KAoiVzXSAlc1BSRVNTIENUUkwrQyBUTyBTVE9QIERVTVAiJShILFAsSCxLKSkKICAgICAgICAgICAgaWYgeGQgaW4gWycnXTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgICAgICBlbGlmIHhkIGluIFsnaScsJ0knLCcxJ106CiAgICAgICAgICAgICAgICB0cnk6c2VsZi5kdW1wX2lkKCJodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8iK3NlbGYubGlzdGVkLmdldCgiaWQiKSk7cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIERhcmkgJXMiJShILFAsSCxLLGxlbihfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSxzZWxmLmxpc3RlZC5nZXQoIm5hbWUiKSkpO3JldHVybiBjcmFjayhzZWxmLmZsKQogICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBGUk9NICVzIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksc2VsZi5saXN0ZWQuZ2V0KCJuYW1lIikpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgX2Vycm9yXzpwcmludCgnXG4lcyBbJXMhJXNdICVzRVJST1IgSU4gU0VDVElPTiA6ICVzJyUoTSxQLE0sUCxfZXJyb3JfKSk7X2NpY2lfY2ljaV8oKQogICAgICAgICAgICBlbGlmIHhkIGluIFsndScsJ1UnLCcyJ106CiAgICAgICAgICAgICAgICB0cnk6c2VsZi5kdW1wX3VzZXJuYW1lKCJodHRwczovL20uZmFjZWJvb2suY29tL2dyb3Vwcy8iK3NlbGYubGlzdGVkLmdldCgiaWQiKSk7cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIERhcmkgJXMiJShILFAsSCxLLGxlbihfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSxzZWxmLmxpc3RlZC5nZXQoIm5hbWUiKSkpO3JldHVybiBjcmFjayhzZWxmLmZsKQogICAgICAgICAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBEYXJpICVzIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksc2VsZi5saXN0ZWQuZ2V0KCJuYW1lIikpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgX2Vycm9yXzpwcmludCgnXG4lcyBbJXMhJXNdICVzRVJST1IgSU4gU0VDVElPTiA6ICVzJyUoTSxQLE0sUCxfZXJyb3JfKSk7X2NpY2lfY2ljaV8oKQogICAgICAgICAgICBlbHNlOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCBGUk9NICVzIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpLnNwbGl0bGluZXMoKSksc2VsZi5saXN0ZWQuZ2V0KCJuYW1lIikpKTtyZXR1cm4gY3JhY2soc2VsZi5mbCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIF9lcnJvcl86cHJpbnQoJ1xuJXMgWyVzISVzXSAlc0VSUk9SIElOIFNFQ1RJT04gOiAlcyclKE0sUCxNLFAsX2Vycm9yXykpO19jaWNpX2NpY2lfKCkKICAgIGRlZiBmKHNlbGYsaWQpOgogICAgICAgIHNlbGYuZmw9KGlkLnJlcGxhY2UoJyAnLCdfJykrJy5qc29uJykKICAgICAgICBpZiBzZWxmLmZsPT0nJzpzZWxmLmYoKQogICAgICAgIHRyeTpvcy5yZW1vdmUoc2VsZi5mbCkKICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwsInciKS5jbG9zZSgpCiAgICBkZWYgZHVtcF91c2VybmFtZShzZWxmLCB1cmwpOgogICAgICAgIHI9YnM0LkJlYXV0aWZ1bFNvdXAoX3JlcV9nZXRfKHVybCxjb29raWVzPXNlbGYuY29va2llcyxoZWFkZXJzPWhlYWRlcl9ncnVwKS50ZXh0LCJodG1sLnBhcnNlciIpO3ByaW50KCJcciVzIFslc+KAoiVzXSAlc1RBS0lORyAlcyVzIElEIiUoSCxQLEgsSyxILGxlbihfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCkuc3BsaXRsaW5lcygpKSksIGVuZD0nICcpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIGZvciBpIGluIHIuZmluZF9hbGwoImgzIik6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGxlbihiczQucmUuZmluZGFsbCgiXC8iLGkuZmluZCgiYSIsaHJlZj1UcnVlKS5nZXQoImhyZWYiKSkpPT0xOgogICAgICAgICAgICAgICAgICAgIG9nZWg9aS5maW5kKCJhIixocmVmPVRydWUpCiAgICAgICAgICAgICAgICAgICAgaWYgInByb2ZpbGUucGhwIiBpbiBvZ2VoLmdldCgiaHJlZiIpOgogICAgICAgICAgICAgICAgICAgICAgICBhPSIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoInByb2ZpbGVcLnBocFw/aWQ9KC4qPykmIixvZ2VoLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGEpPT0wOmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSBpbiBfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCk6Y29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsLCJhKyIpLndyaXRlKCIlc+KAoiVzXG4iJShhLG9nZWgudGV4dCkpO2NvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYT0iIi5qb2luKGJzNC5yZS5maW5kYWxsKCIvKC4qPylcPyIsb2dlaC5nZXQoImhyZWYiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihhKT09MDpjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGEgaW4gX2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCkucmVhZCgpOmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6X2F6aW12YXVfZGFwdW50YV8oc2VsZi5mbCwiYSsiKS53cml0ZSgiJXPigKIlc1xuIiUoYSxvZ2VoLnRleHQpKQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBmb3IgaSBpbiByLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgogICAgICAgICAgICBpZiAiU2VlIE1vcmUgUG9zdHMiIGluIGkudGV4dDoKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OnNlbGYuZHVtcF91c2VybmFtZSgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iK2kuZ2V0KCJocmVmIikpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCdcciVzIFslcyElc10gJXNSRVBFQVQnJShNLFAsTSxNKSk7Y29udGludWUKICAgIGRlZiBkdW1wX2lkKHNlbGYsIHVybCk6CiAgICAgICAgcj1iczQuQmVhdXRpZnVsU291cChfcmVxX2dldF8odXJsLGNvb2tpZXM9c2VsZi5jb29raWVzLGhlYWRlcnM9aGVhZGVyX2dydXApLnRleHQsImh0bWwucGFyc2VyIik7cHJpbnQoIlxyJXMgWyVz4oCiJXNdICVzVEFLSU5HICVzJXMgSUQiJShILFAsSCxLLEgsbGVuKF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSwgZW5kPScgJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgZm9yIGkgaW4gci5maW5kX2FsbCgiaDMiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbGVuKGJzNC5yZS5maW5kYWxsKCJcLyIsaS5maW5kKCJhIixocmVmPVRydWUpLmdldCgiaHJlZiIpKSk9PTE6CiAgICAgICAgICAgICAgICAgICAgb2dlaD1pLmZpbmQoImEiLGhyZWY9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBpZiAicHJvZmlsZS5waHAiIGluIG9nZWguZ2V0KCJocmVmIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGE9IiIuam9pbihiczQucmUuZmluZGFsbCgicHJvZmlsZVwucGhwXD9pZD0oLio/KSYiLG9nZWguZ2V0KCJocmVmIikpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oYSk9PTA6Y29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBhIGluIF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwpLnJlYWQoKTpjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOl9hemltdmF1X2RhcHVudGFfKHNlbGYuZmwsImErIikud3JpdGUoIiVz4oCiJXNcbiIlKGEsb2dlaC50ZXh0KSk7Y29udGludWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhPSIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoIi8oLio/KVw/IixvZ2VoLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGEpPT0wOmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgYSBpbiBfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsKS5yZWFkKCk6Y29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmZsLCJhKyIpLndyaXRlKCIlc+KAoiVzXG4iJShfZ2V0X2lkXyhhKSxvZ2VoLnRleHQpKQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBmb3IgaSBpbiByLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgogICAgICAgICAgICBpZiAiU2VlIE1vcmUgUG9zdHMiIGluIGkudGV4dDoKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OnNlbGYuZHVtcF9pZCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iK2kuZ2V0KCJocmVmIikpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCdcciVzIFslcyElc10gJXNNZW5ndWxhbmdpJyUoTSxQLE0sUCkpO2NvbnRpbnVlCgoKZGVmIF9nZXRfaWRfKHVzZXJuYW1lKToKICAgIHVybCA9ICJodHRwczovL2xvb2t1cC1pZC5jb20vIyIKICAgIHdpdGggX3JlcV9zZXNfIGFzIGRldjoKICAgICAgICBwYXlsb2FkID0geyJmYnVybCI6ICJodHRwczovL20uZmFjZWJvb2suY29tL3t9Ii5mb3JtYXQodXNlcm5hbWUpLCAiY2hlY2siOiAiTG9va3VwIn0KICAgICAgICBpZiAiZmFjZWJvb2siIGluIHVzZXJuYW1lOnBheWxvYWQgPSB7ImZidXJsIjogdXNlcm5hbWUsICJjaGVjayI6ICJMb29rdXAifQogICAgICAgIGRhdGFfZGV2ID0gZGV2LnBvc3QodXJsLCBkYXRhPXBheWxvYWQpLmNvbnRlbnQ7c29wXyA9IHBhcihkYXRhX2RldiwgImh0bWwucGFyc2VyIik7aWRfID0gc29wXy5maW5kKCJzcGFuIiwgaWQ9ImNvZGUiKTt1c2VyX2dldF9pZCA9IGlkXy50ZXh0CiAgICAgICAgcmV0dXJuIHVzZXJfZ2V0X2lkCgoKZGVmIGR1bXBfbmFtZShfYXppbXZhdV8pOgogICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc0VYQU1QTEUgOiBrdXJkJyUoSCxQLEgsSykpO19fbmFtZV9fID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIE5BTUUgOiAnJShILFAsSCxLKSkuc3BsaXQoJywnKTtfZmlsZV8gPSAnZHVtcF9uYW1lLmpzb24nCiAgICB0cnk6b3MucmVtb3ZlKF9maWxlXykKICAgIGV4Y2VwdDpwYXNzCiAgICBmb3IgX25hbWVfIGluIF9fbmFtZV9fOl91cmxfID0gImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9zZWFyY2gvcGVvcGxlLz9xPSIrX25hbWVfO2NhcmlfbmFtYShfZmlsZV8sX2F6aW12YXVfLF91cmxfKQogICAgX2J1a2FfZmlsZV8gPSBfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8sJ3InKS5yZWFkKCkuc3BsaXRsaW5lcygpO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1RPVEFMIElEIDogJXMiJShILFAsSCxLLHN0cihsZW4oX2J1a2FfZmlsZV8pKSkpCiAgICByZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgY2FyaV9uYW1hKF9maWxlXyxfY29va2llc18sX3VybF8pOgogICAgX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCJhKyIpO19yZXFfc2VzX2Rldl8gPSBiczQuQmVhdXRpZnVsU291cChfcmVxX2dldF8oX3VybF8sIGNvb2tpZXM9X2Nvb2tpZXNfLGhlYWRlcnM9aGVhZGVyX25hbWEpLnRleHQsImh0bWwucGFyc2VyIikKICAgIGZvciBfYXppbXZhdV9kZXZfIGluIF9yZXFfc2VzX2Rldl8uZmluZF9hbGwoImEiLGhyZWY9VHJ1ZSk6CiAgICAgICAgcHJpbnQgKCJcciVzIFslc+KAoiVzXSAlc1RBS0lORyAlcyVzIElEIiUoSCxQLEgsSyxILGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSxlbmQ9JycpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIGlmICI8aW1nIGFsdD0iIGluIHN0cihfYXppbXZhdV9kZXZfKToKICAgICAgICAgICAgaWYgImhvbWUucGhwIiBpbiBzdHIoX2F6aW12YXVfZGV2X1siaHJlZiJdKTpjb250aW51ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgX3N0cl9kZXZfID0gc3RyKF9hemltdmF1X2Rldl9bImhyZWYiXSkKICAgICAgICAgICAgICAgIGlmICJwcm9maWxlLnBocCIgaW4gX3N0cl9kZXZfOgogICAgICAgICAgICAgICAgICAgIF9uYW1lXyA9IF9hemltdmF1X2Rldl8uZmluZCgiaW1nIikuZ2V0KCJhbHQiKS5yZXBsYWNlKCIsIHByb2ZpbGUgcGljdHVyZSIsIiIpO19maW5kXyA9IGJzNC5yZS5maW5kYWxsKCIvcHJvZmlsZVwucGhwXD9pZD0oLio/KSYiLF9zdHJfZGV2XykKICAgICAgICAgICAgICAgICAgICBpZiBsZW4gKF9maW5kXykgIT0wOgogICAgICAgICAgICAgICAgICAgICAgICBfdXNlcl8gPSAiIi5qb2luKF9maW5kXykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX3VzZXJfIGluIF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8sImErIikud3JpdGUoIiVz4oCiJXNcbiIlKF91c2VyXyxfbmFtZV8pKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBfZmluZF8gPSBiczQucmUuZmluZGFsbCgiLyguKj8pXD8iLF9zdHJfZGV2Xyk7X25hbWVfID0gX2F6aW12YXVfZGV2Xy5maW5kKCJpbWciKS5nZXQoImFsdCIpLnJlcGxhY2UoIiwgcHJvZmlsZSBwaWN0dXJlIiwiIikKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oX2ZpbmRfKSAhPTA6CiAgICAgICAgICAgICAgICAgICAgICAgIF91c2VyXz0iIi5qb2luKF9maW5kXykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX3VzZXJfIGluIF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8sImErIikud3JpdGUoIiVz4oCiJXNcbiIlKF91c2VyXyxfbmFtZV8pKQogICAgICAgIGlmICJTZWUgTW9yZSBSZXN1bHRzIiBpbiBfYXppbXZhdV9kZXZfLnRleHQ6Y2FyaV9uYW1hKF9maWxlXyxfY29va2llc18sX2F6aW12YXVfZGV2X1siaHJlZiJdKQoKCmNsYXNzIGR1bXBfcGVzYW46CiAgICBkZWYgX19pbml0X18oc2VsZixfY29va2llc18sX25hbWFfLF9pZF8pOgogICAgICAgIHNlbGYuY29va2llcyA9IF9jb29raWVzXztzZWxmLmlkID0gX2lkXztzZWxmLmZpbGVzID0gKF9uYW1hXysnLmpzb24nKS5yZXBsYWNlKCIgIiwiXyIpO19hemltdmF1X2RhcHVudGFfKHNlbGYuZmlsZXMsInciKS5jbG9zZSgpO3NlbGYuZHVtcCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9tZXNzYWdlcyIpCiAgICBkZWYgZHVtcChzZWxmLHVybCk6CiAgICAgICAgX3JlcV9zZXNfZGV2XyA9IGJzNC5CZWF1dGlmdWxTb3VwKF9yZXFfZ2V0Xyh1cmwsaGVhZGVycz1oZWFkZXJfbmFtYSxjb29raWVzPXNlbGYuY29va2llcykudGV4dCwiaHRtbC5wYXJzZXIiKQogICAgICAgIGZvciBfZGV2XyBpbiBfcmVxX3Nlc19kZXZfLmZpbmRfYWxsKCJhIixocmVmPVRydWUpOgogICAgICAgICAgICBpZiAiL21lc3NhZ2VzL3JlYWQiIGluIF9kZXZfLmdldCgiaHJlZiIpOgogICAgICAgICAgICAgICAgX3NvdXBfID0gYnM0LnJlLmZpbmRhbGwoImNpZFwuY1wuKC4qPyklM0EoLio/KSYiLF9kZXZfLmdldCgiaHJlZiIpKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGZvciBfdXNlcl8gaW4gbGlzdChfc291cF8ucG9wKCkpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBfdXNlcl8gaW4gc2VsZi5pZDpjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkZhY2Vib29rIHVzZXIiIGluIF9kZXZfLnRleHQubG93ZXIoKTpjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2F6aW12YXVfZGFwdW50YV8oc2VsZi5maWxlcywiYSsiKS53cml0ZSgiJXPigKIlc1xuIiUoX3VzZXJfLF9kZXZfLnRleHQpKTtwcmludCgiXHIlcyBbJXPigKIlc10gJXNUQUtJTkcgJXMlcyBJRCIlKEgsUCxILEssSCxsZW4oX2F6aW12YXVfZGFwdW50YV8oc2VsZi5maWxlcykucmVhZCgpLnNwbGl0bGluZXMoKSkpLGVuZD0nJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6Y29udGludWUKICAgICAgICAgICAgaWYgIlNlZSBPbGRlciBNZXNzYWdlcyIgaW4gX2Rldl8udGV4dDpzZWxmLmR1bXAoImh0dHBzOi8vbS5mYWNlYm9vay5jb20vIitfZGV2Xy5nZXQoImhyZWYiKSkKICAgICAgICBfYnVrYV9maWxlXyA9IF9hemltdmF1X2RhcHVudGFfKHNlbGYuZmlsZXMsJ3InKS5yZWFkKCkuc3BsaXRsaW5lcygpO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc0FMTCBJRCA6ICVzIiUoSCxQLEgsSyxzdHIobGVuKF9idWthX2ZpbGVfKSkpKQogICAgICAgIHJldHVybiBjcmFjayhzZWxmLmZpbGVzKQoKCgpkZWYgZmlsZSgpOgoJdHJ5OgoJCXByaW50KCIiKQoJCXhjID0gaW5wdXQoJyVzIFslc+KAoiVzXSAlc0ZJTEUgOiAlcyclKEgsUCxILEssSCkpCgkJaWQgPSBvcGVuKHhjKS5yZWFkKCkuc3BsaXRsaW5lcygpCgkJcHJpbnQoJyVzIFslc+KAoiVzXSAlc0FMTCBJRCA6ICVzJXMnJShILFAsSCxPLEgsbGVuKGlkKSkpCgkJcmV0dXJuIGNyYWNrKHhjKQoJZXhjZXB0IEZpbGVOb3RGb3VuZEVycm9yOgoJCXByaW50KCIlcyBbJXMhJXNdICVzRklMRSBOT1QgRVhJU1RJTkciJShNLFAsTSxNKSkKCQlmaWxlKCkKCQkKCmRlZiBkdW1wX2VtYWlsKCk6CiAgICBwcmludCgiJXMgWyVz4oCiJXNdICVzRVhBTVBMRSA6IGFobWFka3VyZDgxOSAiJShILFAsSCxLKSk7X3F1ZXJ5XyA9IF9jaWNpX2F6aW12YXVfKCIlcyBbJXPigKIlc10gJXNFTlRFUiBOQU1FIDogIiUoSCxQLEgsSykpLmxvd2VyKCkKICAgIGlmIGxlbihfcXVlcnlfKSA8IDM6amFsYW4oJyVzIFslcyElc10gJXNOQU1FIE1VU1QgQkUgTU9SRSBUSEFOIDIgRElHSVRTJyUoTSxQLE0sUCkpO3RpbWUuc2xlZXAoMik7bWVudSgpCiAgICBwcmludCgiJXMgWyVz4oCiJXNdICVzRVhBTVBMRSA6ICVzZ21haWwuY29tIiUoSCxQLEgsSyxIKSk7X2RvbWFpbl8gPSBfY2ljaV9hemltdmF1XygiJXMgWyVz4oCiJXNdICVzRU5URVIgRE9NQUlOIDogIiUoSCxQLEgsSykpLmxvd2VyKCkKICAgIGlmICdAJyBpbiBfZG9tYWluXzpfZG9tYWluXyA9IF9kb21haW5fLnNwbGl0KCdAJylbMV0KICAgIF9saW1pdF9hd2FsXyA9IGludChfY2ljaV9hemltdmF1XygiJXMgWyVz4oCiJXNdICVzRU5URVIgU1RBUklORyBOVU1CRVIgOiAiJShILFAsSCxLKSkpO19saW1pdF9ha2hpcl89IGludChfY2ljaV9hemltdmF1XygiJXMgWyVz4oCiJXNdICVzRU5URVIgRU5ESU5HIE5VTUJFUiA6ICIlKEgsUCxILEspKSk7X2ZpbGVfID0gKF9xdWVyeV8rIi5qc29uIikucmVwbGFjZSgiICIsIl8iKQogICAgdHJ5Om9zLnJlbW92ZShfZmlsZV8pCiAgICBleGNlcHQ6cGFzcwogICAgZXhlY19lbWFpbChfcXVlcnlfLF9kb21haW5fLF9saW1pdF9hd2FsXyxfbGltaXRfYWtoaXJfLF9maWxlXykKZGVmIGV4ZWNfZW1haWwoX19xdWVyeV9fLF9kb21haW5fLF9saW1pdF9hd2FsXyxfbGltaXRfYWtoaXJfLF9maWxlXyk6CiAgICBfaGl0dW5nX2VtYWlsXzFfID0gX2xpbWl0X2F3YWxfKzE7X2hpdHVuZ19lbWFpbF8yXyA9IF9saW1pdF9hd2FsXysxO19oaXR1bmdfZW1haWxfM18gPSBfbGltaXRfYXdhbF8rMTtfaGl0dW5nX2VtYWlsX2Z1bGxfID0gX2xpbWl0X2F3YWxfKzEKICAgIGlmICcgJyBpbiBfX3F1ZXJ5X186CiAgICAgICAgdHJ5Ol9xdWVyeV8xXyA9IF9fcXVlcnlfXy5zcGxpdCgnICcpWzBdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzJfID0gX19xdWVyeV9fLnNwbGl0KCcgJylbMV0KICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIHRyeTpfcXVlcnlfM18gPSBfX3F1ZXJ5X18uc3BsaXQoJyAnKVsyXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICBlbGlmICcuJyBpbiBfX3F1ZXJ5X186CiAgICAgICAgdHJ5Ol9xdWVyeV8xXyA9IF9fcXVlcnlfXy5zcGxpdCgnLicpWzBdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzJfID0gX19xdWVyeV9fLnNwbGl0KCcuJylbMV0KICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIHRyeTpfcXVlcnlfM18gPSBfX3F1ZXJ5X18uc3BsaXQoJy4nKVsyXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICBlbGlmICdfJyBpbiBfX3F1ZXJ5X186CiAgICAgICAgdHJ5Ol9xdWVyeV8xXyA9IF9fcXVlcnlfXy5zcGxpdCgnXycpWzBdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzJfID0gX19xdWVyeV9fLnNwbGl0KCdfJylbMV0KICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIHRyeTpfcXVlcnlfM18gPSBfX3F1ZXJ5X18uc3BsaXQoJ18nKVsyXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICBlbGlmICctJyBpbiBfX3F1ZXJ5X186CiAgICAgICAgdHJ5Ol9xdWVyeV8xXyA9IF9fcXVlcnlfXy5zcGxpdCgnLScpWzBdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzJfID0gX19xdWVyeV9fLnNwbGl0KCctJylbMV0KICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgIHRyeTpfcXVlcnlfM18gPSBfX3F1ZXJ5X18uc3BsaXQoJy0nKVsyXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICBlbHNlOgogICAgICAgIHRyeTpfcXVlcnlfMV8gPSBfX3F1ZXJ5X18KICAgICAgICBleGNlcHQ6cGFzcwogICAgdHJ5IDoKICAgICAgICBmb3IgX2p1bWxhaF8gaW4gcmFuZ2UoX2xpbWl0X2F3YWxfLF9saW1pdF9ha2hpcl8pOgogICAgICAgICAgICB0cnk6bmFtYSA9IF9xdWVyeV8xXztlbWFpbCA9ICgnJXMlc0AlcyclKF9xdWVyeV8xXyxzdHIoX2hpdHVuZ19lbWFpbF8xXyksX2RvbWFpbl8pKTtfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8sJ2ErJykud3JpdGUoJyVz4oCiJXNcbiclKGVtYWlsLG5hbWEpKTtfaGl0dW5nX2VtYWlsXzFfICs9IDEKICAgICAgICAgICAgZXhjZXB0OmNvbnRpbnVlCiAgICAgICAgZm9yIF9qdW1sYWhfIGluIHJhbmdlKF9saW1pdF9hd2FsXyxfbGltaXRfYWtoaXJfKToKICAgICAgICAgICAgdHJ5Om5hbWEgPSBfcXVlcnlfMl87ZW1haWwgPSAoJyVzJXNAJXMnJShfcXVlcnlfMl8sc3RyKF9oaXR1bmdfZW1haWxfMl8pLF9kb21haW5fKSk7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKCclc+KAoiVzXG4nJShlbWFpbCxuYW1hKSk7X2hpdHVuZ19lbWFpbF8yXyArPSAxCiAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgIGZvciBfanVtbGFoXyBpbiByYW5nZShfbGltaXRfYXdhbF8sX2xpbWl0X2FraGlyXyk6CiAgICAgICAgICAgIHRyeTpuYW1hID0gX3F1ZXJ5XzNfO2VtYWlsID0gKCclcyVzQCVzJyUoX3F1ZXJ5XzNfLHN0cihfaGl0dW5nX2VtYWlsXzNfKSxfZG9tYWluXykpO19hemltdmF1X2RhcHVudGFfKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoZW1haWwsbmFtYSkpO19oaXR1bmdfZW1haWxfM18gKz0gMQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBmb3IgX2p1bWxhaF8gaW4gcmFuZ2UoX2xpbWl0X2F3YWxfLF9saW1pdF9ha2hpcl8pOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiAnLicgaW4gX19xdWVyeV9fOl9xdWVyeV8gPSBfX3F1ZXJ5X187bmFtYSA9IF9fcXVlcnlfXy5yZXBsYWNlKCcuJywnICcpCiAgICAgICAgICAgICAgICBlbGlmICdfJyBpbiBfX3F1ZXJ5X186X3F1ZXJ5XyA9IF9fcXVlcnlfXztuYW1hID0gX19xdWVyeV9fLnJlcGxhY2UoJ18nLCcgJykKICAgICAgICAgICAgICAgIGVsaWYgJy0nIGluIF9fcXVlcnlfXzpfcXVlcnlfID0gX19xdWVyeV9fO25hbWEgPSBfX3F1ZXJ5X18ucmVwbGFjZSgnLScsJyAnKQogICAgICAgICAgICAgICAgZWxzZTpfcXVlcnlfID0gX19xdWVyeV9fLnJlcGxhY2UoJyAnLCcnKTtuYW1hID0gX19xdWVyeV9fCiAgICAgICAgICAgICAgICBlbWFpbCA9ICgnJXMlc0AlcyclKF9xdWVyeV8sc3RyKF9oaXR1bmdfZW1haWxfZnVsbF8pLF9kb21haW5fKSk7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKCclc+KAoiVzXG4nJShlbWFpbCxuYW1hKSk7X2hpdHVuZ19lbWFpbF9mdWxsXyArPSAxCiAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgZXhjZXB0OgogICAgICAgIGphbGFuKCclcyBbJXMhJXNdICVzVEhFUkUgSVMgQU4gRVJST1InJShNLFAsTSxNKSkKICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICAgICAgbWVudSgpCiAgICBfYnVrYV9maWxlXyA9IF9hemltdmF1X2RhcHVudGFfKF9maWxlXywncicpLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNUT1RBTCBJRCA6ICVzJXMiJShILFAsSCxLLEgsc3RyKGxlbihfYnVrYV9maWxlXykpKSkKICAgIHJldHVybiBjcmFjayhfZmlsZV8pCgoKZGVmIGR1bXBfdXNlcm5hbWUoKToKICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNFWEFNUExFIDogJXNhaG1hZGt1cmQ4NzEiJShILFAsSCxLLEgpKTtfcXVlcnlfID0gX2NpY2lfYXppbXZhdV8oIiVzIFslc+KAoiVzXSAlc0VOVEVSIE5BTUUgOiAiJShILFAsSCxLKSkubG93ZXIoKQogICAgaWYgbGVuKF9xdWVyeV8pIDwgMzpqYWxhbignJXMgWyVzISVzXSAlc05BTUUgTVVTVCBCRSBNT1JFIFRIQU4gMiBESUdJVFMnJShNLFAsTSxNKSk7dGltZS5zbGVlcCgyKTttZW51KCkKICAgIF9saW1pdF9hd2FsXyA9IGludChfY2ljaV9hemltdmF1XygiJXMgWyVz4oCiJXNdICVzRU5URVIgU1RBUlRJTkcgTlVNQkVSIChFWDogMSkgOiAiJShILFAsSCxQKSkpO19saW1pdF9ha2hpcl89IGludChfY2ljaV9hemltdmF1XygiJXMgWyVz4oCiJXNdICVzRU5URVIgRU5ESU5HIE5VTUJFUiAoRVg6IDEwMDApOiAiJShILFAsSCxQKSkpO19maWxlXyA9IChfcXVlcnlfKyIuanNvbiIpLnJlcGxhY2UoIiAiLCJfIikKICAgIHRyeTpvcy5yZW1vdmUoX2ZpbGVfKQogICAgZXhjZXB0OnBhc3MKICAgIGV4ZWNfdXNlcm5hbWUoX3F1ZXJ5XyxfbGltaXRfYXdhbF8sX2xpbWl0X2FraGlyXyxfZmlsZV8pCmRlZiBleGVjX3VzZXJuYW1lKF9fcXVlcnlfXyxfbGltaXRfYXdhbF8sX2xpbWl0X2FraGlyXyxfZmlsZV8pOgogICAgX2hpdHVuZ19lbWFpbF8xXyA9IF9saW1pdF9hd2FsXysxO19oaXR1bmdfZW1haWxfMl8gPSBfbGltaXRfYXdhbF8rMTtfaGl0dW5nX2VtYWlsXzNfID0gX2xpbWl0X2F3YWxfKzE7X2hpdHVuZ19lbWFpbF9mdWxsXyA9IF9saW1pdF9hd2FsXysxCiAgICBpZiAnICcgaW4gX19xdWVyeV9fOgogICAgICAgIHRyeTpfcXVlcnlfMV8gPSBfX3F1ZXJ5X18uc3BsaXQoJyAnKVswXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgdHJ5Ol9xdWVyeV8yXyA9IF9fcXVlcnlfXy5zcGxpdCgnICcpWzFdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzNfID0gX19xdWVyeV9fLnNwbGl0KCcgJylbMl0KICAgICAgICBleGNlcHQ6cGFzcwogICAgZWxpZiAnLicgaW4gX19xdWVyeV9fOgogICAgICAgIHRyeTpfcXVlcnlfMV8gPSBfX3F1ZXJ5X18uc3BsaXQoJy4nKVswXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgdHJ5Ol9xdWVyeV8yXyA9IF9fcXVlcnlfXy5zcGxpdCgnLicpWzFdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzNfID0gX19xdWVyeV9fLnNwbGl0KCcuJylbMl0KICAgICAgICBleGNlcHQ6cGFzcwogICAgZWxpZiAnXycgaW4gX19xdWVyeV9fOgogICAgICAgIHRyeTpfcXVlcnlfMV8gPSBfX3F1ZXJ5X18uc3BsaXQoJ18nKVswXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgdHJ5Ol9xdWVyeV8yXyA9IF9fcXVlcnlfXy5zcGxpdCgnXycpWzFdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzNfID0gX19xdWVyeV9fLnNwbGl0KCdfJylbMl0KICAgICAgICBleGNlcHQ6cGFzcwogICAgZWxpZiAnLScgaW4gX19xdWVyeV9fOgogICAgICAgIHRyeTpfcXVlcnlfMV8gPSBfX3F1ZXJ5X18uc3BsaXQoJy0nKVswXQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgdHJ5Ol9xdWVyeV8yXyA9IF9fcXVlcnlfXy5zcGxpdCgnLScpWzFdCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICB0cnk6X3F1ZXJ5XzNfID0gX19xdWVyeV9fLnNwbGl0KCctJylbMl0KICAgICAgICBleGNlcHQ6cGFzcwogICAgZWxzZToKICAgICAgICB0cnk6X3F1ZXJ5XzFfID0gX19xdWVyeV9fCiAgICAgICAgZXhjZXB0OnBhc3MKICAgIHRyeSA6CiAgICAgICAgZm9yIF9qdW1sYWhfIGluIHJhbmdlKF9saW1pdF9hd2FsXyxfbGltaXRfYWtoaXJfKToKICAgICAgICAgICAgdHJ5Om5hbWEgPSBfcXVlcnlfMV87ZW1haWwgPSAoJyVzJXMnJShfcXVlcnlfMV8sc3RyKF9oaXR1bmdfZW1haWxfMV8pKSk7X2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfLCdhKycpLndyaXRlKCclc+KAoiVzXG4nJShlbWFpbCxuYW1hKSk7X2hpdHVuZ19lbWFpbF8xXyArPSAxCiAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgIGZvciBfanVtbGFoXyBpbiByYW5nZShfbGltaXRfYXdhbF8sX2xpbWl0X2FraGlyXyk6CiAgICAgICAgICAgIHRyeTpuYW1hID0gX3F1ZXJ5XzJfO2VtYWlsID0gKCclcyVzJyUoX3F1ZXJ5XzJfLHN0cihfaGl0dW5nX2VtYWlsXzJfKSkpO19hemltdmF1X2RhcHVudGFfKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoZW1haWwsbmFtYSkpO19oaXR1bmdfZW1haWxfMl8gKz0gMQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICBmb3IgX2p1bWxhaF8gaW4gcmFuZ2UoX2xpbWl0X2F3YWxfLF9saW1pdF9ha2hpcl8pOgogICAgICAgICAgICB0cnk6bmFtYSA9IF9xdWVyeV8zXztlbWFpbCA9ICgnJXMlcyclKF9xdWVyeV8zXyxzdHIoX2hpdHVuZ19lbWFpbF8zXykpKTtfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8sJ2ErJykud3JpdGUoJyVz4oCiJXNcbiclKGVtYWlsLG5hbWEpKTtfaGl0dW5nX2VtYWlsXzNfICs9IDEKICAgICAgICAgICAgZXhjZXB0OmNvbnRpbnVlCiAgICAgICAgZm9yIF9qdW1sYWhfIGluIHJhbmdlKF9saW1pdF9hd2FsXyxfbGltaXRfYWtoaXJfKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgJy4nIGluIF9fcXVlcnlfXzpfcXVlcnlfID0gX19xdWVyeV9fO25hbWEgPSBfX3F1ZXJ5X18ucmVwbGFjZSgnLicsJyAnKQogICAgICAgICAgICAgICAgZWxpZiAnXycgaW4gX19xdWVyeV9fOl9xdWVyeV8gPSBfX3F1ZXJ5X187bmFtYSA9IF9fcXVlcnlfXy5yZXBsYWNlKCdfJywnICcpCiAgICAgICAgICAgICAgICBlbGlmICctJyBpbiBfX3F1ZXJ5X186X3F1ZXJ5XyA9IF9fcXVlcnlfXztuYW1hID0gX19xdWVyeV9fLnJlcGxhY2UoJy0nLCcgJykKICAgICAgICAgICAgICAgIGVsc2U6X3F1ZXJ5XyA9IF9fcXVlcnlfXy5yZXBsYWNlKCcgJywnJyk7bmFtYSA9IF9fcXVlcnlfXwogICAgICAgICAgICAgICAgZW1haWwgPSAoJyVzJXMnJShfcXVlcnlfLHN0cihfaGl0dW5nX2VtYWlsX2Z1bGxfKSkpO19hemltdmF1X2RhcHVudGFfKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoZW1haWwsbmFtYSkpO19oaXR1bmdfZW1haWxfZnVsbF8gKz0gMQogICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgIGV4Y2VwdDpqYWxhbignJXMgWyVzISVzXSAlc1RIRVJFIElTIEFOIEVSUk9SJyUoTSxQLE0sUCkpO3RpbWUuc2xlZXAoMik7bWVudSgpCiAgICBfYnVrYV9maWxlXyA9IF9hemltdmF1X2RhcHVudGFfKF9maWxlXywncicpLnJlYWQoKS5zcGxpdGxpbmVzKCk7cHJpbnQoIiVzIFslc+KAoiVzXSAlc0FMTCBJRCA6ICVzJXMiJShILFAsSCxLLEgsc3RyKGxlbihfYnVrYV9maWxlXykpKSkKICAgIHJldHVybiBjcmFjayhfZmlsZV8pCgojIyMgRHVtcCBJRCBEYXJpIEhhc2h0YWcKZGVmIGhhc2h0YWcoY29va2llcyk6CiAgICBfcXVlcnlfID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIEhBU0hUQUcgOiAnJShILFAsSCxCKSk7X3VybF9kZXZfID0gJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9oYXNodGFnLycgKyBfcXVlcnlfO19maWxlXyA9IChfcXVlcnlfKycuanNvbicpLnJlcGxhY2UoJyAnLCdfJykKICAgIHRyeTpvcy5yZW1vdmUoX2ZpbGVfKQogICAgZXhjZXB0OnBhc3MKICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpO2V4ZWNfaGFzaHRhZyhfdXJsX2Rldl8sY29va2llcyxfZmlsZV8pO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgZXhlY19oYXNodGFnKHVybCxjb29raWVzLF9maWxlXyk6CiAgICBvcGVuKF9maWxlXywnYScpO19yZXFfc2VzXyA9IHJlcXVlc3RzLlNlc3Npb24oKTtfcmVxX2dldF8gPSBfcmVxX3Nlc18uZ2V0KHVybCxjb29raWVzPWNvb2tpZXMsaGVhZGVycz1oZWFkZXJfaGFzaHRhZyk7X3NvcF9kZXZfID0gcGFyKF9yZXFfZ2V0Xy50ZXh0LCdodG1sLnBhcnNlcicpO19idWthX2ZpbGVfID0gb3BlbihfZmlsZV8pLnJlYWQoKTtwcmludCAoIlxyJXMgWyVz4oCiJXNdICVzVEFLSU5HICVzJXMgSUQiJShILFAsSCxLLEgsbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpLGVuZD0nJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICB0cnk6CiAgICAgICAgZm9yIF9jaWNpXyBpbiBfc29wX2Rldl8uZmluZF9hbGwoJ2gzJyk6CiAgICAgICAgICAgIGZvciBfYXppbXZhdV8gaW4gX2NpY2lfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICAgICAgaWYgJ21iYXNpYy5mYWNlYm9vay5jb20nIGluIF9hemltdmF1Xy5nZXQoJ2hyZWYnKTpwYXNzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmICJwcm9maWxlLnBocCIgaW4gX2F6aW12YXVfLmdldCgnaHJlZicpOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbmFtZV9kZXZfID0gX2F6aW12YXVfLnRleHQ7X2lkX2Rldl8gPSAiIi5qb2luKGJzNC5yZS5maW5kYWxsKCJwcm9maWxlXC5waHBcP2lkPSguKj8pJiIsX2F6aW12YXVfLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9uYW1lX2Rldl8gaW4gX2J1a2FfZmlsZV86cGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLycgaW4gX2lkX2Rldl86cGFzcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpvcGVuKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoX2lkX2Rldl8sX25hbWVfZGV2XykpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX25hbWVfZGV2XyA9IF9hemltdmF1Xy50ZXh0O19pZF9kZXZfID0gIiIuam9pbihiczQucmUuZmluZGFsbCgiLyguKj8pXD8iLF9hemltdmF1Xy5nZXQoImhyZWYiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBfbmFtZV9kZXZfIGluIF9idWthX2ZpbGVfOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJy8nIGluIF9pZF9kZXZfOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6b3BlbihfZmlsZV8sJ2ErJykud3JpdGUoJyVz4oCiJXNcbiclKF9pZF9kZXZfLF9uYW1lX2Rldl8pKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICBmb3IgX2F6aW12YXVfIGluIF9zb3BfZGV2Xy5maW5kX2FsbCgnYScsaHJlZj1UcnVlKToKICAgICAgICAgICAgICAgIGlmICdTZWUgTW9yZSBSZXN1bHRzJyBpbiBfYXppbXZhdV8udGV4dDp1cmxfZGV2ID0gX2F6aW12YXVfLmdldCgnaHJlZicpO2V4ZWNfaGFzaHRhZyh1cmxfZGV2LGNvb2tpZXMsX2ZpbGVfKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQoKCmRlZiBiZXJhbmRhKGNvb2tpZXMpOgogICAgX3VybF9kZXZfID0gJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9ob21lLnBocCc7X2ZpbGVfID0gJ2JlcmFuZGEuanNvbicKICAgIHRyeTpvcy5yZW1vdmUoX2ZpbGVfKQogICAgZXhjZXB0OnBhc3MKICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpO2V4ZWNfYmVyYW5kYShfdXJsX2Rldl8sY29va2llcyxfZmlsZV8pO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgZXhlY19iZXJhbmRhKHVybCxjb29raWVzLF9maWxlXyk6CiAgICBvcGVuKF9maWxlXywnYScpO19yZXFfc2VzXyA9IHJlcXVlc3RzLlNlc3Npb24oKTtfcmVxX2dldF8gPSBfcmVxX3Nlc18uZ2V0KHVybCxjb29raWVzPWNvb2tpZXMsaGVhZGVycz1oZWFkZXJfbmFtYSk7X3NvcF9kZXZfID0gcGFyKF9yZXFfZ2V0Xy50ZXh0LCdodG1sLnBhcnNlcicpO19idWthX2ZpbGVfID0gb3BlbihfZmlsZV8pLnJlYWQoKTtwcmludCAoIlxyJXMgWyVz4oCiJXNdICVzVEFLSU5HICVzJXMgSUQiJShILFAsSCxLLEgsbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpLGVuZD0nJyk7c3lzLnN0ZG91dC5mbHVzaCgpCiAgICB0cnk6CiAgICAgICAgZm9yIF9jaWNpXyBpbiBfc29wX2Rldl8uZmluZF9hbGwoJ2gzJyk6CiAgICAgICAgICAgIGZvciBfYXppbXZhdV8gaW4gX2NpY2lfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICAgICAgaWYgInByb2ZpbGUucGhwIiBpbiBfYXppbXZhdV8uZ2V0KCdocmVmJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBfbmFtZV9kZXZfID0gX2F6aW12YXVfLnRleHQ7X2lkX2Rldl8gPSAiIi5qb2luKGJzNC5yZS5maW5kYWxsKCJwcm9maWxlXC5waHBcP2lkPSguKj8pJiIsX2F6aW12YXVfLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX25hbWVfZGV2XyBpbiBfYnVrYV9maWxlXzpwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJy8nIGluIF9pZF9kZXZfOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpvcGVuKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoX2lkX2Rldl8sX25hbWVfZGV2XykpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBfbmFtZV9kZXZfID0gX2F6aW12YXVfLnRleHQ7X2lkX2Rldl8gPSAiIi5qb2luKGJzNC5yZS5maW5kYWxsKCIvKC4qPylcPyIsX2F6aW12YXVfLmdldCgiaHJlZiIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgX25hbWVfZGV2XyBpbiBfYnVrYV9maWxlXzpwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJy8nIGluIF9pZF9kZXZfOnBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpvcGVuKF9maWxlXywnYSsnKS53cml0ZSgnJXPigKIlc1xuJyUoX2lkX2Rldl8sX25hbWVfZGV2XykpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgZm9yIF9hemltdmF1XyBpbiBfc29wX2Rldl8uZmluZF9hbGwoJ2EnLGhyZWY9VHJ1ZSk6CiAgICAgICAgICAgICAgICBpZiAnU2VlIE1vcmUgU3RvcmllcycgaW4gX2F6aW12YXVfLnRleHQ6dXJsX2RldiA9ICdodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vJyArIF9hemltdmF1Xy5nZXQoJ2hyZWYnKTtleGVjX2JlcmFuZGEodXJsX2Rldixjb29raWVzLF9maWxlXykKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDpwcmludCgiXG4lcyBbJXPigKIlc10gJXNTVUNDRVNTRlVMIERVTVAgJXMgSUQiJShILFAsSCxLLGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSk7cmV0dXJuIGNyYWNrKF9maWxlXykKCmRlZiBwZXJtaW50YWFuX3BlcnRlbWFuYW5fbWFzdWsoY29va2llcyk6CiAgICBfdXJsX2Rldl8gPSAnaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL2ZyaWVuZHMvY2VudGVyL3JlcXVlc3RzJztfZmlsZV8gPSAnZnJpZW5kX2xvZ2luLmpzb24nCiAgICB0cnk6b3MucmVtb3ZlKF9maWxlXykKICAgIGV4Y2VwdDpwYXNzCiAgICBwcmludCgiJXMgWyVz4oCiJXNdICVzUFJFU1MgQ1RSTCtDIFRPIFNUT1AgRFVNUCIlKEgsUCxILEspKTtleGVjX3Blcm1pbnRhYW5fcGVydGVtYW5hbl9tYXN1ayhfdXJsX2Rldl8sY29va2llcyxfZmlsZV8pO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgZXhlY19wZXJtaW50YWFuX3BlcnRlbWFuYW5fbWFzdWsodXJsLGNvb2tpZXMsX2ZpbGVfKToKICAgIG9wZW4oX2ZpbGVfLCdhJyk7X3JlcV9zZXNfID0gcmVxdWVzdHMuU2Vzc2lvbigpO19yZXFfZ2V0XyA9IF9yZXFfc2VzXy5nZXQodXJsLGNvb2tpZXM9Y29va2llcyxoZWFkZXJzPWhlYWRlcl9uYW1hKTtfc29wX2Rldl8gPSBwYXIoX3JlcV9nZXRfLnRleHQsJ2h0bWwucGFyc2VyJyk7cHJpbnQgKCJcciVzIFslc+KAoiVzXSAlc1RBS0lORyAlcyVzIElEIiUoSCxQLEgsSyxILGxlbihfYXppbXZhdV9kYXB1bnRhXyhfZmlsZV8pLnJlYWQoKS5zcGxpdGxpbmVzKCkpKSxlbmQ9JycpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgdHJ5OgogICAgICAgIGZvciBfYXppbXZhdV8gaW4gX3NvcF9kZXZfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICBpZiAnL2ZyaWVuZHMvaG92ZXJjYXJkJyBpbiBfYXppbXZhdV8uZ2V0KCdocmVmJyk6CiAgICAgICAgICAgICAgICB0cnk6X25hbWVfZGV2XyA9IF9hemltdmF1Xy50ZXh0O19pZF9kZXZfID0gIiIuam9pbihiczQucmUuZmluZGFsbCgndWlkPSguKj8pJicsX2F6aW12YXVfLmdldCgnaHJlZicpKSk7b3BlbihfZmlsZV8sJ2ErJykud3JpdGUoJyVz4oCiJXNcbiclKF9pZF9kZXZfLF9uYW1lX2Rldl8pKQogICAgICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgZWxzZTpwYXNzCiAgICAgICAgZm9yIF9hemltdmF1XyBpbiBfc29wX2Rldl8uZmluZF9hbGwoJ2EnLGhyZWY9VHJ1ZSk6CiAgICAgICAgICAgIGlmICdTZWUgTW9yZScgaW4gX2F6aW12YXVfLnRleHQ6dXJsX2RldiA9ICdodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vJyArIF9hemltdmF1Xy5nZXQoJ2hyZWYnKTtleGVjX3Blcm1pbnRhYW5fcGVydGVtYW5hbl9tYXN1ayh1cmxfZGV2LGNvb2tpZXMsX2ZpbGVfKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OnByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQoKCmRlZiBwZXJtaW50YWFuX3BlcnRlbWFuYW5fa2VsdWFyKGNvb2tpZXMpOgogICAgX3VybF9kZXZfID0gJ2h0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9mcmllbmRzL2NlbnRlci9yZXF1ZXN0cy9vdXRnb2luZyc7X2ZpbGVfID0gJ2ZyaWVuZF9vdXQuanNvbicKICAgIHRyeTpvcy5yZW1vdmUoX2ZpbGVfKQogICAgZXhjZXB0OnBhc3MKICAgIHByaW50KCIlcyBbJXPigKIlc10gJXNQUkVTUyBDVFJMK0MgVE8gU1RPUCBEVU1QIiUoSCxQLEgsSykpO2V4ZWNfcGVybWludGFhbl9wZXJ0ZW1hbmFuX2tlbHVhcihfdXJsX2Rldl8sY29va2llcyxfZmlsZV8pO3ByaW50KCJcbiVzIFslc+KAoiVzXSAlc1NVQ0NFU1NGVUwgRFVNUCAlcyBJRCIlKEgsUCxILEssbGVuKF9hemltdmF1X2RhcHVudGFfKF9maWxlXykucmVhZCgpLnNwbGl0bGluZXMoKSkpKTtyZXR1cm4gY3JhY2soX2ZpbGVfKQpkZWYgZXhlY19wZXJtaW50YWFuX3BlcnRlbWFuYW5fa2VsdWFyKHVybCxjb29raWVzLF9maWxlXyk6CiAgICBvcGVuKF9maWxlXywnYScpO19yZXFfc2VzXyA9IHJlcXVlc3RzLlNlc3Npb24oKTtfcmVxX2dldF8gPSBfcmVxX3Nlc18uZ2V0KHVybCxjb29raWVzPWNvb2tpZXMsaGVhZGVycz1oZWFkZXJfbmFtYSk7X3NvcF9kZXZfID0gcGFyKF9yZXFfZ2V0Xy50ZXh0LCdodG1sLnBhcnNlcicpO3ByaW50ICgiXHIlcyBbJXPigKIlc10gJXNUQUtJTkcgJXMlcyBJRCIlKEgsUCxILEssSCxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSksZW5kPScnKTtzeXMuc3Rkb3V0LmZsdXNoKCkKICAgIHRyeToKICAgICAgICBmb3IgX2F6aW12YXVfIGluIF9zb3BfZGV2Xy5maW5kX2FsbCgnYScsaHJlZj1UcnVlKToKICAgICAgICAgICAgaWYgJy9mcmllbmRzL2hvdmVyY2FyZCcgaW4gX2F6aW12YXVfLmdldCgnaHJlZicpOgogICAgICAgICAgICAgICAgdHJ5Ol9uYW1lX2Rldl8gPSBfYXppbXZhdV8udGV4dDtfaWRfZGV2XyA9ICIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoJ3VpZD0oLio/KSYnLF9hemltdmF1Xy5nZXQoJ2hyZWYnKSkpO29wZW4oX2ZpbGVfLCdhKycpLndyaXRlKCclc+KAoiVzXG4nJShfaWRfZGV2XyxfbmFtZV9kZXZfKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgIGVsc2U6cGFzcwogICAgICAgIGZvciBfYXppbXZhdV8gaW4gX3NvcF9kZXZfLmZpbmRfYWxsKCdhJyxocmVmPVRydWUpOgogICAgICAgICAgICBpZiAnU2VlIE1vcmUnIGluIF9hemltdmF1Xy50ZXh0OnVybF9kZXYgPSAnaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLycgKyBfYXppbXZhdV8uZ2V0KCdocmVmJyk7ZXhlY19wZXJtaW50YWFuX3BlcnRlbWFuYW5fa2VsdWFyKHVybF9kZXYsY29va2llcyxfZmlsZV8pCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6cHJpbnQoIlxuJXMgWyVz4oCiJXNdICVzU1VDQ0VTU0ZVTCBEVU1QICVzIElEIiUoSCxQLEgsSyxsZW4oX2F6aW12YXVfZGFwdW50YV8oX2ZpbGVfKS5yZWFkKCkuc3BsaXRsaW5lcygpKSkpO3JldHVybiBjcmFjayhfZmlsZV8pCgojIyMgQ2VrIFRhcmdldCBDcmFjawpkZWYgY2VrX3RhcmdldF9jcmFja18oX2lkXyk6CiAgICBvcGVuKCdsaXN0X2lkLnR4dCcsJ2ErJykKICAgIHRyeToKICAgICAgICBfY2VrXyA9IG9wZW4oJ2xpc3RfaWQudHh0JywncicpLnJlYWQoKQogICAgICAgIGlmIF9pZF8gaW4gX2Nla186CiAgICAgICAgICAgIGlmIF9pZF8gPT0gJ21lJzpwYXNzCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBfY29renpfID0gX2NpY2lfYXppbXZhdV8oJyVzIFslcyElc10gJXNJRCBIQVMgQkVFTiBDUkFDS0VELCBDT05USU5VRT8gW1kvbl0gOiAnJShNLFAsTSxQKSkKICAgICAgICAgICAgICAgIGlmIF9jb2t6el8gaW4gWycnLCcgJ106cGFzcwogICAgICAgICAgICAgICAgZWxpZiBfY29renpfIGluIFsnMScsJzAxJywneSddOnBhc3MKICAgICAgICAgICAgICAgIGVsaWYgX2Nva3p6XyBpbiBbJzInLCcwJywnbiddOm1lbnUoKQogICAgICAgICAgICAgICAgZWxzZTpwYXNzCiAgICAgICAgZWxzZTpfYXppbXZhdV9kYXB1bnRhXygnbGlzdF9pZC50eHQnLCJhKyIpLndyaXRlKCIlc1xuIiUoX2lkXykpCiAgICBleGNlcHQ6cGFzcwoKIyMjIEdlbmVyYXRlIFBhc3N3b3JkCmRlZiBnZW5lcmF0ZTEoX2NpY2lfKToKICAgIF9hemltdmF1Xz1bXQogICAgZm9yIGkgaW4gX2NpY2lfLnNwbGl0KCIgIik6CiAgICAgICAgaWYgbGVuKGkpPDM6Y29udGludWUgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaT1pLmxvd2VyKCkKICAgICAgICAgICAgaWYgbGVuKGkpPT0zIG9yIGxlbihpKT09NCBvciBsZW4oaSk9PTU6X2F6aW12YXVfLmFwcGVuZChpKyIxMjMiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1Iik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0NTY3ODkiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1NiIpCiAgICAgICAgICAgIGVsaWYgbGVuKGkpPj02Ol9hemltdmF1Xy5hcHBlbmQoaSk7X2F6aW12YXVfLmFwcGVuZChpKyIxMjMiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1Iik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0NTY3ODkiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1NiIpCiAgICAgICAgICAgIGVsc2U6Y29udGludWUKICAgIF9hemltdmF1Xy5hcHBlbmQoX2NpY2lfLmxvd2VyKCkpCiAgICByZXR1cm4gX2F6aW12YXVfCgpkZWYgZ2VuZXJhdGUyKF9jaWNpXyk6CiAgICBfYXppbXZhdV89W10KICAgIGZvciBpIGluIF9jaWNpXy5zcGxpdCgiICIpOgogICAgICAgIGlmIGxlbihpKTwzOmNvbnRpbnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaT1pLmxvd2VyKCkKICAgICAgICAgICAgaWYgbGVuKGkpPT0zIG9yIGxlbihpKT09NCBvciBsZW4oaSk9PTU6X2F6aW12YXVfLmFwcGVuZChpKyIxMjMiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1IikKICAgICAgICAgICAgZWxzZTpfYXppbXZhdV8uYXBwZW5kKGkpO19hemltdmF1Xy5hcHBlbmQoaSsiMTIiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjIwMDAiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjExMjIzMzQ0IikKICAgIF9hemltdmF1Xy5hcHBlbmQoX2NpY2lfLmxvd2VyKCkpO19hemltdmF1Xy5hcHBlbmQoX2NpY2lfLmxvd2VyKCkuc3BsaXQoIiAiKVswXStfY2ljaV8ubG93ZXIoKS5zcGxpdCgiICIpWzFdKQogICAgcmV0dXJuIF9hemltdmF1XwoKZGVmIGdlbmVyYXRlMyhfY2ljaV8pOgogICAgX2F6aW12YXVfPVtdCiAgICBmb3IgaSBpbiBfY2ljaV8uc3BsaXQoIiAiKToKICAgICAgICBpZiBsZW4oaSk8Mzpjb250aW51ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGk9aS5sb3dlcigpCiAgICAgICAgICAgIGlmIGxlbihpKT09MyBvciBsZW4oaSk9PTQgb3IgbGVuKGkpPT01Ol9hemltdmF1Xy5hcHBlbmQoaSsiMTIzIik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0Iik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0NSIpO19hemltdmF1Xy5hcHBlbmQoaSsiMjAwMiIpCiAgICAgICAgICAgIGVsc2U6X2F6aW12YXVfLmFwcGVuZChpKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1Njc4Iik7X2F6aW12YXVfLmFwcGVuZChpKyIxMiIpO19hemltdmF1Xy5hcHBlbmQoaSsiMTIzIik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0Iik7X2F6aW12YXVfLmFwcGVuZChpKyIxMjM0NSIpO19hemltdmF1Xy5hcHBlbmQoaS51cHBlcigpKyIxMjMiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjIwMDEiKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMzQ1Njc4OSIpCiAgICBfYXppbXZhdV8uYXBwZW5kKF9jaWNpXy5sb3dlcigpKTtfYXppbXZhdV8uYXBwZW5kKF9jaWNpXy5sb3dlcigpLnNwbGl0KCIgIilbMF0rX2NpY2lfLmxvd2VyKCkuc3BsaXQoIiAiKVsxXSk7X2F6aW12YXVfLmFwcGVuZChfY2ljaV8ubG93ZXIoKS5zcGxpdCgiICIpWzBdK19jaWNpXy5sb3dlcigpLnNwbGl0KCIgIilbMV0rIjEyIik7X2F6aW12YXVfLmFwcGVuZChfY2ljaV8ubG93ZXIoKS5zcGxpdCgiICIpWzBdK19jaWNpXy5sb3dlcigpLnNwbGl0KCIgIilbMV0rIjEyMyIpO19hemltdmF1Xy5hcHBlbmQoIjExMjIzMzQ0NTUiKQogICAgcmV0dXJuIF9hemltdmF1XwoKCmRlZiBnZW5lcmF0ZTQoX2NpY2lfKToKICAgIF9hemltdmF1Xz1bXQogICAgcHMgPSBfYXppbXZhdV9kYXB1bnRhXygncGFzcy50eHQnLCdyJykucmVhZCgpCiAgICBwcCA9IF9hemltdmF1X2RhcHVudGFfKCdkaWdpdHBhc3MudHh0JywncicpLnJlYWQoKQogICAgZm9yIGkgaW4gX2NpY2lfLnNwbGl0KCIgIik6ICAKICAgICAgICBpPWkubG93ZXIoKQogICAgICAgIGlmIGxlbihpKTwzOmNvbnRpbnVlCiAgICAgICAgZWxpZiBsZW4oaSk9PTMgb3IgbGVuKGkpPT00IG9yIGxlbihpKT09NTpfYXppbXZhdV8uYXBwZW5kKGkrIjEyMyIpO19hemltdmF1Xy5hcHBlbmQoaSsiMTIzNDUiKQogICAgICAgIGVsc2U6X2F6aW12YXVfLmFwcGVuZChpKTtfYXppbXZhdV8uYXBwZW5kKGkrIjEyMyIpO19hemltdmF1Xy5hcHBlbmQoaSsiMTIzNDUiKQogICAgaWYgcHAgaW4gWycnLCcgJywnICAnXTpwYXNzCiAgICBlbHNlOgogICAgICAgIGZvciBpIGluIF9jaWNpXy5zcGxpdCgiICIpOiAgCiAgICAgICAgICAgIGk9aS5sb3dlcigpCiAgICAgICAgICAgIGZvciB4IGluIHBwLnNwbGl0KCcsJyk6X2F6aW12YXVfLmFwcGVuZChpK3gpCiAgICBpZiBwcyBpbiBbJycsJyAnLCcgICddOnBhc3MKICAgIGVsc2U6CiAgICAgICAgZm9yIHogaW4gcHMuc3BsaXQoJywnKTpfYXppbXZhdV8uYXBwZW5kKHopCiAgICBfYXppbXZhdV8uYXBwZW5kKF9jaWNpXy5sb3dlcigpKQogICAgcmV0dXJuIF9hemltdmF1XwpkZWYgdGFtYmFoX3Bhc3MoKToKICAgIHByaW50KCclcyAnJShPKSk7cHJpbnQoJyVzIFslc+KAoiVzXSAlc0VYQU1QTEUgOiAlNzc4ODk5LDEyMzQ1NiwxMDIwMzAsNzg2Nzg2JyUoSCxQLEgsSyxIKSk7Y3V5ID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIE1BTlVBTCBTVVBQTEVNRU5UQUwgUEFTUyBbMSBXT1JEXSA6ICclKEgsUCxILEspKTtnaCA9IF9hemltdmF1X2RhcHVudGFfKCdwYXNzLnR4dCcsJ3cnKTtnaC53cml0ZShjdXkpO2doLmNsb3NlCmRlZiB0YW1iYWhfcGFzc19hbmdrYSgpOgogICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc0VYQU1QTEUgOiAlczE0Myw3ODYsZ2FtaW5nJyUoSCxQLEgsSyxIKSk7Y295ID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIEFERElUSU9OQUwgUEFTUyBCRUhJTkQgTkFNRSA6ICclKEgsUCxILEspKTt4eSA9IF9hemltdmF1X2RhcHVudGFfKCdkaWdpdHBhc3MudHh0JywndycpO3h5LndyaXRlKGNveSk7eHkuY2xvc2UKICAgIAojIyMgTG9nZ2VyIENyYWNrCmRlZiBsb2dfYXBpXzEoZW0scGFzKToKICAgIHVhID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIHIgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIGhlYWRlciA9IHsieC1mYi1jb25uZWN0aW9uLWJhbmR3aWR0aCI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMDAwMC4wLCAzMDAwMDAwMC4wKSksIngtZmItc2ltLWhuaSI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMCwgNDAwMDApKSwieC1mYi1uZXQtaG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLCJ4LWZiLWNvbm5lY3Rpb24tcXVhbGl0eSI6ICJFWENFTExFTlQiLCJ4LWZiLWNvbm5lY3Rpb24tdHlwZSI6ICJjZWxsLkNUUmFkaW9BY2Nlc3NUZWNobm9sb2d5SFNEUEEiLCJ1c2VyLWFnZW50IjogdWEsImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLCJ4LWZiLWh0dHAtZW5naW5lIjogIkxpZ2VyIn0KICAgIHJlc3BvbnNlID0gci5nZXQoJ2h0dHBzOi8vYi1hcGkuZmFjZWJvb2suY29tL21ldGhvZC9hdXRoLmxvZ2luP2Zvcm1hdD1qc29uJmVtYWlsPScgKyBlbSArICcmcGFzc3dvcmQ9JyArIHBhcyArICcmY3JlZGVudGlhbHNfdHlwZT1kZXZpY2VfYmFzZWRfbG9naW5fcGFzc3dvcmQmZ2VuZXJhdGVfc2Vzc2lvbl9jb29raWVzPTEmZXJyb3JfZGV0YWlsX3R5cGU9YnV0dG9uX3dpdGhfZGlzYWJsZWQmc291cmNlPWRldmljZV9iYXNlZF9sb2dpbiZtZXRhX2luZl9mYm1ldGE9JTIwJmN1cnJlbnRseV9sb2dnZWRfaW5fdXNlcmlkPTAmbWV0aG9kPUdFVCZsb2NhbGU9ZW5fVVMmY2xpZW50X2NvdW50cnlfY29kZT1VUyZmYl9hcGlfY2FsbGVyX2NsYXNzPWNvbS5mYWNlYm9vay5mb3MuaGVhZGVyc3YyLmZiNGFvcmNhLkhlYWRlcnNWMkNvbmZpZ0ZldGNoUmVxdWVzdEhhbmRsZXImYWNjZXNzX3Rva2VuPTM1MDY4NTUzMTcyOHw2MmY4Y2U5Zjc0YjEyZjg0YzEyM2NjMjM0MzdhNGEzMiZmYl9hcGlfcmVxX2ZyaWVuZGx5X25hbWU9YXV0aGVudGljYXRlJmNwbD10cnVlJywgaGVhZGVycz1oZWFkZXIpCiAgICBpZiAnc2Vzc2lvbl9rZXknIGluIHJlc3BvbnNlLnRleHQgYW5kICdFQUFBJyBpbiByZXNwb25zZS50ZXh0OnJldHVybiB7InN0YXR1cyI6Im9rIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CiAgICBlbGlmICd3d3cuZmFjZWJvb2suY29tJyBpbiByZXNwb25zZS5qc29uKClbJ2Vycm9yX21zZyddOnJldHVybiB7InN0YXR1cyI6ImNwIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CiAgICBlbHNlOnJldHVybiB7InN0YXR1cyI6ImVycm9yIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CmRlZiBsb2dfYXBpXzIoZW0scGFzKToKICAgIHVhID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIHIgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIGhlYWRlciA9IHsieC1mYi1jb25uZWN0aW9uLWJhbmR3aWR0aCI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMDAwMC4wLCAzMDAwMDAwMC4wKSksIngtZmItc2ltLWhuaSI6IHN0cihyYW5kb20ucmFuZGludCgyMDAwMCwgNDAwMDApKSwieC1mYi1uZXQtaG5pIjogc3RyKHJhbmRvbS5yYW5kaW50KDIwMDAwLCA0MDAwMCkpLCJ4LWZiLWNvbm5lY3Rpb24tcXVhbGl0eSI6ICJFWENFTExFTlQiLCJ4LWZiLWNvbm5lY3Rpb24tdHlwZSI6ICJjZWxsLkNUUmFkaW9BY2Nlc3NUZWNobm9sb2d5SFNEUEEiLCJ1c2VyLWFnZW50IjogdWEsImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLCJ4LWZiLWh0dHAtZW5naW5lIjogIkxpZ2VyIn0KICAgIHBhcmFtID0geydhY2Nlc3NfdG9rZW4nOiAnMzUwNjg1NTMxNzI4JTdDNjJmOGNlOWY3NGIxMmY4NGMxMjNjYzIzNDM3YTRhMzInLCAnZm9ybWF0JzogJ2pzb24nLCAnc2RrX3ZlcnNpb24nOiAnMicsICdlbWFpbCc6IGVtLCAnbG9jYWxlJzogJ2VuX1VTJywgJ3Bhc3N3b3JkJzogcGFzLCAnc2RrJzogJ2lvcycsICdnZW5lcmF0ZV9zZXNzaW9uX2Nvb2tpZXMnOiAnMScsICdzaWcnOiczZjU1NWY5OWZiNjFmY2Q3YWEwYzQ0ZjU4ZjUyMmVmNid9CiAgICBhcGkgPSAnaHR0cHM6Ly9iLWFwaS5mYWNlYm9vay5jb20vbWV0aG9kL2F1dGgubG9naW4nCiAgICByZXNwb25zZSA9IHIuZ2V0KGFwaSwgcGFyYW1zPXBhcmFtLCBoZWFkZXJzPWhlYWRlcikKICAgIGlmICdzZXNzaW9uX2tleScgaW4gcmVzcG9uc2UudGV4dCBhbmQgJ0VBQUEnIGluIHJlc3BvbnNlLnRleHQ6cmV0dXJuIHsic3RhdHVzIjoib2siLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsaWYgJ3d3dy5mYWNlYm9vay5jb20nIGluIHJlc3BvbnNlLmpzb24oKVsnZXJyb3JfbXNnJ106cmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KZGVmIGxvZ19tYmFzaWNfMShlbSxwYXMpOgogICAgdWEgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywncicpLnJlYWQoKQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgci5oZWFkZXJzLnVwZGF0ZSh7Ikhvc3QiOiJtYmFzaWMuZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiZW4tR0IsZW4tVVM7cT0wLjksZW47cT0wLjgsYm47cT0wLjcifSkKICAgIHAgPSByLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIpCiAgICBiID0gci5wb3N0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vbG9naW4ucGhwIiwgZGF0YT17ImVtYWlsIjogZW0sICJwYXNzIjogcGFzLCAibG9naW4iOiAic3VibWl0In0pCiAgICBfcmF3X2Nvb2tpZXNfID0gKCI7Iikuam9pbihbICIlcz0lcyIgJSAoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgaW4gci5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKSBdKQogICAgaWYgImNfdXNlciIgaW4gci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpOnJldHVybiB7InN0YXR1cyI6Im9rIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOl9yYXdfY29va2llc199CiAgICBlbGlmICJjaGVja3BvaW50IiBpbiByLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCk6cmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6X3Jhd19jb29raWVzX30KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KZGVmIGxvZ19tYmFzaWNfMihlbSxwYXMpOgogICAgdWEgPSBfYXppbXZhdV9kYXB1bnRhXygndWdlbnQudHh0JywncicpLnJlYWQoKQogICAgciA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgci5oZWFkZXJzLnVwZGF0ZSh7Ikhvc3QiOiJtYmFzaWMuZmFjZWJvb2suY29tIiwiY2FjaGUtY29udHJvbCI6Im1heC1hZ2U9MCIsInVwZ3JhZGUtaW5zZWN1cmUtcmVxdWVzdHMiOiIxIiwidXNlci1hZ2VudCI6dWEsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgiLCJhY2NlcHQtZW5jb2RpbmciOiJnemlwLCBkZWZsYXRlIiwiYWNjZXB0LWxhbmd1YWdlIjoiZW4tR0IsZW4tVVM7cT0wLjksZW47cT0wLjgsYm47cT0wLjcifSkKICAgIHAgPSByLmdldCgiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tLyIpCiAgICBiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCJodG1sLnBhcnNlciIpCiAgICBtZXRhPSIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoJ2R0c2ciOlx7InRva2VuIjoiKC4qPykiJyxwLnRleHQpKQogICAgZGF0YT17fQogICAgZm9yIGkgaW4gYigiaW5wdXQiKToKICAgICAgICBpZiBpLmdldCgidmFsdWUiKSBpcyBOb25lOgogICAgICAgICAgICBpZiBpLmdldCgibmFtZSIpPT0iZW1haWwiOmRhdGEudXBkYXRlKHsiZW1haWwiOmVtfSkKICAgICAgICAgICAgZWxpZiBpLmdldCgibmFtZSIpPT0icGFzcyI6ZGF0YS51cGRhdGUoeyJwYXNzIjpwYXN9KQogICAgICAgICAgICBlbHNlOmRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOiIifSkKICAgICAgICBlbHNlOmRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOmkuZ2V0KCJ2YWx1ZSIpfSkKICAgIGRhdGEudXBkYXRlKHsiZmJfZHRzZyI6bWV0YSwibV9zZXNzIjoiIiwiX191c2VyIjoiMCIsIl9fcmVxIjoiZCIsIl9fY3NyIjoiIiwiX19hIjoiIiwiX19keW4iOiIiLCJlbmNwYXNzIjoiIn0pCiAgICByLmhlYWRlcnMudXBkYXRlKHsicmVmZXJlciI6Imh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9sb2dpbi8/bmV4dCZyZWY9ZGJsJmZsJnJlZmlkPTgifSkKICAgIHBvID0gci5wb3N0KCJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vbG9naW4vZGV2aWNlLWJhc2VkL2xvZ2luL2FzeW5jLz9yZWZzcmM9aHR0cHMlM0ElMkYlMkZtLmZhY2Vib29rLmNvbSUyRmxvZ2luJTJGJTNGcmVmJTNEZGJsJmx3dj0xMDAiLGRhdGE9ZGF0YSkudGV4dAogICAgX3Jhd19jb29raWVzXyA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIHIuY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgIGlmICJjX3VzZXIiIGluIGxpc3Qoci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpKTpyZXR1cm4geyJzdGF0dXMiOiJvayIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpfcmF3X2Nvb2tpZXNffQogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOnJldHVybiB7InN0YXR1cyI6ImNwIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOl9yYXdfY29va2llc199CiAgICBlbHNlOnJldHVybiB7InN0YXR1cyI6ImVycm9yIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CmRlZiBsb2dfbW9iaWxlXzEoZW0scGFzKToKICAgIHVhID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIHIgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIHIuaGVhZGVycy51cGRhdGUoeyJIb3N0IjoibS5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50Ijp1YSwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJlbi1HQixlbi1VUztxPTAuOSxlbjtxPTAuOCxibjtxPTAuNyJ9KQogICAgcCA9IHIuZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tLyIpCiAgICBiID0gci5wb3N0KCJodHRwczovL20uZmFjZWJvb2suY29tL2xvZ2luLnBocCIsIGRhdGE9eyJlbWFpbCI6IGVtLCAicGFzcyI6IHBhcywgImxvZ2luIjogInN1Ym1pdCJ9KQogICAgX3Jhd19jb29raWVzXyA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIHIuY29va2llcy5nZXRfZGljdCgpLml0ZW1zKCkgXSkKICAgIGlmICJjX3VzZXIiIGluIHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKTpyZXR1cm4geyJzdGF0dXMiOiJvayIsImVtYWlsIjplbSwicGFzcyI6cGFzLCJjb29raWVzIjpfcmF3X2Nvb2tpZXNffQogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gci5jb29raWVzLmdldF9kaWN0KCkua2V5cygpOnJldHVybiB7InN0YXR1cyI6ImNwIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOl9yYXdfY29va2llc199CiAgICBlbHNlOnJldHVybiB7InN0YXR1cyI6ImVycm9yIiwiZW1haWwiOmVtLCJwYXNzIjpwYXN9CmRlZiBsb2dfbW9iaWxlXzIoZW0scGFzKToKICAgIHVhID0gX2F6aW12YXVfZGFwdW50YV8oJ3VnZW50LnR4dCcsJ3InKS5yZWFkKCkKICAgIHIgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIHIuaGVhZGVycy51cGRhdGUoeyJIb3N0IjoibS5mYWNlYm9vay5jb20iLCJjYWNoZS1jb250cm9sIjoibWF4LWFnZT0wIiwidXBncmFkZS1pbnNlY3VyZS1yZXF1ZXN0cyI6IjEiLCJ1c2VyLWFnZW50Ijp1YSwiYWNjZXB0IjoidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJlbi1HQixlbi1VUztxPTAuOSxlbjtxPTAuOCxibjtxPTAuNyJ9KQogICAgcCA9IHIuZ2V0KCJodHRwczovL20uZmFjZWJvb2suY29tLyIpCiAgICBiID0gYnM0LkJlYXV0aWZ1bFNvdXAocC50ZXh0LCJodG1sLnBhcnNlciIpCiAgICBtZXRhPSIiLmpvaW4oYnM0LnJlLmZpbmRhbGwoJ2R0c2ciOlx7InRva2VuIjoiKC4qPykiJyxwLnRleHQpKQogICAgZGF0YT17fQogICAgZm9yIGkgaW4gYigiaW5wdXQiKToKICAgICAgICBpZiBpLmdldCgidmFsdWUiKSBpcyBOb25lOgogICAgICAgICAgICBpZiBpLmdldCgibmFtZSIpPT0iZW1haWwiOmRhdGEudXBkYXRlKHsiZW1haWwiOmVtfSkKICAgICAgICAgICAgZWxpZiBpLmdldCgibmFtZSIpPT0icGFzcyI6ZGF0YS51cGRhdGUoeyJwYXNzIjpwYXN9KQogICAgICAgICAgICBlbHNlOmRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOiIifSkKICAgICAgICBlbHNlOmRhdGEudXBkYXRlKHtpLmdldCgibmFtZSIpOmkuZ2V0KCJ2YWx1ZSIpfSkKICAgIGRhdGEudXBkYXRlKHsiZmJfZHRzZyI6bWV0YSwibV9zZXNzIjoiIiwiX191c2VyIjoiMCIsIl9fcmVxIjoiZCIsIl9fY3NyIjoiIiwiX19hIjoiIiwiX19keW4iOiIiLCJlbmNwYXNzIjoiIn0pCiAgICByLmhlYWRlcnMudXBkYXRlKHsicmVmZXJlciI6Imh0dHBzOi8vbS5mYWNlYm9vay5jb20vbG9naW4vP25leHQmcmVmPWRibCZmbCZyZWZpZD04In0pCiAgICBwbyA9IHIucG9zdCgiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS9sb2dpbi9kZXZpY2UtYmFzZWQvbG9naW4vYXN5bmMvP3JlZnNyYz1odHRwcyUzQSUyRiUyRm0uZmFjZWJvb2suY29tJTJGbG9naW4lMkYlM0ZyZWYlM0RkYmwmbHd2PTEwMCIsZGF0YT1kYXRhKS50ZXh0CiAgICBfcmF3X2Nvb2tpZXNfID0gKCI7Iikuam9pbihbICIlcz0lcyIgJSAoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgaW4gci5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKSBdKQogICAgaWYgImNfdXNlciIgaW4gbGlzdChyLmNvb2tpZXMuZ2V0X2RpY3QoKS5rZXlzKCkpOnJldHVybiB7InN0YXR1cyI6Im9rIiwiZW1haWwiOmVtLCJwYXNzIjpwYXMsImNvb2tpZXMiOl9yYXdfY29va2llc199CiAgICBlbGlmICJjaGVja3BvaW50IiBpbiBsaXN0KHIuY29va2llcy5nZXRfZGljdCgpLmtleXMoKSk6cmV0dXJuIHsic3RhdHVzIjoiY3AiLCJlbWFpbCI6ZW0sInBhc3MiOnBhcywiY29va2llcyI6X3Jhd19jb29raWVzX30KICAgIGVsc2U6cmV0dXJuIHsic3RhdHVzIjoiZXJyb3IiLCJlbWFpbCI6ZW0sInBhc3MiOnBhc30KCiMjIyBDaGVjayBPcHNpCmRlZiBjZWtfb3BzaSh1c2VyLHB3LGZvcm1hdCk6CiAgICBfcmVxX3Nlc18gPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgIHRyeTpjZWtfZGV2X29wc2kgICAgICAgICAgPSBvcGVuKCdvcHRpb25fLnR4dCcsJ3InKS5yZWFkKCkKICAgIGV4Y2VwdDpjZWtfZGV2X29wc2kgICAgICAgPSAnbnVsbCcKICAgIHRyeTpfYXV0b19jaGFuZ2VfcGFzc18gICAgPSBvcGVuKCdhdXRvX2dhbnRpLnR4dCcsJ3InKS5yZWFkKCkKICAgIGV4Y2VwdDpfYXV0b19jaGFuZ2VfcGFzc18gPSAnWWVzJwogICAgdHJ5OmNla19waWxpaF9vcHNpICAgICAgICA9IG9wZW4oJ211bmN1bF9vcHNpLnR4dCcsJ3InKS5yZWFkKCkKICAgIGV4Y2VwdDpjZWtfcGlsaWhfb3BzaSAgICAgPSAnTm8nCiAgICBfcmVxX3Nlc18uaGVhZGVycy51cGRhdGUoeyJIb3N0IjoibWJhc2ljLmZhY2Vib29rLmNvbSIsImFjY2VwdCI6InRleHQvaHRtbCxhcHBsaWNhdGlvbi94aHRtbCt4bWwsYXBwbGljYXRpb24veG1sO3E9MC45LGltYWdlL2F2aWYsaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuOSIsImFjY2VwdC1lbmNvZGluZyI6Imd6aXAsIGRlZmxhdGUiLCJhY2NlcHQtbGFuZ3VhZ2UiOiJlbi1HQixlbi1VUztxPTAuOSIsInJlZmVyZXIiOiJodHRwczovL21iYXNpYy5mYWNlYm9vay5jb20vIiwidXNlci1hZ2VudCI6dWFfeGlhb21pfSk7X3NvcF9kZXZfID0gcGFyKF9yZXFfc2VzXy5nZXQoaG9zdCsiL2xvZ2luLz9uZXh0JnJlZj1kYmwmZmwmcmVmaWQ9OCIpLnRleHQsImh0bWwucGFyc2VyIik7X2xpbmt1cmxfID0gX3NvcF9kZXZfLmZpbmQoImZvcm0iLHsibWV0aG9kIjoicG9zdCJ9KQogICAgZm9yIF9jaWNpXyBpbiBfc29wX2Rldl8oImlucHV0Iik6ZGF0YV8xLnVwZGF0ZSh7X2NpY2lfLmdldCgibmFtZSIpOl9jaWNpXy5nZXQoInZhbHVlIil9KQogICAgZGF0YV8xLnVwZGF0ZSh7ImVtYWlsIjp1c2VyLCJwYXNzIjpwd30pO191cmxfcG9zdF8gPSBfcmVxX3Nlc18ucG9zdChob3N0K19saW5rdXJsXy5nZXQoImFjdGlvbiIpLGRhdGE9ZGF0YV8xKTtfcmVzcG9uc2VfID0gcGFyKF91cmxfcG9zdF8udGV4dCwgImh0bWwucGFyc2VyIikKICAgIGlmICJjX3VzZXIiIGluIF9yZXFfc2VzXy5jb29raWVzLmdldF9kaWN0KCk6CiAgICAgICAgaWYgInlvdXIgYWNjb3VudCBoYXMgYmVlbiBsb2NrZWQiIGluIF91cmxfcG9zdF8udGV4dDpwYXNzCiAgICAgICAgZWxzZTpfY29va2llc18gPSAnJy5qb2luKF9yZXFfc2VzXy5jb29raWVzLmdldF9kaWN0KCkpO19yZXN1bHRfb2tfID0gIlxyICVzWyVTVUNDRVNTRlVMTCVzXSAlcyDigKIgJXMlcyVzICAgICAgICAgICIlKEgsUCxILHVzZXIscHcsdGFodW4odXNlciksUCk7Y2VrX2FwayhfcmVzdWx0X29rXyxjdnRfY29va2llcyhfY29va2llc18pKQogICAgZWxpZiAiY2hlY2twb2ludCIgaW4gX3JlcV9zZXNfLmNvb2tpZXMuZ2V0X2RpY3QoKToKICAgICAgICBfcmF0eWFfID0gMDtqdW1sYWhfb3BzaSAgPSBbXTtfdGl0bGVfZGV2XyA9IHJlLmZpbmRhbGwoIlw8dGl0bGU+KC4qPyk8XC90aXRsZT4iLHN0cihfcmVzcG9uc2VfKSk7bGlua18yID0gX3Jlc3BvbnNlXy5maW5kKCJmb3JtIix7Im1ldGhvZCI6InBvc3QifSk7bGlzdF9pbnB1dCA9IFsnZmJfZHRzZycsJ2phem9lc3QnLCdjaGVja3BvaW50X2RhdGEnLCdzdWJtaXRbQ29udGludWVdJywnbmgnXQogICAgICAgIGZvciBfYXppbXZhdV8gaW4gX3Jlc3BvbnNlXygiaW5wdXQiKToKICAgICAgICAgICAgaWYgX2F6aW12YXVfLmdldCgibmFtZSIpIGluIGxpc3RfaW5wdXQ6ZGF0YV8yLnVwZGF0ZSh7X2F6aW12YXVfLmdldCgibmFtZSIpOl9hemltdmF1Xy5nZXQoInZhbHVlIil9KQogICAgICAgIF9yZXFfYWN0XyA9IF9yZXFfc2VzXy5wb3N0KGhvc3QrbGlua18yLmdldCgiYWN0aW9uIiksZGF0YT1kYXRhXzIpO19yZXNwb25zZTJfID0gcGFyKF9yZXFfYWN0Xy50ZXh0LCJodG1sLnBhcnNlciIpO19jaGVja19vcHNpXyAgPSBbX3NhbHNhYmlsYV8udGV4dCBmb3IgX3NhbHNhYmlsYV8gaW4gX3Jlc3BvbnNlMl8uZmluZF9hbGwoIm9wdGlvbiIpXQogICAgICAgIGlmIGxlbihfY2hlY2tfb3BzaV8pPT0wOgogICAgICAgICAgICBpZiAiQ2hlY2sgdGhlIGxvZ2luIGRldGFpbHMgc2hvd24uIFdhcyBpdCB5b3U/IiBpbiBfdGl0bGVfZGV2XzoKICAgICAgICAgICAgICAgIGlmIF9hdXRvX2NoYW5nZV9wYXNzXyA9PSAnWWVzJzpjaGFuZ2VfcGFzcyh1c2VyLF9yZXFfc2VzXyxfcmVzcG9uc2VfLGxpbmtfMikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgY2VrX3BpbGloX29wc2kgPT0gJ1llcyc6cHJpbnQoZm9ybWF0KTtwcmludCgnICAgJXPigKIgJXNPTkUgVEFQIEFDQ09VTlQnJShILFApKTtwcmludCgiIikKICAgICAgICAgICAgICAgICAgICBlbHNlOnByaW50KGZvcm1hdCk7cHJpbnQoJyAgICVz4oCiICVzT05FIFRBUCBBQ0NPVU5UJyUoSCxQKSkKICAgICAgICAgICAgZWxzZTpwYXNzCiAgICAgICAgZWxpZiBsZW4oX2NoZWNrX29wc2lfKSE9MDoKICAgICAgICAgICAgaWYgY2VrX3BpbGloX29wc2kgPT0gJ1llcyc6CiAgICAgICAgICAgICAgICBmb3IgX2FzdV8gaW4gcmFuZ2UobGVuKF9jaGVja19vcHNpXykpOl9yYXR5YV8gKz0gMTtqdW1sYWhfb3BzaS5hcHBlbmQoIlxuICAgICAiK1Arc3RyKF9hc3VfKzEpKyIuICIrX2NoZWNrX29wc2lfW19hc3VfXSsiICIpCiAgICAgICAgICAgICAgICBqdW1vcCA9ICgnJXMgICBIRVJFIEFSRSAlcyBPUFRJT05TIDogJyUoUCxzdHIobGVuKGp1bWxhaF9vcHNpKSkpKTtwcmludChmb3JtYXQpO3ByaW50KGp1bW9wKyIiLmpvaW4oanVtbGFoX29wc2kpKTtwcmludCgiIikKICAgICAgICAgICAgZWxzZTpwcmludChmb3JtYXQpCiAgICBlbHNlOgogICAgICAgIGlmICdyZXN1bHQnIGluIGNla19kZXZfb3BzaTpwcmludChmb3JtYXQpO3ByaW50KCIlcyAgIFslcyElc10gJXNQQVNTV09SRCBIQVMgQ0hBTkdFRCA6KCIlKFAsTSxQLE0pKTtwcmludCgnJykKICAgICAgICBlbHNlOnByaW50KGZvcm1hdCkKCiMjIyBHYW50aSBQYXNzd29yZApkZWYgYXV0b19nYW50aV9wYXNzKF9waXllXyk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIF9naW1hbmFfID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0NIQU5HRSBPTkUgVEFQIEFDQ09VTlQgUEFTUz8gW1kvbl0gOiAnJShILFAsSCxLKSkKICAgICAgICBpZiBfZ2ltYW5hXyBpbiBbJyddOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgZWxpZiBfZ2ltYW5hXyBpbiBbJzEnLCcwMScsJzAwMScsJ3knLCdZJ106CiAgICAgICAgICAgIG9wZW4oJ2F1dG9fZ2FudGkudHh0JywndycpLndyaXRlKCdZZXMnKTtfbmV3cGFzc18gPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzRU5URVIgT05FIFRBUCBQQVNTV09SRCA6ICclKEgsUCxILEspKQogICAgICAgICAgICBpZiBsZW4oX25ld3Bhc3NfKTw2OnByaW50KCclcyBbJXMhJXNdICVzU2FuZGkgTWluaW1hbCA2IEthcmFrdGVyJyUoTSxQLE0sUCkpO3RpbWUuc2xlZXAoMyk7bWVudSgpCiAgICAgICAgICAgIGVsc2U6b3BlbignX25ld19wYXNzXy50eHQnLCd3Jykud3JpdGUoX25ld3Bhc3NfKQogICAgICAgICAgICBpZiBfcGl5ZV8gPT0gJ1llcyc6b3BlbignbXVuY3VsX29wc2kudHh0JywndycpLndyaXRlKCdZZXMnKQogICAgICAgICAgICBlbGlmIF9waXllXyA9PSAnTm8nOm9wZW4oJ211bmN1bF9vcHNpLnR4dCcsJ3cnKS53cml0ZSgnTm8nKQogICAgICAgICAgICBlbHNlOm9wZW4oJ211bmN1bF9vcHNpLnR4dCcsJ3cnKS53cml0ZSgnTm8nKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsaWYgX2dpbWFuYV8gaW4gWycyJywnMDInLCcwMDInLCdOJywnbiddOm9wZW4oJ2F1dG9fZ2FudGkudHh0JywndycpLndyaXRlKCdObycpO3Bhc3MKICAgICAgICBlbHNlOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgYnJlYWsKZGVmIGNoYW5nZV9wYXNzKHVzZXIsX3JlcV9zZXNfLF9yZXNwb25zZV8sbGlua18yKToKICAgIGdsb2JhbCBvayxjcAogICAgZmlsZXNfb2sgPSAiT0svJXMudHh0IiUodGFuZ2dhbCkKICAgIHRyeTpfbmV3X3Bhc3NfID0gb3BlbignX25ld19wYXNzXy50eHQnLCdyJykucmVhZCgpCiAgICBleGNlcHQ6X25ld19wYXNzXyA9ICdhemltdmF1LV8nCiAgICBfcGFzc3dvcmRfID0gJycuam9pbihfbmV3X3Bhc3NfKTtfcmVzdWx0X29rXyA9ICJcciAlc1slc1NVQ0NFU1NGVUxMJXNdICVzIOKAoiAlcyVzJXMgICAgICAgICAgIiUoSCxQLEgsdXNlcixfcGFzc3dvcmRfLHRhaHVuKHVzZXIpLFApO19idXR0b25fZGV2XyA9IFsic3VibWl0W1llc10iLCJuaCIsImZiX2R0c2ciLCJqYXpvZXN0IiwiY2hlY2twb2ludF9kYXRhIl0KICAgIGZvciBfYXppbXZhdV8gaW4gX3Jlc3BvbnNlXygiaW5wdXQiKToKICAgICAgICBpZiBfYXppbXZhdV8uZ2V0KCJuYW1lIikgaW4gX2J1dHRvbl9kZXZfOmRhdGFfY2hhbmdlXzEudXBkYXRlKHtfYXppbXZhdV8uZ2V0KCJuYW1lIik6X2F6aW12YXVfLmdldCgidmFsdWUiKX0pCiAgICBfZ2FudGlfcGFzc18gPSBfcmVxX3Nlc18ucG9zdChob3N0K2xpbmtfMi5nZXQoImFjdGlvbiIpLGRhdGE9ZGF0YV9jaGFuZ2VfMSkudGV4dDtfcmVzdWx0X3Bhc3NfID0gcGFyKF9nYW50aV9wYXNzXywiaHRtbC5wYXJzZXIiKTtfbGlua18zXyA9IF9yZXN1bHRfcGFzc18uZmluZCgiZm9ybSIseyJtZXRob2QiOiJwb3N0In0pO19idXR0b25fZGV2X18yXyA9IFsic3VibWl0W05leHRdIiwibmgiLCJmYl9kdHNnIiwiamF6b2VzdCJdCiAgICBpZiAiQ3JlYXRlIGEgbmV3IHBhc3N3b3JkIiBpbiByZS5maW5kYWxsKCJcPHRpdGxlPiguKj8pPFwvdGl0bGU+IixzdHIoX2dhbnRpX3Bhc3NfKSk6CiAgICAgICAgZm9yIF9jaWNpXyBpbiBfcmVzdWx0X3Bhc3NfKCJpbnB1dCIpOgogICAgICAgICAgICBpZiBfY2ljaV8uZ2V0KCJuYW1lIikgaW4gX2J1dHRvbl9kZXZfXzJfOmRhdGFfY2hhbmdlXzIudXBkYXRlKHtfY2ljaV8uZ2V0KCJuYW1lIik6X2NpY2lfLmdldCgidmFsdWUiKX0pCiAgICAgICAgZGF0YV9jaGFuZ2VfMi51cGRhdGUoeyJwYXNzd29yZF9uZXciOl9wYXNzd29yZF99KTtfc2VzX2ZpbmFsXyA9IF9yZXFfc2VzXy5wb3N0KGhvc3QrX2xpbmtfM18uZ2V0KCJhY3Rpb24iKSxkYXRhPWRhdGFfY2hhbmdlXzIpO19jb29raWVzXyA9ICgiOyIpLmpvaW4oWyAiJXM9JXMiICUgKGtleSwgdmFsdWUpIGZvciBrZXksIHZhbHVlIGluIF9yZXFfc2VzXy5jb29raWVzLmdldF9kaWN0KCkuaXRlbXMoKV0pO19fY29va2llc19fID0gY3Z0X2Nvb2tpZXMoX2Nvb2tpZXNfKTtjZWtfYXBrKF9yZXN1bHRfb2tfLF9fY29va2llc19fKTtvay5hcHBlbmQoIiVz4oCiJXMiJSh1c2VyLF9wYXNzd29yZF8pKTtfYXppbXZhdV9kYXB1bnRhXyhmaWxlc19vaywiYSsiKS53cml0ZSgiJXPigKIlc1xuIiUodXNlcixfcGFzc3dvcmRfKSk7Y3AgLT0gMTtwYXNzCiAgICBlbHNlOnBhc3MKCiMjIyBDZWsgQXBsaWthc2kKZGVmIGNla19hcGsoaF9vayxfYXppbXZhdV8pOgogICAgYXBrID0gW107c2VzXyA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgY2VrX3BpbGloX29wc2kgPSBvcGVuKCdtdW5jdWxfb3BzaS50eHQnLCdyJykucmVhZCgpCiAgICB1cmwgPSAiaHR0cHM6Ly9tYmFzaWMuZmFjZWJvb2suY29tL3NldHRpbmdzL2luc3RhbnRfZ2FtZXMvdGFiYmVkLz90YWI9YWN0aXZlIjtkYXRfZ2FtZSA9IHNlc18uZ2V0KHVybCxjb29raWVzPXsnY29va2llJzpfYXppbXZhdV99KTtkYXRhZ2FtZSA9IHBhcihkYXRfZ2FtZS5jb250ZW50LCdodG1sLnBhcnNlcicpO2Zvcm1fICAgID0gZGF0YWdhbWUuZmluZCgnZm9ybScsbWV0aG9kPSdwb3N0JykKICAgIGZvciBhc3UgaW4gZm9ybV8uZmluZF9hbGwoImgzIik6CiAgICAgICAgdHJ5OmNlbGVuZyA9IGFzdS5maW5kKCdzcGFuJykudGV4dDthcGsuYXBwZW5kKCdcbiAgIENvbm5lY3Q6ICcrY2VsZW5nKQogICAgICAgIGV4Y2VwdDpwYXNzCiAgICB1cmwyID0gImh0dHBzOi8vbWJhc2ljLmZhY2Vib29rLmNvbS9zZXR0aW5ncy9pbnN0YW50X2dhbWVzL3RhYmJlZC8/dGFiPWluYWN0aXZlIjtkYXRfZ2FtZSA9IHNlc18uZ2V0KHVybDIsY29va2llcz17J2Nvb2tpZSc6X2F6aW12YXVffSk7ZGF0YWdhbWUgPSBwYXIoZGF0X2dhbWUuY29udGVudCwnaHRtbC5wYXJzZXInKTtmb3JtXyAgICA9IGRhdGFnYW1lLmZpbmQoJ2Zvcm0nLG1ldGhvZD0ncG9zdCcpCiAgICBmb3IgYXN1IGluIGZvcm1fLmZpbmRfYWxsKCJoMyIpOgogICAgICAgIHRyeTpjZWxlbmcgPSBhc3UuZmluZCgnc3BhbicpLnRleHQ7YXBrLmFwcGVuZCgnXG4gICBDb25uZWN0OiAnK2NlbGVuZykKICAgICAgICBleGNlcHQ6cGFzcwogICAgaWYgY2VrX3BpbGloX29wc2kgPT0gJ1llcyc6cHJpbnQoaF9vaysnJy5qb2luKGFwaykpO3ByaW50KCcnKQogICAgZWxpZiBjZWtfcGlsaWhfb3BzaSA9PSAnTm8nOnByaW50KGhfb2srJycuam9pbihhcGspKQoKIyMjIENlayBUYWh1biBQZW1idWF0YW4KZGVmIHRhaHVuKGZ4KToKICAgIGlmIChyZS5maW5kYWxsKCJbYS16QS1aXSIsc3RyKGZ4KSkpOnRhaHVuej0nJwogICAgZWxzZToKICAgICAgICBpZiBsZW4oZngpPT0xNToKICAgICAgICAgICAgaWYgZnhbOjEwXSBpbiBbJzEwMDAwMDAwMDAnXSAgICAgICA6dGFodW56ID0gJyDigKIgMjAwOScKICAgICAgICAgICAgZWxpZiBmeFs6OV0gaW4gWycxMDAwMDAwMDAnXSAgICAgICA6dGFodW56ID0gJyDigKIgMjAwOScKICAgICAgICAgICAgZWxpZiBmeFs6OF0gaW4gWycxMDAwMDAwMCddICAgICAgICA6dGFodW56ID0gJyDigKIgMjAwOScKICAgICAgICAgICAgZWxpZiBmeFs6N10gaW4gWycxMDAwMDAwJywnMTAwMDAwMScsJzEwMDAwMDInLCcxMDAwMDAzJywnMTAwMDAwNCcsJzEwMDAwMDUnXTp0YWh1bnogPSAnIOKAoiAyMDA5JwogICAgICAgICAgICBlbGlmIGZ4Wzo3XSBpbiBbJzEwMDAwMDYnLCcxMDAwMDA3JywnMTAwMDAwOCcsJzEwMDAwMDknXTp0YWh1bnogPSAnIOKAoiAyMDEwJwogICAgICAgICAgICBlbGlmIGZ4Wzo2XSBpbiBbJzEwMDAwMSddICAgICAgICAgIDp0YWh1bnogPSAnIOKAoiAyMDEwLzIwMTEnCiAgICAgICAgICAgIGVsaWYgZnhbOjZdIGluIFsnMTAwMDAyJywnMTAwMDAzJ10gOnRhaHVueiA9ICcg4oCiIDIwMTEvMjAxMicKICAgICAgICAgICAgZWxpZiBmeFs6Nl0gaW4gWycxMDAwMDQnXSAgICAgICAgICA6dGFodW56ID0gJyDigKIgMjAxMi8yMDEzJwogICAgICAgICAgICBlbGlmIGZ4Wzo2XSBpbiBbJzEwMDAwNScsJzEwMDAwNiddIDp0YWh1bnogPSAnIOKAoiAyMDEzLzIwMTQnCiAgICAgICAgICAgIGVsaWYgZnhbOjZdIGluIFsnMTAwMDA3JywnMTAwMDA4J10gOnRhaHVueiA9ICcg4oCiIDIwMTQvMjAxNScKICAgICAgICAgICAgZWxpZiBmeFs6Nl0gaW4gWycxMDAwMDknXSAgICAgICAgICA6dGFodW56ID0gJyDigKIgMjAxNScKICAgICAgICAgICAgZWxpZiBmeFs6NV0gaW4gWycxMDAwMSddICAgICAgICAgICA6dGFodW56ID0gJyDigKIgMjAxNS8yMDE2JwogICAgICAgICAgICBlbGlmIGZ4Wzo1XSBpbiBbJzEwMDAyJ10gICAgICAgICAgIDp0YWh1bnogPSAnIOKAoiAyMDE2LzIwMTcnCiAgICAgICAgICAgIGVsaWYgZnhbOjVdIGluIFsnMTAwMDMnXSAgICAgICAgICAgOnRhaHVueiA9ICcg4oCiIDIwMTgvMjAxOScKICAgICAgICAgICAgZWxpZiBmeFs6NV0gaW4gWycxMDAwNCddICAgICAgICAgICA6dGFodW56ID0gJyDigKIgMjAxOS8yMDIwJwogICAgICAgICAgICBlbGlmIGZ4Wzo1XSBpbiBbJzEwMDA1J10gICAgICAgICAgIDp0YWh1bnogPSAnIOKAoiAyMDIwJwogICAgICAgICAgICBlbGlmIGZ4Wzo1XSBpbiBbJzEwMDA2JywnMTAwMDcnLCcxMDAwOCddOnRhaHVueiA9ICcg4oCiIDIwMjEnCiAgICAgICAgICAgIGVsc2U6dGFodW56PScnCiAgICAgICAgZWxpZiBsZW4oZngpIGluIFs5LDEwXTp0YWh1bnogPSAnIOKAoiAyMDA4LzIwMDknCiAgICAgICAgZWxpZiBsZW4oZngpPT04OnRhaHVueiA9ICcg4oCiIDIwMDcvMjAwOCcKICAgICAgICBlbGlmIGxlbihmeCk9PTc6dGFodW56ID0gJyDigKIgMjAwNi8yMDA3JwogICAgICAgIGVsc2U6dGFodW56PScnCiAgICByZXR1cm4gdGFodW56CgojIyMgQ29udmVydCBDb29raWVzCmRlZiBjdnRfY29va2llcyhyYXdfY29va2llcyk6CiAgICBvID0ge30KICAgICMgX3Jhd19jb29raWVzX3dhcnZlc3RfID0gY191c2VyLGRhdHIsZG5vbmNlLGZyLHNiLHhzCiAgICAjIF9yYXdfY29va2llc19hYXBfICAgICA9IGNfdXNlcixmcixzYix4cyxkYXRyCiAgICAjIF9jb29rZWRfY29va2llc18gICAgICA9IHNiLGRhdHIsY191c2VyLHhzLGZyCiAgICBraWtvID0gcmF3X2Nvb2tpZXMucmVwbGFjZSgnICcsJycpLnNwbGl0KCc7JykKICAgIGZvciB4IGluIGtpa286CiAgICAgICAgeSA9IHguc3BsaXQoJz0nKVswXQogICAgICAgIHogPSB4LnNwbGl0KCc9JylbMV0KICAgICAgICBvLnVwZGF0ZSh7eTp6fSkKICAgIGNvb2tlZF9jb29raWVzID0gKCdzYj0lczsgZGF0cj0lczsgY191c2VyPSVzOyB4cz0lczsgZnI9JXMnJShvWydzYiddLG9bJ2RhdHInXSxvWydjX3VzZXInXSxvWyd4cyddLG9bJ2ZyJ10pKQogICAgI19jb29raWVzXyA9IHsnY29va2llJzpjb29rZWRfY29va2llc30KICAgICNwcmludChjb29rZWRfY29va2llcykKICAgIHJldHVybiBjb29rZWRfY29va2llcwoKIyMjIE1ldG9kZSBDcmFjawpkZWYgcGlsaWhfbWV0aG9kZSgpOgogICAgdHJ5Om9zLnJlbW92ZSgnbWV0aG9kLnR4dCcpCiAgICBleGNlcHQ6cGFzcwogICAgd2hpbGUgVHJ1ZToKICAgICAgICBzdGFydF9tZXRob2QoKQogICAgICAgIHB1dCA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNDSE9PU0UgOiAnJShILFAsSCxLKSkKICAgICAgICBpZiBwdXQgaW4gWycnLCcgJywnICAnXTpjb2sgPSBvcGVuKCdtZXRob2QudHh0JywndycpO2Nvay53cml0ZSgnbWV0aG9kZV9tYmFzaWNfdjEnKTtjb2suY2xvc2UoKQogICAgICAgIGVsaWYgcHV0IGluIFsnMScsJzAxJywnMDAxJywnYSddOmNvayA9IG9wZW4oJ21ldGhvZC50eHQnLCd3Jyk7Y29rLndyaXRlKCdtZXRob2RlX2FwaV92MScpO2Nvay5jbG9zZSgpCiAgICAgICAgZWxpZiBwdXQgaW4gWycyJywnMDInLCcwMDInLCdiJ106Y29rID0gb3BlbignbWV0aG9kLnR4dCcsJ3cnKTtjb2sud3JpdGUoJ21ldGhvZGVfYXBpX3YyJyk7Y29rLmNsb3NlKCkKICAgICAgICBlbGlmIHB1dCBpbiBbJzMnLCcwMycsJzAwMycsJ2MnXTpjb2sgPSBvcGVuKCdtZXRob2QudHh0JywndycpO2Nvay53cml0ZSgnbWV0aG9kZV9tYmFzaWNfdjEnKTtjb2suY2xvc2UoKQogICAgICAgIGVsaWYgcHV0IGluIFsnNCcsJzA0JywnMDA0JywnZCddOmNvayA9IG9wZW4oJ21ldGhvZC50eHQnLCd3Jyk7Y29rLndyaXRlKCdtZXRob2RlX21iYXNpY192MicpO2Nvay5jbG9zZSgpCiAgICAgICAgZWxpZiBwdXQgaW4gWyc1JywnMDUnLCcwMDUnLCdlJ106Y29rID0gb3BlbignbWV0aG9kLnR4dCcsJ3cnKTtjb2sud3JpdGUoJ21ldGhvZGVfbW9iaWxlX3YxJyk7Y29rLmNsb3NlKCkKICAgICAgICBlbGlmIHB1dCBpbiBbJzYnLCcwNicsJzAwNicsJ2YnXTpjb2sgPSBvcGVuKCdtZXRob2QudHh0JywndycpO2Nvay53cml0ZSgnbWV0aG9kZV9tb2JpbGVfdjInKTtjb2suY2xvc2UoKQogICAgICAgIGVsc2U6Y29rID0gb3BlbignbWV0aG9kLnR4dCcsJ3cnKTtjb2sud3JpdGUoJ21ldGhvZGVfbWJhc2ljX3YxJyk7Y29rLmNsb3NlKCkKICAgICAgICBicmVhawoKIyMjIENyYWNrCmNsYXNzIGNyYWNrOgogICAgZGVmIF9faW5pdF9fKHNlbGYsZmlsZXMpOgogICAgICAgIGdsb2JhbCBvayxjcAogICAgICAgIHNlbGYuYWRhID0gb2s7c2VsZi5jcCA9IGNwO3NlbGYua28gPSAwCiAgICAgICAgc2VsZi5faGF5b19tYXVfcmVjb2RlXyA9ICIxMjM0NSIKICAgICAgICBpZiBsZW4oc2VsZi5faGF5b19tYXVfcmVjb2RlXykgPT0gNTpwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJ5Om9zLnJlbW92ZShmaWxlcykKICAgICAgICAgICAgZXhjZXB0OnByaW50KCJGVUNLIikKICAgICAgICB0cnk6b3MucmVtb3ZlKCdvcHRpb25fLnR4dCcpCiAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICBjaWsgPSBvcGVuKCdvcHRpb25fLnR4dCcsJ3cnKTtjaWsud3JpdGUoJ251bGwnKTtjaWsuY2xvc2UoKQogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHBpbGloX21ldGhvZGUoKTtwcmludCgnJXMgJyUoTykpO3ByaW50KCclcyBbJXPigKIlc10gJXNDUkFDSyBXSVRIIERFRkFVTFQgLyBNQU5VQUwgUEFTU1dPUkQgJXNbJXNkJXMvJXNtJXNdJyUoSCxQLEgsQixQLEgsUCxLLFApKQogICAgICAgICAgICBfcGlsaWhfc2FuZGlfID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0NIT09TRSA6ICclKEgsUCxILEspKQogICAgICAgICAgICBpZiBfcGlsaWhfc2FuZGlfPT0iIjpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgICAgICBlbGlmIF9waWxpaF9zYW5kaV8gaW4gWydtJywnTScsJzInLCcwMicsJzAwMiddOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpzZWxmLmFwayA9IGZpbGVzO3NlbGYuZnMgPSBfYXppbXZhdV9kYXB1bnRhXyhzZWxmLmFwaykucmVhZCgpLnNwbGl0bGluZXMoKTticmVhawogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6cHJpbnQgKCIgICAlcyIlKGUpKTtjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHNlbGYuZmwgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNlbGYuZnM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpzZWxmLmZsLmFwcGVuZCh7ImlkIjppLnNwbGl0KCLigKIiKVswXX0pCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCgiICAgJXMiJWUpKTtjb250aW51ZQogICAgICAgICAgICAgICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc0VYQU1QTEUgOiAlc05JR0VSSUFOLDEyMzQ1NiwxMjM0NTY2NTQzMjEnJShILFAsSCxLLEgpKTtzZWxmLnB3bGlzdCgpO2JyZWFrCiAgICAgICAgICAgIGVsaWYgX3BpbGloX3NhbmRpXyBpbiBbJ2QnLCdEJywnMScsJzAxJywnMDAxJ106CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OnNlbGYuYXBrID0gZmlsZXM7c2VsZi5mcyA9IF9hemltdmF1X2RhcHVudGFfKHNlbGYuYXBrKS5yZWFkKCkuc3BsaXRsaW5lcygpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpwcmludCAoIiAgICVzIiUoZSkpO2NvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mbCA9IFtdO3N0YXJ0X21ldGhvZGV6eigpO2tvcGkgPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzQ0hPT1NFIDogJyUoSCxQLEgsSykpCiAgICAgICAgICAgICAgICAgICAgaWYga29waSBpbiBbJyddOgogICAgICAgICAgICAgICAgICAgICAgICBqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUoKQogICAgICAgICAgICAgICAgICAgIGVsaWYga29waSBpbiBbJzEnLCcwMSddOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OnNlbGYuZmwuYXBwZW5kKHsiaWQiOmkuc3BsaXQoIuKAoiIpWzBdLCJwdyI6Z2VuZXJhdGUxKGkuc3BsaXQoIuKAoiIpWzFdKX0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6Y29udGludWUKICAgICAgICAgICAgICAgICAgICBlbGlmIGtvcGkgaW4gWycyJywnMDInXToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gc2VsZi5mczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpzZWxmLmZsLmFwcGVuZCh7ImlkIjppLnNwbGl0KCLigKIiKVswXSwicHciOmdlbmVyYXRlMihpLnNwbGl0KCLigKIiKVsxXSl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxpZiBrb3BpIGluIFsnMycsJzAzJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNlbGYuZnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6c2VsZi5mbC5hcHBlbmQoeyJpZCI6aS5zcGxpdCgi4oCiIilbMF0sInB3IjpnZW5lcmF0ZTMoaS5zcGxpdCgi4oCiIilbMV0pfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsaWYga29waSBpbiBbJzQnLCcwNCddOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6b3MucmVtb3ZlKCdwYXNzLnR4dCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpvcy5yZW1vdmUoJ2RpZ2l0cGFzcy50eHQnKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6cGFzcwogICAgICAgICAgICAgICAgICAgICAgICB0YW1iYWhfcGFzcygpO3RhbWJhaF9wYXNzX2FuZ2thKCkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gc2VsZi5mczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpzZWxmLmZsLmFwcGVuZCh7ImlkIjppLnNwbGl0KCLigKIiKVswXSwicHciOmdlbmVyYXRlNChpLnNwbGl0KCLigKIiKVsxXSl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OmNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgICAgICAgICAgICAgIHRyeTpvcy5yZW1vdmUoJ2NwX29wdGlvbi50eHQnKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDpwYXNzCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoJyVzICclKE8pKTtwdWYgPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzQlJJTkcgVVAgQ1AgT1BUSU9OUz8gW1kvbl0gOiAnJShILFAsSCxLKSkKICAgICAgICAgICAgICAgICAgICBpZiBwdWYgaW4gWycnXTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcHVmIGluIFsnMScsJzAxJywnMDAxJywneScsJ1knXTphdXRvX2dhbnRpX3Bhc3MoJ1llcycpO2NvayA9IG9wZW4oJ2NwX29wdGlvbi50eHQnLCd3Jyk7Y29rLndyaXRlKCdvcHNpX2NwJyk7Y29rLmNsb3NlKCk7c3RhcnRlZCgpO1RocmVhZFBvb2woMzUpLm1hcChzZWxmLnN0YXJ0X2NyYWNrLHNlbGYuZmwpO29zLnJlbW92ZShzZWxmLmFwayk7X2NpY2lfY2ljaV8oKTticmVhawogICAgICAgICAgICAgICAgICAgIGVsaWYgcHVmIGluIFsnMicsJzAyJywnMDAyJywnbicsJ04nXTphdXRvX2dhbnRpX3Bhc3MoJ05vJyk7Y29rID0gb3BlbignY3Bfb3B0aW9uLnR4dCcsJ3cnKTtjb2sud3JpdGUoJ251bGwnKTtjb2suY2xvc2UoKTtzdGFydGVkKCk7VGhyZWFkUG9vbCgzNSkubWFwKHNlbGYuc3RhcnRfY3JhY2ssc2VsZi5mbCk7b3MucmVtb3ZlKHNlbGYuYXBrKTtfY2ljaV9jaWNpXygpO2JyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOnByaW50KCgiICAgJXMiJWUpKQogICAgZGVmIHB3bGlzdChzZWxmKToKICAgICAgICBzZWxmLnB3ID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIFBBU1NXT1JEIDogJyUoSyxQLEssSCkpLnNwbGl0KCIsIikKICAgICAgICBpZiBsZW4oc2VsZi5wdykgPT0wOnNlbGYucHdsaXN0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmZsOmkudXBkYXRlKHsicHciOnNlbGYucHd9KQogICAgICAgICAgICB0cnk6b3MucmVtb3ZlKCdjcF9vcHRpb24udHh0JykKICAgICAgICAgICAgZXhjZXB0OnBhc3MKICAgICAgICAgICAgcHJpbnQoJyVzICclKE8pKTtwdWYgPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzUE9QIFVQIENQIE9QVElPTlM/IFtZL25dIDogJyUoSCxQLEgsSykpCiAgICAgICAgICAgIGlmIHB1ZiBpbiBbJyddOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICAgICAgICAgIGVsaWYgcHVmIGluIFsnMScsJzAxJywnMDAxJywneScsJ1knXTphdXRvX2dhbnRpX3Bhc3MoJ1llcycpO2NvayA9IG9wZW4oJ2NwX29wdGlvbi50eHQnLCd3Jyk7Y29rLndyaXRlKCdvcHNpX2NwJyk7Y29rLmNsb3NlKCk7c3RhcnRlZCgpO1RocmVhZFBvb2woMzApLm1hcChzZWxmLnN0YXJ0X2NyYWNrLHNlbGYuZmwpO29zLnJlbW92ZShzZWxmLmFwayk7X2NpY2lfY2ljaV8oKQogICAgICAgICAgICBlbGlmIHB1ZiBpbiBbJzInLCcwMicsJzAwMicsJ24nLCdOJ106YXV0b19nYW50aV9wYXNzKCdObycpO2NvayA9IG9wZW4oJ2NwX29wdGlvbi50eHQnLCd3Jyk7Y29rLndyaXRlKCdudWxsJyk7Y29rLmNsb3NlKCk7c3RhcnRlZCgpO1RocmVhZFBvb2woMzApLm1hcChzZWxmLnN0YXJ0X2NyYWNrLHNlbGYuZmwpO29zLnJlbW92ZShzZWxmLmFwayk7X2NpY2lfY2ljaV8oKQogICAgICAgICAgICBlbHNlOmphbGFuKCclcyBbJXMhJXNdICVzSU5DT1JSRUNUIENPTlRFTlQnJShNLFAsTSxQKSk7bWVudSgpCiAgICBkZWYgc3RhcnRfY3JhY2soc2VsZixmbCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBtZXRvZGUgPSBvcGVuKCdtZXRob2QudHh0JywncicpLnJlYWQoKQogICAgICAgICAgICBmb3IgaSBpbiBmbC5nZXQoInB3Iik6CiAgICAgICAgICAgICAgICBpZiAnbWV0aG9kZV9hcGlfdjEnIGluIG1ldG9kZTpsb2cgPSBsb2dfYXBpXzEoZmwuZ2V0KCJpZCIpLGkpCiAgICAgICAgICAgICAgICBlbGlmICdtZXRob2RlX2FwaV92MicgaW4gbWV0b2RlOmxvZyA9IGxvZ19hcGlfMihmbC5nZXQoImlkIiksaSkKICAgICAgICAgICAgICAgIGVsaWYgJ21ldGhvZGVfbWJhc2ljX3YxJyBpbiBtZXRvZGU6bG9nID0gbG9nX21iYXNpY18xKGZsLmdldCgiaWQiKSxpKQogICAgICAgICAgICAgICAgZWxpZiAnbWV0aG9kZV9tYmFzaWNfdjInIGluIG1ldG9kZTpsb2cgPSBsb2dfbWJhc2ljXzIoZmwuZ2V0KCJpZCIpLGkpCiAgICAgICAgICAgICAgICBlbGlmICdtZXRob2RlX21vYmlsZV92MScgaW4gbWV0b2RlOmxvZyA9IGxvZ19tb2JpbGVfMShmbC5nZXQoImlkIiksaSkKICAgICAgICAgICAgICAgIGVsaWYgJ21ldGhvZGVfbW9iaWxlX3YyJyBpbiBtZXRvZGU6bG9nID0gbG9nX21vYmlsZV8yKGZsLmdldCgiaWQiKSxpKQogICAgICAgICAgICAgICAgZWxzZTpsb2cgPSBsb2dfbWJhc2ljXzEoZmwuZ2V0KCJpZCIpLGkpCiAgICAgICAgICAgICAgICBpZiBsb2cuZ2V0KCJzdGF0dXMiKT09ImNwIjoKICAgICAgICAgICAgICAgICAgICBmaWxlc19jcCA9ICJDUC8lcy50eHQiJSh0YW5nZ2FsKQogICAgICAgICAgICAgICAgICAgIGlmIGZsLmdldCgiaWQiKSBpbiBmaWxlc19jcDpwYXNzCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OmtlID0gX3JlcV9nZXRfKCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8iICsgZmwuZ2V0KCJpZCIpICsgIj9maWVsZHM9bmFtZSxpZCxiaXJ0aGRheSxmaXJzdF9uYW1lLG1pZGRsZV9uYW1lLGxhc3RfbmFtZSxuYW1lX2Zvcm1hdCxwaWN0dXJlLHNob3J0X25hbWUmYWNjZXNzX3Rva2VuPSIgKyBfYXppbXZhdV9kYXB1bnRhXygidG9rZW4udHh0IiwiciIpLnJlYWQoKSk7dHQgPSBfanNfbG9fKGtlLnRleHQpO3R0bCA9IHR0WyJiaXJ0aGRheSJdO20sZCx5ID0gdHRsLnNwbGl0KCIvIik7bSA9IGJ1bGFuX3R0bFttXTt0dGxsID0gKCcg4oCiICVzICVzICVzJyUoZCxtLHkpKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6dHRsbCA9ICgnJyUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaF9jcCA9ICJcciAlc1slc0NQJXNdICVzIOKAoiAlcyVzJXMgICAgICAgICAgIiUoSyxQLEssZmwuZ2V0KCJpZCIpLGksdHRsbCx0YWh1bihmbC5nZXQoImlkIikpKTtjZWtfb3BzaShmbC5nZXQoImlkIiksaSxoX2NwKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNwLmFwcGVuZCgiJXPigKIlcyIlKGZsLmdldCgiaWQiKSxpKSk7X2F6aW12YXVfZGFwdW50YV8oZmlsZXNfY3AsImErIikud3JpdGUoIiVz4oCiJXMlc1xuIiUoZmwuZ2V0KCJpZCIpLGksdHRsbC5yZXBsYWNlKCcgJywnJykpKTticmVhawogICAgICAgICAgICAgICAgZWxpZiBsb2cuZ2V0KCJzdGF0dXMiKT09Im9rIjoKICAgICAgICAgICAgICAgICAgICBmaWxlc19vayA9ICJPSy8lcy50eHQiJSh0YW5nZ2FsKQogICAgICAgICAgICAgICAgICAgIGlmIGZsLmdldCgiaWQiKSBpbiBmaWxlc19vazpwYXNzCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ21ldGhvZGVfbWJhc2ljX3YxJyBpbiBtZXRvZGUgb3IgJ21ldGhvZGVfbWJhc2ljX3YyJyBpbiBtZXRvZGUgb3IgJ21ldGhvZGVfbW9iaWxlX3YxJyBpbiBtZXRvZGUgb3IgJ21ldGhvZGVfbW9iaWxlX3YyJyBpbiBtZXRvZGU6aF9vayA9ICJcciAlc1slc1NVQ0NFU1NGVUxMJXNdICVzIOKAoiAlcyVzJXMgICAgICAgICAgIiUoSCxQLEgsZmwuZ2V0KCJpZCIpLGksdGFodW4oZmwuZ2V0KCJpZCIpKSxQKTtjZWtfYXBrKGhfb2ssY3Z0X2Nvb2tpZXMobG9nLmdldCgiY29va2llcyIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZTpwcmludCgiXHIgJXNbJXNTVUNDRVNTRlVMTCVzXSAlcyDigKIgJXMlcyAgICAgICAgICAiJShILFAsSCxmbC5nZXQoImlkIiksaSx0YWh1bihmbC5nZXQoImlkIikpKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZGEuYXBwZW5kKCIlc+KAoiVzIiUoZmwuZ2V0KCJpZCIpLGkpKTtfYXppbXZhdV9kYXB1bnRhXyhmaWxlc19vaywiYSsiKS53cml0ZSgiJXPigKIlc1xuIiUoZmwuZ2V0KCJpZCIpLGkpKTticmVhawogICAgICAgICAgICAgICAgZWxzZTpjb250aW51ZQogICAgICAgICAgICBzZWxmLmtvKz0xCiAgICAgICAgICAgIHByaW50KCJcciAlc1slc0NyYWNraW5nJXNdWyVzJXMvJXMlc11bJXNHT09EOiVzJXNdWyVzQ1A6JXMlc10lcyIlKEssSCxLLFAsc2VsZi5rbyxsZW4oc2VsZi5mbCksSyxQLGxlbihzZWxmLmFkYSksSyxQLGxlbihzZWxmLmNwKSxLLFApLCBlbmQ9JycpO3N5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIGV4Y2VwdDpzZWxmLnN0YXJ0X2NyYWNrKGZsKQoKCiMjIyBNZW5kYXBhdCBKdW1sYWggVGVtYW4gVGFyZ2V0CmRlZiB0ZW1hbl90YXJnZXQoKToKICAgIGl0ID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc1RBUkdFVCBJRCA6JXMgJyUoSCxQLEgsSyxIKSkKICAgIHRyeTp0b2tlbiA9IF9hemltdmF1X2RhcHVudGFfKCd0b2tlbi50eHQnLCdyJykucmVhZCgpO21tID0gX3JlcV9nZXRfKCdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8lcz9hY2Nlc3NfdG9rZW49JXMnJShpdCx0b2tlbikpO25uID0gX2pzX2xvXyhtbS50ZXh0KTtwcmludCAoJyVzIFslc+KAoiVzXSAlc05BTUUgOiAlcyclKEgsUCxILEssbm5bJ25hbWUnXSkpCiAgICBleGNlcHQgKEtleUVycm9yLElPRXJyb3IpOmphbGFuKCclcyBbJXMhJXNdICVzVE9LRU4vQ09PS0lFUyBJTlZBTElEJyUoTSxQLE0sUCkpO21lbnVfbG9nKCkKICAgIHR0PVtdO3RlPVtdO2xpbSA9IF9jaWNpX2F6aW12YXVfKCclcyBbJXPigKIlc10gJXNEVU1QIExJTUlUIDogJXMnJShILFAsSCxLLEgpKTtwcmludCgnJXMgJXMnJShPLFApKTthZGEgPSBfcmVxX2dldF8oJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLyVzL2ZyaWVuZHM/bGltaXQ9JXMmYWNjZXNzX3Rva2VuPSVzJyUoaXQsbGltLHRva2VuKSk7aWRpID0gX2pzX2xvXyhhZGEudGV4dCkKICAgIGZvciB4IGluIGlkaVsnZGF0YSddOnR0LmFwcGVuZCh4WydpZCddKQogICAgZm9yIGlkIGluIHR0OgogICAgICAgIHRyeToKICAgICAgICAgICAgYWRhMiA9IF9yZXFfZ2V0XygnaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vJXMvZnJpZW5kcz9hY2Nlc3NfdG9rZW49JXMnJShpZCx0b2tlbikpO2lkaTIgPSBfanNfbG9fKGFkYTIudGV4dCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGIgaW4gaWRpMlsnZGF0YSddOnRlLmFwcGVuZChiWydpZCddKQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6cHJpbnQoJyBbIV0gUFJJVkFURScpCiAgICAgICAgICAgIHByaW50KCcgW+KAol0nLGlkLCfigKInLGxlbih0ZSkpO3RlLmNsZWFyKCkKICAgICAgICBleGNlcHQgS2V5RXJyb3I6cHJpbnQoJyVzIFshXSBTUEFNIEFDQ09VTlQuLi4hJyUoTSkpCiAgICBwcmludCgnICcpO19jaWNpX2F6aW12YXVfKCcgWyBCQUNLIF0nKTttZW51KCkKCiMjIyBNZW51IE1lbmdlY2VrIHJlc3VsdCBDcmFjawpkZWYgcmVzdWx0KCk6CiAgICBjbGVhcigpCiAgICBiYW5uZXIoKQogICAgamFsYW4oJyVzIFsgJXNDUkFDSyBSRVNVTFRTICVzXSclKEgsUCxIKSk7cHJpbnQoJyVzICclKE8pKTtwcmludCgnJXMgWyVzMSVzXSAlc0NIRUNLIFJFU1VMVFMgT0snJShILFAsSCxLKSk7cHJpbnQoJyVzIFslczIlc10gJXNDSEVDSyBSRVNVTFRTIENQJyUoSCxQLEgsUCkpO2NoID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0NIT09TRSA6ICclKEgsUCxILEspKQogICAgaWYgY2ggaW4gWycnXTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO21lbnUoKQogICAgZWxpZiBjaCBpbiBbJzEnLCcwMScsJzAwMScsJ2EnXToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9rbCA9IG9zLmxpc3RkaXIoIk9LIik7cHJpbnQoJyVzICclKE8pKTtwcmludCgnJXMgWyVzIENSQUNLIFJFU1VMVFMgU1RPUkVEIElOIE9LIEZJTEUgJXNdJyUoSCxQLEgpKTtwcmludCgnJXMgJyUoTykpCiAgICAgICAgICAgIGZvciBmaWxlIGluIG9rbDpwcmludCgnJXMgWyVz4oCiJXNdICVzJXMnJShILFAsSCxLLGZpbGUpKQogICAgICAgICAgICBwcmludCgnJXMgJyUoTykpO2ZpbGVzID0gX2NpY2lfYXppbXZhdV8oJyVzIFslc+KAoiVzXSAlc0VOVEVSIEZJTEUgTkFNRSA6ICclKEgsUCxILEspKTtwcmludCgnJykKICAgICAgICAgICAgaWYgZmlsZXMgPT0gIiI6amFsYW4oJyVzIFslcyElc10gJXNJTkNPUlJFQ1QgQ09OVEVOVCclKE0sUCxNLFApKTtyZXN1bHQoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwcHAgPSBfYXppbXZhdV9kYXB1bnRhXygiT0svJXMiJShmaWxlcykpLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgICAgICAgICAgICAgIGZvciB4IGluIHBwcDp5eXkgPSB4LnJlcGxhY2UoJ+KAoicsJyDigKIgJyk7cHJpbnQoJyAlc1slc1NVQ0NFU1NGVUwlc10gJXMnJShILFAsSCx5eXkpKQogICAgICAgICAgICAgICAgZGVsMSA9ICgiJXMiJShmaWxlcykpLnJlcGxhY2UoIi0iLCAiICIpLnJlcGxhY2UoIi50eHQiLCAiIik7cHJpbnQoJ1xuJXMgWyVz4oCiJXNdICVzVE9UQUwgQ1JBQ0sgUkVTVUxUIERBVEUgJXMgSVMgJXMgQUNDT1VOVCclKEgsUCxILEssZGVsMSxsZW4ocHBwKSkpCiAgICAgICAgICAgIGV4Y2VwdDpwcmludCgnJXMgWyVzIE5PIFJFU1VMVFMgRk9VTkQgJXNdJyUoTSxQLE0pKQogICAgICAgIGV4Y2VwdCAoS2V5RXJyb3IsSU9FcnJvcik6cHJpbnQoJyVzIFslcyBOTyBSRVNVTFRTIEZPVU5EICVzXSclKE0sUCxNKSkKICAgIGVsaWYgY2ggaW4gWycyJywnMDInLCcwMDInLCdiJ106CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjcGwgPSBvcy5saXN0ZGlyKCJDUCIpO3ByaW50KCclcyAnJShPKSk7cHJpbnQoJyVzIFslcyBDUkFDSyBSRVNVTFRTIFNUT1JFRCBJTiBDUCBGSUxFUyAlc10nJShILFAsSCkpO3ByaW50KCclcyAnJShPKSkKICAgICAgICAgICAgZm9yIGZpbGUgaW4gY3BsOnByaW50KCclcyBbJXPigKIlc10gJXMlcyclKEgsUCxILEssZmlsZSkpCiAgICAgICAgICAgIHByaW50KCclcyAnJShPKSk7ZmlsZXMgPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzRU5URVIgRklMRSBOQU1FIDogJyUoSCxQLEgsSykpO3ByaW50KCcnKQogICAgICAgICAgICBpZiBmaWxlcyA9PSAiIjpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sUCkpO3Jlc3VsdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBwcCA9IF9hemltdmF1X2RhcHVudGFfKCJDUC8lcyIlKGZpbGVzKSkucmVhZCgpLnNwbGl0bGluZXMoKQogICAgICAgICAgICAgICAgZm9yIHggaW4gcHBwOnl5eSA9IHgucmVwbGFjZSgn4oCiJywnIOKAoiAnKTtwcmludCgnICVzWyVzQ1Alc10gJXMnJShLLFAsSyx5eXkpKQogICAgICAgICAgICAgICAgZGVsMSA9ICgiJXMiJShmaWxlcykpLnJlcGxhY2UoIi0iLCAiICIpLnJlcGxhY2UoIi50eHQiLCAiIik7cHJpbnQoJ1xuJXMgWyVz4oCiJXNdICVzVE9UQUwgQ1JBQ0sgUkVTVUxUIERBVEUgJXMgSVMgJXMgQUNDT1VOVCclKEgsUCxILFAsZGVsMSxsZW4ocHBwKSkpCiAgICAgICAgICAgIGV4Y2VwdDpwcmludCgnJXMgWyVzIE5PIFJFU1VMVFMgRk9VTkQgJXNdJyUoUCxNLE0pKQogICAgICAgIGV4Y2VwdDpwcmludCgnJXMgWyVzIE5PIFJFU1VMVFMgRk9VTkQgJXNdJyUoUCxNLFApKQogICAgZWxzZTpqYWxhbignJXMgWyVzISVzXSAlc0lOQ09SUkVDVCBDT05URU5UJyUoTSxQLE0sTSkpO21lbnUoKQogICAgcHJpbnQoJyVzICclKE8pKTtfY2ljaV9hemltdmF1XygnJXMgWyAlc0JBQ0sgJXNdJXMnJShILFAsSCxLKSk7bWVudSgpCgpkZWYgY2VrX3Jlc3VsdCgpOgogICAgdHJ5Om9zLnJlbW92ZSgnb3B0aW9uXy50eHQnKQogICAgZXhjZXB0OnBhc3MKICAgIGNpayA9IG9wZW4oJ29wdGlvbl8udHh0JywndycpO2Npay53cml0ZSgncmVzdWx0Jyk7Y2lrLmNsb3NlKCkKICAgIHByaW50KCclcyBbICVzQ0hFQ0sgQ1JBQ0sgUkVTVUxUIEFDQ09VTlQgT1BUSU9OUyAlc10nJShILEssSCkpO3ByaW50KCclcyAnJShPKSk7cHJpbnQoJyVzIFslc+KAoiVzXSAlc0VYQU1QTEUgRklMRSA6ICVzLnR4dCclKEgsUCxILEssdGFuZ2dhbCkpO2ZpbGVzX18gPSBfY2ljaV9hemltdmF1XygnJXMgWyVz4oCiJXNdICVzRmlsZSA6ICclKEgsUCxILEspKTtmaWxlcyA9ICJDUC8iK2ZpbGVzX18KICAgIHRyeTpidWthX2JhanUgPSBfYXppbXZhdV9kYXB1bnRhXyhmaWxlcywiciIpLnJlYWQoKS5zcGxpdGxpbmVzKCkKICAgIGV4Y2VwdCBGaWxlTm90Rm91bmRFcnJvcjpwcmludCgiJXMgWyVzISVzXSAlc0ZJTEUgTk9UIEVYSVNUSU5HIiUoTSxQLE0sUCkpO3RpbWUuc2xlZXAoMik7IG1lbnUoKQogICAgYXV0b19nYW50aV9wYXNzKCdZZXMnKTtwcmludCgiJXMgWyVz4oCiJXNdICVzVE9UQUwgQUNDT1VOVFMgOiAlcyVzIiUoSCxQLEgsSyxILHN0cihsZW4oYnVrYV9iYWp1KSkpKTtwcmludCgiIikKICAgIGZvciBtZW1layBpbiBidWthX2JhanU6CiAgICAgICAgaWYgJ8Oi4oKswqInIGluIG1lbWVrOm1lbWVrID0gbWVtZWsucmVwbGFjZSgnw6LigqzCoicsJ+KAoicpCiAgICAgICAga29udG9sID0gbWVtZWsucmVwbGFjZSgi4oCiIiwiIOKAoiAiKTt0aXRpZCAgPSBtZW1lay5zcGxpdCgi4oCiIikKICAgICAgICBfZm9ybWF0XyA9ICJcciAlc1slc0NQJXNdICVzICAgICAgICAgICIlKEssUCxLLGtvbnRvbCkKICAgICAgICB0cnk6Y2VrX29wc2kodGl0aWRbMF0sdGl0aWRbMV0sX2Zvcm1hdF8pCiAgICAgICAgZXhjZXB0OmNvbnRpbnVlCiAgICBwcmludCgiIik7cHJpbnQoJyVzIFslc+KAoiVzXSAlc0NIRUNLSU5HIFBST0NFU1MgQ09NUExFVEUnJShILFAsSCxLKSk7cHJpbnQoJyVzICclKE8pKTtfY2ljaV9hemltdmF1XygnJXMgWyAlc0JBQ0sgJXNdJXMnJShILFAsSCxLKSk7bWVudSgpCgoKIyMjIFZhcmlhc2kgVGVrcwpkZWYgdmFyX21lbnUoKToKICAgIHByaW50KCclcyAgICAgICAgICBbICVzQ0hPT1NFIExPR0lOIE1FVEhPRCAlc10nJShaLEssWikpCiAgICBwcmludCgnJykKICAgIHByaW50KCclcyBbJXMxJXNdICVzTE9HSU4gV0lUSCBUT0tFTiBbJXNMSU1JVEVEIEFDQ0VTUyVzXSclKEgsUCxILFAsTSxQKSkKICAgIHByaW50KCclcyBbJXMyJXNdICVzTE9HSU4gV0lUSCBDT09LSUVTIFslc1VOTElNSVRFRCBBQ0NFU1Mlc10nJShILFAsSCxQLEgsUCkpCiAgICBwcmludCgnJXMgWyVzMCVzXSAlc0VYSVQnJShILFAsSCxNKSkKICAgIHByaW50KCclcyAnJShPKSkKICAgIAogICAgCmRlZiB2YXJfdWdlbigpOgogICAgcHJpbnQoIiVzIFslczElc10gJXNHRVQgVVNFUiBBR0VOVCIlKEgsUCxILEgpKQogICAgcHJpbnQoIiVzIFslczIlc10gJXNDSEFOR0UgVVNFUiBBR0VOVCAlcyglc01BTlVBTCVzKSIlKEgsUCxILFAsQixILEIpKQogICAgcHJpbnQoIiVzIFslczMlc10gJXNDSEFOR0UgVVNFUiBBR0VOVCAlcyglc0FESlVTVCBIUCVzKSIlKEgsUCxILFAsQixLLEIpKQogICAgcHJpbnQoIiVzIFslczQlc10gJXNERUxFVEUgVVNFUiBBR0VOVCIlKEgsUCxILE0pKQogICAgcHJpbnQoIiVzIFslczUlc10gJXNDSEVDSyBVU0VSIEFHRU5UIiUoSCxQLEgsSykpCiAgICBwcmludCgiJXMgWyVzMCVzXSAlc0JBQ0siJShILFAsSCxNKSkKCmRlZiBzdGFydF9tZXRob2QoKToKICAgIHByaW50KCclcyAnJShPKSkKICAgIHByaW50KCclcyBbJXMxJXNdICVzQVBJIE1FVEhPRCBWMSclKEgsUCxILE0pKQogICAgcHJpbnQoJyVzIFslczIlc10gJXNBUEkgTUVUSE9EIFYyJyUoSCxQLEgsQikpCiAgICBwcmludCgnJXMgWyVzMyVzXSAlc1dJRkkgTU9EIFYxIFtTcGVlZF0nJShILFAsSCxIKSkKICAgIHByaW50KCclcyBbJXM0JXNdICVzV0lGSSBNT0QgVjInJShILFAsSCxLKSkKICAgIHByaW50KCclcyBbJXM1JXNdICVzTU9CSUxFIE1FVEhPRCBWMSclKEgsUCxILE8pKQogICAgcHJpbnQoJyVzIFslczYlc10gJXNNT0JJTEUgTUVUSE9EIFYyJyUoSCxQLEgsUCkpCgpkZWYgc3RhcnRfbWV0aG9kZXp6KCk6CiAgICBwcmludCgiIikKICAgIHByaW50KCclcyBbJXMxJXNdICVzRkFTVCBDTE9ORSAlc1slc0ZFVyBSRVNVTFRTJXNdJyUoSCxQLEgsTyxPLE0sTykpCiAgICBwcmludCgnJXMgWyVzMiVzXSAlc1NMT1cgQ0xPTkUgJXNbJXNSRUNPTU1FTkRFRCVzXSclKEgsUCxILE8sTyxILE8pKQogICAgcHJpbnQoJyVzIFslczMlc10gJXNWRVJZIFNMT1cgQ0xPTkUgJXNbJXNNT1JFIFJFU1VMVFMlc10nJShILFAsSCxPLE8sQixPKSkKICAgIHByaW50KCclcyBbJXM0JXNdICVzQ09NQklORUQgUEFTU1dPUkQgQ0xPTkUnJShILFAsSCxLKSkKICAgIHByaW50KCIiKQogICAgCiAgICAKZGVmIHN0YXJ0ZWQoKToKICAgIHByaW50KCIiKQogICAgcHJpbnQoIiAgICAgJXPigKIlc+KAoiVz4oCiJXPigKIlc+KAoiVz4oCiJXPigKIlc+KAoiVz4oCiJXPigKIlc+KAoiVz4oCiJXPigKIlc+KAoiVz4oCiJXPigKIlc+KAoiVz4oCiIiUoSCxNLEIsSyxVLE8sSyxILE0sQixLLFUsTyxLLEgsTSxCLEspKQogICAgcHJpbnQoJyVzIFslc+KAoiVzXSAlc0NMT05JTkcgSU4gUFJPR1JFU1MuLi4nJShILE0sSCxIKSkKICAgIHByaW50KCclcyBbJXPigKIlc10gJXNbJXNHT09EJXNdIElEUyBTQVZFRCBJTiA+PiAlc0dPT0QvJXMudHh0JyUoSCxCLEgsTyxILE8sSCx0YW5nZ2FsKSkKICAgIHByaW50KCclcyBbJXPigKIlc10gJXNbJXNDUCVzXSBJRFMgU0FWRUQgSU4gPj4gJXNDUC8lcy50eHQnJShILEssSCxPLE0sTyxNLHRhbmdnYWwpKQogICAgcHNiKCclcyBbJXPigKIlc10gJXNPTiBGTElHSFQgTU9ERSBGT1IgWzMgU0VDXSBFVkVSWSAzIE1JTlVURVNcbiclKEgsUCxILEIpKQoKCmRlZiBmb2xkZXIoKToKICAgIHRyeTpvcy5ta2RpcigiQ1AiKQogICAgZXhjZXB0OnBhc3MKICAgIHRyeTpvcy5ta2RpcigiR09PRCIpCiAgICBleGNlcHQ6cGFzcwoKCgogICAJCmlmIF9fbmFtZV9fPT0nX19tYWluX18nOgoJb3Muc3lzdGVtKCdnaXQgcHVsbCcpCglmb2xkZXIoKQoJbWVudSgpCg=="))
